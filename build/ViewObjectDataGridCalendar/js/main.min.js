function json2xml(e,t){var n=function(e,t,i){var a="";if(e instanceof Array)for(var r=0,o=e.length;o>r;r++)a+=i+n(e[r],t,i+"	")+"\n";else if("object"==typeof e){var l=!1;a+=i+"<"+t;for(var c in e)"@"==c.charAt(0)?a+=" "+c.substr(1)+'="'+e[c].toString()+'"':l=!0;if(a+=l?">":"/>",l){for(var c in e)"#text"==c?a+=e[c]:"#cdata"==c?a+="<![CDATA["+e[c]+"]]>":"@"!=c.charAt(0)&&(a+=n(e[c],c,i+"	"));a+=("\n"==a.charAt(a.length-1)?i:"")+"</"+t+">"}}else a+=i+"<"+t+">"+e.toString()+"</"+t+">";return a},i="";for(var a in e)i+=n(e[a],a,"");return t?i.replace(/\t/g,t):i.replace(/\t|\n/g,"")}function xml2json(e,t){var n={toObj:function(e){var t={};if(1==e.nodeType){if(e.attributes.length)for(var i=0;i<e.attributes.length;i++)t["@"+e.attributes[i].nodeName]=(e.attributes[i].nodeValue||"").toString();if(e.firstChild){for(var a=0,r=0,o=!1,l=e.firstChild;l;l=l.nextSibling)1==l.nodeType?o=!0:3==l.nodeType&&l.nodeValue.match(/[^ \f\n\r\t\v]/)?a++:4==l.nodeType&&r++;if(o)if(2>a&&2>r){n.removeWhite(e);for(var l=e.firstChild;l;l=l.nextSibling)3==l.nodeType?t["#text"]=n.escape(l.nodeValue):4==l.nodeType?t["#cdata"]=n.escape(l.nodeValue):t[l.nodeName]?t[l.nodeName]instanceof Array?t[l.nodeName][t[l.nodeName].length]=n.toObj(l):t[l.nodeName]=[t[l.nodeName],n.toObj(l)]:t[l.nodeName]=n.toObj(l)}else e.attributes.length?t["#text"]=n.escape(n.innerXml(e)):t=n.escape(n.innerXml(e));else if(a)e.attributes.length?t["#text"]=n.escape(n.innerXml(e)):t=n.escape(n.innerXml(e));else if(r)if(r>1)t=n.escape(n.innerXml(e));else for(var l=e.firstChild;l;l=l.nextSibling)t["#cdata"]=n.escape(l.nodeValue)}e.attributes.length||e.firstChild||(t=null)}else 9==e.nodeType?t=n.toObj(e.documentElement):alert("unhandled node type: "+e.nodeType);return t},toJson:function(e,t,i){var a=t?'"'+t+'"':"";if(e instanceof Array){for(var r=0,o=e.length;o>r;r++)e[r]=n.toJson(e[r],"",i+"	");a+=(t?":[":"[")+(e.length>1?"\n"+i+"	"+e.join(",\n"+i+"	")+"\n"+i:e.join(""))+"]"}else if(null==e)a+=(t&&":")+"null";else if("object"==typeof e){var l=[];for(var c in e)l[l.length]=n.toJson(e[c],c,i+"	");a+=(t?":{":"{")+(l.length>1?"\n"+i+"	"+l.join(",\n"+i+"	")+"\n"+i:l.join(""))+"}"}else a+="string"==typeof e?(t&&":")+'"'+e.toString()+'"':(t&&":")+e.toString();return a},innerXml:function(e){var t="";if("innerHTML"in e)t=e.innerHTML;else for(var n=function(e){var t="";if(1==e.nodeType){t+="<"+e.nodeName;for(var i=0;i<e.attributes.length;i++)t+=" "+e.attributes[i].nodeName+'="'+(e.attributes[i].nodeValue||"").toString()+'"';if(e.firstChild){t+=">";for(var a=e.firstChild;a;a=a.nextSibling)t+=n(a);t+="</"+e.nodeName+">"}else t+="/>"}else 3==e.nodeType?t+=e.nodeValue:4==e.nodeType&&(t+="<![CDATA["+e.nodeValue+"]]>");return t},i=e.firstChild;i;i=i.nextSibling)t+=n(i);return t},escape:function(e){return e.replace(/[\\]/g,"\\\\").replace(/[\"]/g,'\\"').replace(/[\n]/g,"\\n").replace(/[\r]/g,"\\r")},removeWhite:function(e){e.normalize();for(var t=e.firstChild;t;)if(3==t.nodeType)if(t.nodeValue.match(/[^ \f\n\r\t\v]/))t=t.nextSibling;else{var i=t.nextSibling;e.removeChild(t),t=i}else 1==t.nodeType?(n.removeWhite(t),t=t.nextSibling):t=t.nextSibling;return e}};9==e.nodeType&&(e=e.documentElement);var i=n.toJson(n.toObj(n.removeWhite(e)),e.nodeName,"	");return"{\n"+t+(t?i.replace(/\t/g,t):i.replace(/\t|\n/g,""))+"\n}"}function BadParameterException(e){this.name="BadParameter",this.message=e}function NoDataException(e){this.name="NoDataException",this.message=e}function MethodNotImplementedException(e){this.name="MethodNotImplementedException",this.message=e}function DetailPageBlockIdGenerator(){}function DetailPageBlock(e){this.id=DetailPageBlockIdGenerator.generateId(),this.parentBlock=null,this.element=angular.element('<div blockId="'+this.id+'"></div>'),this._contentObject=null,this.childBlocks=[],this.childContainer=null,this.settings=e||{},this.fieldInEditMode=null,this.currentPageBlock=null,Object.defineProperty(this,"contentObject",{get:function(){return this._contentObject},set:function(e){e instanceof ContentObject?(e.pageBlock=this,this._contentObject=e,this.element.empty(),this.element.append(e.generateContent())):this._contentObject=null}})}function ContentObject(){this._content=null,this.element=angular.element('<div class="ContentObject"></div>'),this.pageBlock=null,Object.defineProperty(this,"content",{get:function(){return this.element},set:function(e){this.element.empty(),angular.isObject(e)?this.element.append(angular.element(e)):this.element.innerHTML(e)}})}function DetailObject(){DetailObject.base.constructor.call(this,arguments),this.header="",this._tabStrip=null,this._menu=null,this._fields=[],this._promiseBlocks=[],Object.defineProperty(this,"fields",{get:function(){return this._fields},set:function(e){e&&angular.isFunction(e.then)?this._promiseBlocks.push(e.then(function(e){this._fields=e})):this._fields=e}}),Object.defineProperty(this,"tabStrip",{get:function(){return this._tabStrip},set:function(e){e&&angular.isFunction(e.then)?this._promiseBlocks.push(e.then(function(e){this._tabStrip=e})):this._tabStrip=e}}),Object.defineProperty(this,"menu",{get:function(){return this._menu},set:function(e){e&&angular.isFunction(e.then)?this._promiseBlocks.push(e.then(function(e){this._menu=e})):this._menu=e}}),this.pageBlock=null}var pageConfig=angular.merge({},pageConfig,{modelId:"ObjectEntry_ID",templateVersion:"13",objectDetailPageSize:5,environment:"local",gridPageSize:10,inlineSaveMethod:"local",gridContainer:"#mainGrid",AppContainer:"ASTopContainer",waitForFilter:!0,mobile:!1,enableMobile:!0,gridEditable:!1,enableKeyboard:!0});kendo.culture("sv-SE"),window.mobilecheck=function(){try{return document.createEvent("TouchEvent"),!0}catch(e){return!1}},pageConfig.enableMobile&&window.mobilecheck()&&(pageConfig.mobile=!0),pageConfig=angular.merge({},pageConfig,{objectDetailDisplayType:{type:"popup"},showFirstRecord:!1});var SchedulerConfig={mainObjectDefinitionName:pageConfig.objectDefinitionName,objectDefinitionName:"Work_Order_Detail",pageTemplateName:"Default",waitForFilter:!0,schedulerHolder:"#Scheduler",height:733,workDayStart:"2013/1/1 6:00 AM",workDayEnd:"2013/1/1 5:00 PM",startField:"Start_Date",endField:"End_Date",schedulerPopupHolder:"SchedulerPopupHolder",startEndDiff:60,ObjectDetailDisplayMode:"popup",numberOfDaysToAdd:7,titleField:"Name",showResourcePanel:!0,resourceField:"Assigned_To"},DateTimeHelper=function(){};DateTimeHelper.DateTimeFormat=function(e){if(void 0!=e&&null!=e&&""!=e&&"null"!=e){var t=kendo.parseDate(e,"yyyy-MM-dd HH:mm:ss");return t=null==t?new Date(e):t,t=kendo.parseDate(t,"yyyy-MM-dd HH:mm:ss"),void 0==t||null==t||"null"==t?"":kendo.toString(t,"yyyy-MM-dd HH:mm:ss")}return""},DateTimeHelper.DateFormat=function(e){if(void 0!=e&&null!=e&&""!=e&&"null"!=e){var t=kendo.parseDate(e,"yyyy-MM-dd ");return t=null==t?new Date(e):t,t=kendo.parseDate(t,"yyyy-MM-dd "),void 0==t||null==t||"null"==t?"":kendo.toString(t,"yyyy-MM-dd")}return""},Date.isLeapYear=function(e){return e%4===0&&e%100!==0||e%400===0},Date.getDaysInMonth=function(e,t){return[31,Date.isLeapYear(e)?29:28,31,30,31,30,31,31,30,31,30,31][t]},Date.prototype.isLeapYear=function(){return Date.isLeapYear(this.getFullYear())},Date.prototype.getDaysInMonth=function(){return Date.getDaysInMonth(this.getFullYear(),this.getMonth())},Date.prototype.addMonths=function(e){var t=this.getDate();return this.setDate(1),this.setMonth(this.getMonth()+e),this.setDate(Math.min(t,this.getDaysInMonth())),this};var SUConstants={RecordFirstImageColumn:"RecordFirstImagePath",ObjectPropertyNameField:"Name",ParentRelationshipPropertyName:"ParentRelationship_Property_Name",ImageSizes:{h60:"_t_h60",h100:"_t_h100",h500:"_t_h500",h1024:"_t_h1024"},MainObjectFieldClass:"mainObjectField",NotificationCookieName:"notificationPopupShown_Dec_2015_1",PropertyDefinitionID:"PropertyDefinition_ID",ObjectId:"ObjectEntry_ID"};Object.defineProperty(Object.prototype,"inherit",{enumerable:!1,value:function(e,t,n){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.base=e.prototype;for(var i in n)t.prototype[i]=n[i];return t}}),angular.module("speedup.localization",[]).factory("localizationService",[function(){var e=function(){};return e.translate=function(e){var t=e.split("."),n=$.objectLanguage,i=null,a=t.every(function(e){return n.hasOwnProperty(e)?(n=n[e],!0):!1});return i=a?n:e},e}]).filter("i18n",["localizationService",function(e){return function(t){return e.translate(t)}}]),$.objectLanguage={DaysOfWeekCap:[{key:"Sunday",full:"Söndag",one:"S"},{key:"Monday",full:"Måndag",one:"M"},{key:"Tuesday",full:"Tisdag",one:"T"},{key:"Wednesday",full:"Onsdag",one:"O"},{key:"Thursday",full:"Torsdag",one:"T"},{key:"Friday",full:"Fredag",one:"F"},{key:"Saturday",full:"Lördag",one:"L"}],RepeatTypes:[{text:"Dagligen",value:"daily"},{text:"Varje vecka",value:"weekly"},{text:"Varje månad",value:"monthly"},{text:"Varje år",value:"yearly"}],Labels:{Unassigned:"Ej tilldelad",CheckAll:"Välj alla",Days:"dagar",Weeks:"veckor",Months:"månader",Years:"år",Occurrences:"gånger"},Titles:{BatchEdit:"Batch uppdatering",DeleteObject:"Ta bort",RepeatObject:"Upprepa"},Options:{SelectOne:"--Välj en--"},Messages:{SelectAtLeastOneFieldForBatchEdit:"Välj minst ett fält",BatchEditSuccess:"Posterna uppdaterades",SelectAtLestOneForBatchEdit:"Välj minst en post i listan",FailedToBatchEdit:"Misslyckades med att batch uppdatera flera poster",FailedToLoadData:"Misslyckades med att ladda data från servern",NoRecordsForConversion:"Inga poster valda för konvertering",UnableToCreatePrintTemplate:"Misslyckades med att skapa utskriftsmall.",UnableToCopyObject:"Misslyckades med att kopiera posten.",UnableToSaveRecord:"Misslyckades med att spara posten.",UnableToDeleteRecord:"Misslyckades med att ta bort posten.",UnableToOpenEditObjectPopup:"Misslyckades med att öppna redigera fönstret.",DeleteFile:"Är du säker på att du vill ta bort den här filen?",NoContentToDisplay:"Inget innehåll finns att visa.",DeleteParentIfNoSubobjects:"Det finns inga underobjekt kvar, vill du ta bort huvudobjektet?",RepeatAddedToQueue:"Posten är lagd i en kö och kommer att upprepas så fort det blir dess tur i kön",EventRepeatFailed:"Misslyckades med att upprepa händelsen",EventRepeatedSuccessfully:"Upprepning av händelsen lyckades",RecordCopiedSuccessfully:"Posten kopierad",RecordSavedSuccessfully:"Posten sparad",RecordUpdatedSuccessfully:"Posten uppdaterad",RecordDeletedSuccessfully:"Posten borttagen",EditedRecordIdNotFound:"Vald post för redigerings objektpostid hittades inte",InvalidJson:"Json är inte giltig",ConversionSuccessfully:"Konvertering utförd.",ConversionFailed:"Conversion failed.",NoRecordFound:"Inga resultat hittades",dropfiles:"släpp filer här för att ladda upp",DeleteObject:"Vill du verkligen ta bort objektet?"},Tabs:{RepeatBy:"Upprepa efter",DayOfWeek:"veckodag",DayOfMonth:"dag i månaden",Details:"Detaljer",DocumentsAndAttachments:"Dokument och bilagor",Repeats:"Upprepas",RepeatEvery:"Upprepa var",RepeatOn:"Upprepa varje",StartsOn:"Börjar",Ends:"Slutar",After:"Efter",On:"På"},Buttons:{GotIt:"Jag fattar",Send:"Send",Done:"Klar",Yes:"Ja",No:"Nej",RepeatObject:"Upprepa",CopyObject:"Kopiera",Create:"Skapa ny",Edit:"Redigera",Cancel:"Avbryt",Save:"Spara",AddNewDocument:"Lägg till nytt dokument eller en bilaga",Print:"Skriv ut",Conversion:"Konvertera",Filter:"Använd filter",Search:"Sökning",Next:"Nästa",Previous:"Föregående",Reset:"Återställ",Update:"Uppdatera",SaveAndAddNew:"Spara och lägg till ny",SaveAndCopyNew:"Spara och lägg till ny kopia",UpdateAndAddNew:"Uppdatera-Ny",UpdateAndCopyNew:"Uppdatera-Kopiera-Ny",AddNewRecord:"Ny",Remove:"Ta bort",SelectFile:"Välj en fil",DeleteObject:"Ta bort"},Headers:{PrintRecord:"Skriv ut post.",NewDetailTitle:"Skapa ny post.",Filters:"Filter",AdvancedSearch:"Avancerad sök",Lookup:"lista"},ColumnNames:{FileName:"Filnamn",CreatedDate:"Skapad datum",Select:"Välj",GetAddress:"Hämta adress",Getcoordinates:"Hämta koordinater",Retrievecurrentposition:"Hämta nuvarande position"},Filters:{NoFilter:"Inga filter",Hide:"Dölj",Filter:""},ActionMenu:{Action:"Åtgärder"},AdvancedSearch:{Search:"Sök",Clear:"Rensa",Before:"Före",After:"Efter"}},angular.module("speedup.exceptionHandling",["speedup.CSVModule"]).config(["$provide",function(e){e.decorator("$exceptionHandler",["$log","$delegate",function(e,t){return function(n,i){e.error(n),t(n,i)}}])}]);var CSVapp=angular.module("speedup.CSVModule",["kendo.directives","ngCookies","ngResource","speedup.modal","speedup.localization","speedup.objectDetail","speedup.scheduler","speedup.exceptionHandling","speedup.grid"]).run(["configService","schemaService","autocompleteService","listDataLoaderService",function(e,t,n,i){e.Init();var a=e.getSchedulerConfig(),r=a.objectDefinitionName,o=a.mainObjectDefinitionName;t.Init(),"undefined"!=typeof acData&&n.prepareACData(acData),i.fetchMultipleListsData(r),i.fetchMultipleListsData(o)}]);CSVapp.controller("PageLogicController",["$rootScope","$scope","configService","eventManager","animationService","popupNotificationService","filesystemService",function(e,t,n,i,a,r,o){function l(){e.currentPageBlock=null;var t=jQuery.Event("activateFirstPageBlock");$(document).trigger(t)}function c(){s&&d&&t.$broadcast(CheckFilterStateEvent)}var s=!1,d=!1,u=n.getSchedulerConfig(),p=u.objectDefinitionName,f=n.getGlobalConfig();r.displayMainPageNotification(),t.filterOptions={odn:p},t.batchUpdate=f.batchUpdate,t.odn=p,t.gridElement=$(f.gridContainer),f.enableKeyboard&&($(document).off("keydown"),$(document).on("keydown",function(t){var n=t.keyCode||t.which;if(9==n){var i=jQuery.Event("detailKeypress");i.which=e.shiftPressed?169:9,e.currentPageBlock&&e.currentPageBlock.contentObject&&e.currentPageBlock.contentObject.element?e.currentPageBlock.contentObject.element.trigger(i):l(),t.preventDefault()}else if(13==n){var a=jQuery.Event("detailKeypress");a.which=13,e.currentPageBlock&&e.currentPageBlock.contentObject&&e.currentPageBlock.contentObject.element?e.currentPageBlock.contentObject.element.trigger(a):l()}else if(27==n){var r=jQuery.Event("escPressed");r.which=27,$(document).trigger(r)}else 16==n&&(e.shiftPressed=!0)}),$(document).on("keyup",function(t){var n=t.keyCode||t.which;16==n&&(e.shiftPressed=!1)}),i.addListener(DisplayerElementClosedEvent,function(){l()}));var v=1e3;if(f.mobileView){var m=o.getImageUrl("DesktopModules/src/assets/style/mobile.css"),g=$("<link rel='stylesheet' type='text/css' href='"+m+"'>");$("head").append(g)}i.addListener(LoadActionStartEvent,function(){a.displayGlobalLoader()}),i.addListener(LoadActionEndEvent,function(){a.hideGlobalLoader()}),t.$on(ASTabChangeWidthEvent,function(e,n){t.$broadcast(SchedulerChangeWidthEvent,n)}),t.$on(FilterReadyEvent,function(){s=!0,c()}),t.$on(SchedulerReadyEvent,function(){if(f.mobile){var e,t,n,i=$(u.schedulerHolder).data("kendoScheduler");document.oncontextmenu=function(){return!1},i.wrapper.on("mouseup touchend",".k-scheduler-table td, .k-event",function(){return t=n=null,clearTimeout(e),!1}).on("mouseup touchstart",".k-scheduler-table td, .k-event",function(a){var r=a.currentTarget;return t=r.x,n=r.y,e=window.setTimeout(function(){var e=$(a.currentTarget);if(e.hasClass("k-event")){var t=i.occurrenceByUid(e.data("uid"));i.editEvent(t)}else{var n=i.slotByElement(e[0]);i.addEvent({start:n.startDate,end:n.endDate})}},v),!1})}d=!0,c()})}]),CSVapp.factory("commonService",["configService",function(e){var t=function(){};return t.isNotNullOrUndefinedOrEmpty=function(e){return!(void 0==e||null==e||""==e)},t}]),CSVapp.factory("fieldService",["configService","listDataLoaderService","autocompleteService","schemaService",function(e,t,n,i){var a=e.getGlobalConfig(),r=a.dataTypes,o=["CreatedBy","CreatedDate","ChangedDate","ChangedBy","ChangedName","OrganizationID","PortalID","OwnerID","RecordType"],l=[r.MultiSelectList,r.GeoData,r.Image,r.CheckBox,r.RichTextBox,r.LinkButton,r.Summary],c=function(){};c.loadCurrentElement=function(e,t,n,a,r){var o=[],l=[];return i.getSchema(e).then(function(a){a.AllColumnsList;i.getDropDownListOutputSettings().forEach(function(i,a){i.DefinitionName==e&&i.PropertyId==t&&this.Data&&$.each(this.Data,function(){var e=this.PropertyId,t=columnList.filter(function(t){return"{"+t.PropertyDefinition_ID+"}"==e?t:void 0})[0];if(void 0!=t&&null!=t){var a="";if($.each(n,function(e,n){return e==t.PropertyName?(a=n,!0):void 0}),t.DataType==$.config.DataType.ObjectRelationship){var c=a.split(":");a=c[c.length-1]}var s=$config.FillValuesInExpression(definitionname,this.Expression,e,a,r),d=new Object;d.Expression=s,d.PropertyName=i.PropertyName,d.List=this.List,d.DataType=i.DataType,o.push(d),d=new Object,d.ValidationExpression=s,l.push(d)}})})})},c.isDataTypeEditable=function(e){return-1==$.inArray(e,l)},c.isFieldReadOnly=function(e){return $.inArray(e,o)>-1||e.DataType==r.Formula||e.DataType==r.Summary},c.initializeEditors=function(e,t){void 0!=e&&$.each(e,function(e,n){c.initEditorField(n,t)})},c.initEditorField=function(e,t,n){var i=a.dataTypes,r=e.DataType,o=e.InputSettings,l=e.PropertyName,c=e.PropertyValue,k=e.PropertyDefinition_ID;switch(r){case i.TextBox:s(t,l);break;case i.ObjectRelationship:case i.ParentRelationship:var D=o?o.split(":")[1]:null;v(t,l,D,k,n);break;case i.MultiSelectList:p(t,l,c,o);break;case i.SearchableDropDownList:f(t,l,c,o);break;case i.DropDownList:u(t,l,c,o);break;case i.MultiObjectRelationshipField:d(t,l,o);break;case i.DateTime:m(t,l,c);break;case i.Date:g(t,l,c);break;case i.Time:h(t,l,c);break;case i.RichTextBox:b(t,l,c);break;case i.NumericText:y(t,l,c);break;case i.Numeric:S(t,l,c,o)}};var s=function(e,t){var n=e.find("#txt"+t);n.text($.trim(n.text()))},d=function(e,t,n){var i,a=[],r=n.split(";");r.length>0&&$.each(r,function(e,t){i=t.split(":"),i.length>0&&a.push({Value:i[0],Text:i[1]})});var o=e.find("#ddl"+t).data("kendoDropDownList");(void 0==o||null==o)&&e.find("#ddl"+t).kendoDropDownList({dataTextField:"Text",dataValueField:"Value",filter:"contains",ignoreCase:!0,dataSource:a})},u=function(e,n,i,r){var o=e.find("#"+n).data("kendoDropDownList");o?o.value(i||""):t.GetListsData(r).then(function(r){var l=t.addEmptyListValue(r),c={dataTextField:"Text",dataValueField:"Value",ignoreCase:!0,dataSource:l};i&&(c.value=i),a.mobileView||(c.filter="contains",c.optionLabel=" "),o=e.find("#"+n).kendoDropDownList(c)})},p=function(e,n,i,a){var r=e.find("#"+n).data("kendoMultiSelect"),o=i?i.split(","):"";void 0==r||null==r?t.GetListsData(a,!0).then(function(t){var i={dataTextField:"Text",dataValueField:"Value",filter:"contains",ignoreCase:!0,dataSource:t};o&&(i.value=o),r=e.find("#"+n).kendoMultiSelect(i)}):r.value(o)},f=function(e,n,i,a){var r=e.find("#"+n).data("kendoComboBox"),o=i||"";void 0==r||null==r?t.GetListsData(a,!0).then(function(t){var i={dataTextField:"Text",dataValueField:"Value",filter:"contains",ignoreCase:!0,dataSource:t,optionLabel:" "};o&&(i.value=o),r=e.find("#"+n).kendoComboBox(i)}):r.value(o)},v=function(e,t,i,a,r){var o=e.find("#txt"+t);n.wrapElement(e,o,t,a,r,null,function(){e.click()},!1,i)},m=function(e,t,n){var i=e.find("#txtdateTime"+t).data("kendoDateTimePicker");void 0==i||null==i?i=e.find("#txtdateTime"+t).kendoDateTimePicker({format:"yyyy-MM-dd HH:mm:ss",parseFormats:["yyyy-MM-dd HH:mm:ss"]}):i.value(n)},g=function(e,t,n){var i=e.find("#txtdate"+t).data("kendoDatePicker");void 0==i||null==i?e.find("#txtdate"+t).kendoDatePicker({format:"yyyy-MM-dd",parseFormats:["yyyy-MM-dd"]}):i.value(n)},h=function(e,t,n){var i=e.find("#txttime"+t).data("kendoTimePicker");void 0==i||null==i?e.find("#txttime"+t).kendoTimePicker({format:"HH:mm",parseFormats:["HH:mm"]}):i.value(n)},b=function(e,t,n){var i=e.find("#richtxt"+t).data("kendoEditor");void 0==i||null==i?e.find("#richtxt"+t).kendoEditor({tools:["bold","italic","underline","strikethrough","justifyLeft","justifyCenter","justifyRight","justifyFull","insertUnorderedList","insertOrderedList","indent","outdent","createLink","unlink","insertImage","subscript","superscript","createTable","addRowAbove","addRowBelow","addColumnLeft","addColumnRight","deleteRow","deleteColumn","viewHtml","formatting","fontName","fontSize","foreColor","backColor"]}):i.value(n)},y=function(e,t,n){var i=e.find("#txtNum"+t).data("kendoNumericTextBox");void 0==i||null==i?e.find("#txtNum"+t).kendoNumericTextBox({value:n}):i.value(n)},S=function(e,t,n,i){var a=i.split(":"),r=""==a[0]?0:a[0],o=""==a[1]?0:a[1],l=""==a[2]?1:a[2],c=e.find("#txtNum"+t).data("kendoNumericTextBox");void 0==c||null==c?e.find("#txtNum"+t).kendoNumericTextBox({min:r,max:o,step:l,value:n}):c.value(n)};return c}]),CSVapp.factory("relatedObjectsService",["$rootScope","$compile","configService","objectDetailDisplayerService","filesystemService","eventManager","schemaService","localizationService",function(e,t,n,i,a,r,o,l){function c(e,t,n,i,a,o,l,c,p){var v=s(t,{genericSearch:a,onSelect:function(t){l.close(),u(i,e,t.ObjectEntry_ID,t.Name),angular.isFunction(o)&&o(t)}}),m=d(e,t,n,v,a),g=new ContentObject;g.content=m;var h=new DetailPageBlock({});h.contentObject=g;var b=angular.extend({},f,{top:p});l.getDetailView(c,h,b),l.onClose(function(){h.element.remove(),r.disposeListeners(v)})}function s(e,t){var n=v;return n.odn=e,angular.isObject(t)?angular.extend({},n,t):n}function d(n,i,r,o,l){var c=e.$new();c.fieldName=n,c.imgSrc=a.getPluginImageUrl("JS/img/search.png"),c.gridParameters=o,c.oid=r,c.odn=i,c.fieldValue=l;var s=angular.element("<div><related-objects></related-objects></div>");return t(s)(c),s}function u(e,t,n,i){e.find("#txt"+t).val(i),e.find("#hdn"+t).val(n),e.closest(".detailPageMainBlock").click()}var p=n.getGlobalConfig(),f={modal:!0,visible:!1,resizable:!1,maxHeight:500,minHeight:300,width:700,actions:["Pin","Minimize","Maximize","Close"]},v={selectedPage:0,filterExpression:"",genericSearch:"",refreshButton:!0,recordCountFilterExpression:"",gridHeight:400,pageSize:p.gridPageSize,columnWidth:100,showSelectButton:!0,columnMinWidth:150,columnMaxWidth:"auto",showEditButton:!1,showDeleteButton:!1,selectFirstRecord:!1,showCheckboxForRowSelection:!1},m=function(){};return m.openRelatedObjectPopup=function(e,t,n,a,r,s,d){var u=i.getDisplayer({type:"popup"});o.createPageTitle(t).then(function(i){var o=i+" "+l.translate("Headers.Lookup");c(e,t,n,a,r,d,u,o,s)})},m}]),CSVapp.directive("relatedObjects",["$timeout","configService","autocompleteService","eventManager",function(e,t,n,i){function a(e,t){i.fireEvent(FilterGridByGenericSearchEvent,{odn:e,genericSearchStr:t})}return{templateUrl:function(e,n){return n.templateUrl||t.getTemplateUrl("RelatedObjects/RelatedObjectTemplate.html")},restrict:"EA",transclude:!0,replace:!0,link:{post:function(t,i){e(function(){var e=i.find("#txt"+t.fieldName);e.val(t.fieldValue),i.find("._objRelButtonSearch").click(function(n){a(t.odn,e.val())}),t.oid&&n.wrapElement(i,e,t.fieldName,t.oid,null,{change:function(){a(t.odn,this.value())}})})}}}}]),CSVapp.factory("eventManager",[function(){var e={},t=function(){};return t.fireEvent=function(t,n){$.isArray(e[t])&&e[t].forEach(function(e){e&&e.call(this,n)})},t.addListener=function(t,n,i){if("string"==typeof t&&$.isFunction(n)){e[t]||(e[t]=[]);var a=e[t].push(n);return angular.isObject(i)&&(angular.isObject(i.listeners)||(i.listeners={}),angular.isArray(i.listeners[t])||(i.listeners[t]=[]),i.listeners[t].push(a-1)),!0}return!1},t.removeListener=function(t,n){return angular.isArray(e[t])&&e[t][n]?(delete e[t][n],!0):!1},t.disposeListeners=function(t){if(angular.isObject(t)&&angular.isObject(t.listeners))for(var n in t.listeners)angular.isArray(t.listeners[n])&&angular.isArray(e[n])&&t.listeners[n].forEach(function(t){e[n][t]&&delete e[n][t]})},t}]),BadParameterException.prototype=new Error,BadParameterException.prototype.constructor=BadParameterException,NoDataException.prototype=new Error,NoDataException.prototype.constructor=NoDataException,MethodNotImplementedException.prototype=new Error,MethodNotImplementedException.prototype.constructor=MethodNotImplementedException,CSVapp.factory("dateTimeService",["configService",function(e){var t=(e.getGlobalConfig(),{});return t.FormatDateAmPm=function(e){var t=e.getHours(),n=e.getMinutes(),i=t>=12?"pm":"am";t%=12,t=t?t:12,n=10>n?"0"+n:n;var a=t+":"+n+" "+i;return e.getMonth()+1+"/"+e.getDate()+"/"+e.getFullYear()+"  "+a},t.DateTimeFormat=function(e){return DateTimeHelper.DateTimeFormat(e)},t.DateFormat=function(e){return DateTimeHelper.DateFormat(e)},t}]),CSVapp.factory("objectDataService",["$http","$q","$log","configService","localizationService","schemaService",function(e,t,n,i,a,r){function o(n){var a=t.defer(),o=r.getSubObjectByObjectDefinitionName(n);if(o)a.resolve(o.SubObjectsObject);else{var s=i.getUrlBase("getSubObjects")+"/"+n+"/"+c.token;e.get(s).success(function(e){l(e).then(function(t){var i={ObjectDefinitionName:n,SubObjectsObject:t};r.preserveSubObject(i),a.resolve(e)})}).error(function(e,t,i){var o=i;if("UnAuthorized"==o)a.reject("UnAuthorized");else{var l={ObjectDefinitionName:n,SubObjectsObject:null};r.preserveSubObject(l),a.resolve(null)}})}return a.promise}function l(e){var n=t.defer();if(e){var i=e.map(function(e){return r.getObjectDefinition(e.ObjectDefinitionName)});t.all(i).then(function(t){e.forEach(function(e,n){e.ObjectLabel=t[n].ObjectLabel}),n.resolve(e)})}else n.resolve([]);return n.promise}var c=i.getGlobalConfig(),s={};return s.getRelatedObjects=function(e){for(var t=e.split(";"),n=[],i=[],a=0;a<t.length;a++)if(""!=t[a]&&(n=t[a].split(":"),n.length>0)){var r=n[n.length-1];-1==$.inArray(r,i)&&i.push(n[n.length-1])}return i},s.getSubObjects=function(e,t,n){return o(e).then(function(e){var i=[];if($.isArray(e)&&e.length)if(t)for(var a=s.getRelatedObjects(t),r=0;r<a.length;r++)$.each(e,function(){a[r]==this.ObjectDefinitionName&&i.push(this)});else n||(i=e);return i})},s.fetchObjects=function(n,a,r,o,l){var s=t.defer();o=o||"";var d={ObjectDefinitionName:n,Token:c.token,RequestType:"Detail",FilterExpression:o};l?d.RecordID=l:(d.PageSize=a,d.PageNumber=r);var u=i.getUrlBase("objectRecordList")+"/"+c.token;return e.post(u,JSON.stringify(d)).success(function(e){var t=JSON.parse(e);$.isArray(t)?l?s.resolve(t[0]):s.resolve(t):s.reject("Unable to get records list. Wrong JSON.")}).error(function(){s.reject("Unable to get records list.")}),s.promise},s.fetchSingleObjectData=function(e,t){return s.fetchObjects(t,0,0,"",e)},s}]),CSVapp.factory("fieldPropertiesService",["schemaService",function(e){function t(e,t,n){var i={};return n.some(function(n){var o=n.PropertyName;return n.Visible&&o==e?(i=a(n),i.ViewOrder=n.ViewOrder?parseInt(n.ViewOrder)+1:1,i.PropertyName=n.PropertyName,r(n,t),!0):"CreatedBy"==o&&o==e||"ChangedBy"==o&&o==e?(i=a(n),i.PropertyName=n.field,i.ViewOrder=n.ViewOrder?parseInt(n.ViewOrder)+501:501,!0):o!=e||n.Visible?void 0:!0}),i}function n(e,t,n){var o={},l=[],c=i(t);return e.forEach(function(e){var t=c[e];if(t){var i=t.PropertyName;t.Visible&&i==e?(o=a(t),o.ViewOrder=t.ViewOrder?parseInt(t.ViewOrder)+1:1,o.PropertyName=t.PropertyName,r(t,n),l.push(o)):("CreatedBy"==i&&i==e||"ChangedBy"==i&&i==e)&&(o=a(t),o.PropertyName=t.PropertyName,o.ViewOrder=t.ViewOrder?parseInt(t.ViewOrder)+501:501,l.push(o))}}),l}function i(e){var t,n={};return e.forEach(function(e){t=e.PropertyName,n[t]=e}),n}function a(e){return{DataType:e.DataType,PropertyLabel:e.PropertyLabel,InputSettings:e.InputSettings,OutputSettings:e.OutputSettings,ObjectEntry_fk:e.ObjectEntry_fk,PropertyDefinition_ID:e.PropertyDefinition_ID,DefaultValue:e.DefaultValue,Required:e.Required,SystemProperty:e.SystemProperty}}function r(t,n){var i=t.OutputSettings,a=i.split("[#][@]");if(a.length>2){for(var r=a[a.length-1].split("[#]"),o={DefinitionName:n,PropertyId:t.PropertyDefinition_ID,PropertyName:t.PropertyName,InputSettings:t.InputSettings,DataType:t.DataType},l=[],c=0;c<r.length;c++)if(c>0)for(var s=r[c].split("[&]"),d=0;d<s.length;d++){var u=s[d].split("[$]");if(u.length>1)for(var p=$.trim(u[0]).split("}"),c=0;c<p.length;c++){var f=p[c].split("{");if(f.length>1){var v=$.trim(f[f.length-1]),m={PropertyId:"{"+v+"}",Value:"",Expression:$.trim(u[0]),List:$.trim(u[1])};l.push(m),e.PreserveConditionalFields(m,n)}}}o.Data=l,e.PreserveConditionalFields(o,n)}}var o={};return o.getAllPropertiesOfFieldsArrayPromise=function(t,i){return e.getSchema(i).then(function(a){var r=null!=a?a.AllColumnsList:e.GetVisibleColumns(),o=n(t,r,i);return o.odn=i,o})},o.getAllPropertiesOfFieldsArray=function(t,i){var a=null;i&&(a=e.GetSchemaByObjectDefinitionName(i));var r=null!=a?a.AllColumnsList:e.GetVisibleColumns();return n(t,r,i)},o.getAllPropertiesOfSingleFieldPromise=function(n,i){return e.getSchema(i).then(function(a){var r=null!=a?a.AllColumnsList:e.GetVisibleColumns(),o=t(n,i,r);return o.odn=i,o})},o.getAllPropertiesOfSingleField=function(n,i){var a=null;i&&(a=e.GetSchemaByObjectDefinitionName(i));var r=null!=a?a.AllColumnsList:e.GetVisibleColumns();return t(n,i,r)},o}]);var speedupObjectDetailModule=angular.module("speedup.objectDetail",["speedup.CSVModule"]);speedupObjectDetailModule.factory("objectDetailDisplayerService",["$modal","eventManager",function(e,t){function n(){this.type="popup",n.base.constructor.call(this,arguments)}function i(e){this.element=e,this.type="element",n.base.constructor.call(this,arguments)}var a=function(){};a.getDisplayer=function(e){switch(e.type){case"popup":return new n;case"element":var t=angular.element(e.element);return new i(t);default:return null}};var r=function(){};return r.prototype.close=function(){},r.prototype.setContent=function(e){this.pageBlock=e},n.detailPopupDefaultSettings={width:1e3,actions:["close"],title:"",modal:!0},n.detailPopupNewDefaultSettings={width:1e3,actions:["close"],title:"",modal:!0},document.body.clientWidth<1e3&&(n.detailPopupDefaultSettings.width=document.body.clientWidth-40,n.detailPopupNewDefaultSettings.width=document.body.clientWidth-40),Object.inherit(r,n,{getDetailViewNew:function(e,t,i){return i=i?angular.extend({},n.detailPopupDefaultSettings,i):n.detailPopupNewDefaultSettings,this.getDetailView(e,t,i)},getDetailView:function(t,i,a){return this.setContent(i),a=a?angular.extend({},n.detailPopupDefaultSettings,a):n.detailPopupDefaultSettings,a.title=t,this.modalInstance=e.open({template:"<div class='modalWindow11'></div>",settings:a,resolve:{items:function(){return i.element}},content:i}),i.displayer=this,this.modalInstance},close:function(){this.modalInstance&&this.modalInstance.close()},onClose:function(e){this.modalInstance.result.then(function(n){e(),t.fireEvent(DisplayerElementClosedEvent)},function(){e(),t.fireEvent(DisplayerElementClosedEvent)})}}),Object.inherit(r,i,{getDetailViewNew:function(e,t){return this.getDetailView(e,t)},getDetailView:function(e,t){return this.setContent(t),this.element.append(t.element),t.displayer=this,this.element},close:function(){this.pageBlock&&(this.pageBlock.removeBlock(),delete this.pageBlock)},onClose:function(e){}}),a}]),CSVapp.factory("detailPageMapService",["$q",function(e){function t(){}return t.getAddressFromLatLong=function(e,n,i,a,r,o){var l=$("#"+e).val(),c=$("#"+n).val(),s=$("#"+r).val();s=1==$.isNumeric(s)?s:14;var d=!0,u=$("#"+i).val(),p=$("#"+o).val();p=void 0==p||"undefined"==p?"":p;var f=!0,v=!0;_OMJSUNIQUE_GetAddressFromLatLong(e,n,i),t.initializeMap(l,c,e,n,d,a,u,i,r,o,s,p,f,v)},t.getLatLongFromAddress=function(e,n,i,a,r,o){var l=$("#"+e).val(),c=$("#"+n).val(),s=$("#"+r).val();s=1==$.isNumeric(s)?s:14;var d=!0,u=$("#"+i).val(),p=$("#"+o).val();p=void 0==p||"undefined"==p?"":p;var f=!0,v=!0;_OMJSUNIQUE_GetLatLongFromAddress(e,n,i),t.initializeMap(l,c,e,n,d,a,u,i,r,o,s,p,f,v)},t.getCurrentLocation=function(e,n,i,a,r,o){var l=$("#"+e).val(),c=$("#"+n).val(),s=$("#"+r).val();s=1==$.isNumeric(s)?s:14;var d=!0,u=$("#"+i).val(),p=$("#"+o).val();p=void 0==p||"undefined"==p?"":p;var f=!0,v=!0;_OMJSUNIQUE_getCurrentLocation(e,n,i),t.initializeMap(l,c,e,n,d,a,u,i,r,o,s,p,f,v)},t.createMaps=function(e){$.each(e,function(e,n){if(void 0!=n.PropertyValue&&null!=n.PropertyValue&&""!=n.PropertyValue){n.PropertyValue.split(":");void 0!=n.InlineEdit&&0==n.InlineEdit?t.initializeMap(n.Latitude,n.Longitude,n.LatField,n.LongField,!1,n.Mapdiv,n.Address,n.AddressField,n.MapZoomField,n.MapTypeField,n.MapZoom,"OPENSTREET",!0,!1,!0):t.initializeMap(n.Latitude,n.Longitude,n.LatField,n.LongField,!0,n.Mapdiv,n.Address,n.AddressField,n.MapZoomField,n.MapTypeField,n.MapZoom,"OPENSTREET",!0,!0,!0);
}})},t.initializeMap=function(e,t,n,i,a,r,o,l,c,s,d,u,p,f,v){try{_OMJSUNIQUE_loadMap_eor(e,t,"Address",n,i,a,r,o,l,c,s,d,u,p,f,v)}catch(m){}},t}]),speedupObjectDetailModule.factory("actionsListService",["objectEditService","eventManager","objectService","existingObjectDetailService","localizationService","notificationService","popupService",function(e,t,n,i,a,r,o){function l(e){var t=e.settings.currentRecord.id,i=e.settings.odn;return n.deleteObject(t,i,!0).then(function(){e.removeBlock();var t=a.translate("Messages.RecordDeletedSuccessfully");r.showNotification(t),!e.parentBlock&&e.displayer&&e.displayer.close()},function(){var e=a.translate("Messages.UnableToDeleteRecord");r.showNotification(e,!0)})}var c=function(){};return c.deleteObject=function(e){var t=a.translate("Titles.DeleteObject"),n=a.translate("Messages.DeleteObject");o.confirm(t,n).then(function(){var i=e.parentBlock;i&&i.getChildrenCount()<=1?(n=a.translate("Messages.DeleteParentIfNoSubobjects"),o.confirm(t,n,{position:{top:e.element.offset().top+25+""}}).then(function(){l(i)},function(){l(e)})):l(e)})},c.copyObject=function(e,o,l,c){return n.copyObject(e,c,!0).then(function(e){var n=a.translate("Messages.RecordCopiedSuccessfully");r.showNotification(n);var o=angular.merge({},l.settings,{currentRecord:{id:e.ObjectEntry_ID,name:e.Name},recordId:e.ObjectEntry_ID,displayMode:{type:"element",element:"<div></div>"}});i.getObjectsWithSubObjects(o,!1).then(function(e){t.fireEvent(LoadActionEndEvent);var n=e.pageBlock;l.parentBlock?(l.parentBlock.appendChildBlock(n),$("html, body").animate({scrollTop:n.element.offset().top},1e3)):(l.substituteBlockBy(n),$("html, body").animate({scrollTop:n.element.offset().top},1e3))})},function(e){t.fireEvent(LoadActionEndEvent),r.showNotification(e,!0)})},c.createNewSubObject=function(t,n){var i=t.settings.currentRecord;return i?e.createNewObject(n,i.id,i.name,i.fk,t.settings.overridenFields):e.createNewObject(n)},c.addNewObjectPageBlockAfterSave=function(e){var a={};t.addListener(ObjectSavedEvent,function(r){var o=e.pageBlock,l=angular.merge({},o.settings);l.odn=r.ObjectDefinitionName,l.recordId=r.ObjectEntryID,l.currentRecord={fk:r.ObjectDefinitionID,id:r.ObjectEntryID,name:r.ObjectEntryName};var c=n.extractItemFromSaveAPIResponse(r);i.createDetailPageBlock(l,c).then(function(e){o.appendChildBlock(e)}),t.disposeListeners(a)},a)},c}]),speedupObjectDetailModule.directive("odActionsList",["$timeout","configService","eventManager","objectService","existingObjectDetailService","actionsListService","repeatActionService",function(e,t,n,i,a,r,o){var l={templateUrl:function(e,n){return n.templateUrl||t.getTemplateUrl("ActionsList/ActionsList.html")},restrict:"EA",transclude:!0,replace:!0,link:function(t,i){e(function(){i.find(".deleteObjectAction").bind("click",function(e){t.settings;r.deleteObject(t.pageBlock)}),i.find(".repeatObjectAction").bind("click",function(e){var n=t.settings,i=n.overridenFields.Start_Date,a=$(this).offset().top;o.repeatObject(n.currentRecord.id,new Date(i),a)}),i.find(".copyObjectAction").bind("click",function(e){var i=t.settings;n.fireEvent(LoadActionStartEvent),r.copyObject(i.currentRecord.id,t.fields[0],t.pageBlock,t.settings.odn)}),i.find(".subobjectAction").bind("click",function(e){var n=$(e.currentTarget).data("objectname");r.createNewSubObject(t,n).then(function(){r.addNewObjectPageBlockAfterSave(t)})})})}};return l}]),speedupObjectDetailModule.factory("attachmentsService",["$q","$http","configService","dateTimeService","filesystemService","localizationService","eventManager",function(e,t,n,i,a,r,o){function l(e){t=a.getPluginImageUrl("JS/img/NoImage.jpg");var t="",n="",i=!1;return v.some(function(r){if(r.TemporaryObjectId==e&&"Pending"==r.Status){if(a.fileIsImageByExtension(r.fileExtension))return t=a.changeTmpImageUrl(r.FilePath,r.FileName,r.fileExtension),i=!0,!0}else n||(n=p.getIconImagesLarge(ext));return!1}),i||(t=n?n:a.getPluginImageUrl("JS/img/NoImage.jpg")),t}function c(e,t,n,i,a){var r=v.length;if(0==r)i.resolve();else{var o=v[a];void 0!=o&&null!=o&&o.TemporaryObjectId==n&&"Pending"==o.Status?s(e,t,n,o).then(function(o){a!=r&&(v[a].Status="Finished",a++,c(e,t,n,i,a))},function(){a++,c(e,t,n,i,a)}):(a++,r>a?c(e,t,n,i,a):i.resolve())}}function s(i,a,r,o){var l=e.defer(),c=n.getUrlBase("saveTemporaryAttachments")+"/"+f.token,s={ObjectDefinitionName:i,ObjectRecordId:a,OldTempId:r,fileName:o.FileName,OldFileName:o.FileName,FileExtension:o.fileExtension,token:f.token};return t.post(c,JSON.stringify(s)).success(function(e){l.resolve(e)}).error(function(){l.reject()}),l.promise}var d={rar:"Archive_RAR.png",zip:"Archive_ZIP.png",mp3:"Audio_MP3.png",bmp:"Image_BMP.png",gif:"Image_GIF.png",jpg:"Image_JPG.png",png:"Image_PNG.png",doc:"Office_DOC.png",docx:"Office_DOC.png",pdf:"Office_PDF.png",txt:"Office_TXT.png",xls:"Office_XLS.png",xlsx:"Office_XLS.png","default":"icon_unknown_32px.gif"},u={rar:"Large/rar.png",zip:"Large/rar.png",mp3:"Large/mp_3.png",doc:"Large/docx_win.png",docx:"Large/docx_win.png",pdf:"Large/pdf.png",txt:"Large/text.png",xls:"Large/xlsx_win.png",xlsx:"Large/xlsx_win.png",jpg:"Large/jpeg.png",jpeg:"Large/jpeg.png","default":"Large/default.png"},p=function(){},f=n.getGlobalConfig(),v=[];p.saveTemporaryAttachments=function(t,n,i){var a=e.defer(),r=0;return c(t,n,i,a,r),a.promise},p.wrapUploader=function(e,t,n,i,a){e.length&&!e.data("kendoUpload")&&e.kendoUpload({async:{saveUrl:"upload",autoUpload:!0},multiple:!1,localization:{select:r.translate("Buttons.SelectFile"),dropFilesHere:r.translate("Messages.dropfiles"),uploadSelectedFiles:r.translate("Buttons.Send")},select:function(e){p.fileUploaderSelect(e,n,t)},success:function(e){p.fileUploaderSuccess(e,n,t,i).then(function(e){angular.isFunction(a)&&a(e)})}})},p.getIconImages=function(e){var t=d[e];return t=t||d["default"],a.getImageIconUrl(t)},p.getIconImagesLarge=function(e){var t=u[e];return t=t||u["default"],a.getImageIconUrl(t)},p.fileUploaderSuccess=function(e,t,n,a){if(t&&t.toString().indexOf("Temp_")>-1&&void 0!=e.response.FileName&&null!=e.response.FileName){var r={TemporaryObjectId:t,FileName:e.response.FileName,fileExtension:e.response.FileExtension,Status:"Pending",FilePath:e.response.FilePath,CreatedDate:i.FormatDateAmPm(new Date)};v.push(r);var c=l(t);o.fireEvent(NewEntryAttachmentUploadedEvent,c)}return p.getAttachments(t,n).then(function(e){return a.attachments=e.attachments,a.attachments})},p.fileUploaderSelect=function(e,t,i){var a="",r="";$.each(e.files,function(e,t){a=t.name.substring(0,t.name.lastIndexOf(".")),console.log("Size: "+t.size+" bytes"),r=t.extension,r=r.substring(1,r.length)});var o="";o=t&&t.toString().indexOf("Temp_")>-1?n.getUrlBase("documentsAndAttachementsTemporary")+"/"+i+"/"+t+"/"+a+"/"+r+"/"+f.token+"?RequestType=ud":n.getUrlBase("documentsAndAttachments")+"/"+i+"/"+t+"/"+a+"/"+r+"/"+f.token+"?RequestType=ud",e.sender.options.async.saveUrl=o},p.removeFile=function(t,n,i){var a=e.defer(),o=r.translate("Messages.DeleteFile");if(confirm(o)){if(!(i&&i.toString().indexOf("Temp_")>-1))return m(t,i);g(t),a.resolve()}else a.reject("Cancelled by user");return a.promise},p.updateImage=function(e){var t="";if(e.length){var n,i=!1;e.some(function(e){return n=a.getFileExtension(e.ImageUrl),a.fileIsImageByExtension(n)?(t=a.changeImageUrl(e.ImageUrl),i=!0,!0):!1})}return t},p.updateImage_old=function(e){if(e.length){var t,n="",i="",r=!1;e.some(function(e){return t=a.getFileExtension(e.ImageUrl),a.fileIsImageByExtension(t)?(n=a.changeImageUrl(e.ImageUrl),r=!0,!0):(i||(i=p.getIconImagesLarge(t)),!1)}),r||(n=i?i:a.getPluginImageUrl("JS/img/NoImage.jpg"))}else n=a.getPluginImageUrl("JS/img/NoImage.jpg");return n},p.getAttachments=function(t,n){var i,a=e.defer(),r={addAttachment:!0,fileUploadId:"FileUpload"+n+"_"+t};return t.toString().indexOf("Temp")>-1?(i=b(t),void 0==i||null==i||0==i.length?r.attachments=[]:r.attachments=i,a.resolve(r)):h(t,n).then(function(e){void 0==e||null==e||0==e.length?(r.attachments=[],a.resolve(r)):a.resolve(e)}),a.promise};var m=function(t,i){var a=e.defer(),r=n.getUrlBase("deleteAttachment")+"/"+t+"/"+i+"/"+f.token+"?RequestType=df";return $.ajax({type:"GET",url:r,dataType:"json",success:function(e){e+="",-1!=e.indexOf("Success")?a.resolve():a.reject("Error deleting the attachment")},error:function(e,t,n){var i=e.getResponseHeader("ResponseCode");"UnAuthorized"==i?a.reject(e.getResponseHeader("ResponseCode")):a.reject(r+":=:"+e.status+" "+t+" "+n)}}),a.promise},g=function(e){for(var t=0;t<v.length;t++){var n=v[t];n.FileName==e&&(v[t].Status="Deleted")}},h=function(t,i){var r=e.defer();if(t){var o=[],l={attachments:o,fileUploadId:"FileUpload"+i+"_"+t,addAttachment:!0},c=f.postData;c.Clear(),c.RequestType="Attachments";var s=n.getUrlBase("documentsAndAttachments")+"/"+t+"/"+f.token;$.ajax({type:"GET",url:s,data:c,dataType:"json",success:function(e){e.length>0&&(o=[],$.each(e,function(e,n){0==n.FilePath.indexOf("~/")&&(n.FilePath=n.FilePath.substring(2));var r=n.FileName.substring(n.FileName.lastIndexOf(".")+1,n.FileName.length),l={ImageUrl:a.getImageUrl(n.FilePath+n.FileName),ImageName:n.FileName,iconPath:p.getIconImages(r.toLowerCase()),CreatedDate:n.CreatedDate,FileId:n.FileId,ObjectDefinitionName:i,recordId:t,Detail:"detailObject.. Why do we need it?"};o.push(l)}),l.attachments=o),r.resolve(l)},error:function(e,t,n){var i=e.getResponseHeader("ResponseCode");"UnAuthorized"==i?r.reject(e.getResponseHeader("ResponseCode")):r.reject(s+":=:"+e.status+" "+t+" "+n)}})}return r.promise},b=function(e){for(var t=[],n=0;n<v.length;n++){var i=v[n];if(i.TemporaryObjectId==e&&"Pending"==i.Status){var a=new Object;a.Comments="",a.ImageName=i.FileName+i.fileExtension,a.FileId=i.FileName,a.ObjectRecordId=e,a.ImageUrl=i.FilePath,a.CreatedDate=i.CreatedDate,t.push(a)}}return t};return p}]),CSVapp.factory("animationService",["filesystemService",function(e){var t=!1,n=!1,i=e.getPluginImageUrl("js/img/fullpageloader.GIF"),a=e.getPluginImageUrl("js/img/loader.gif"),r=function(){};return r.displayGlobalLoader=function(){if(!n){var e=$("<div id='globalLoader' class='_messagediv1 messagediv' style='z-index: 20005;'><img src='"+i+"' style='left: 45%;top: 50%; z-index: 20005; position: absolute;'/><div style='position: fixed; top: 0px; left: 0px; width: 100%; height: 100%; '></div><div class='statusMessage rb-a-4 _status'><span class='_message'></span></div></div>");n=!0,$(document.body).append(e)}},r.hideGlobalLoader=function(){n&&($("#globalLoader").remove(),n=!1)},r.displayInlineLoader=function(e){t||($('<img src="'+a+'" class="_inlineLoader" Height="15px" Width="15px">').insertAfter(e),t=!0)},r.hideInlineLoader=function(e){t&&($("._inlineLoader").remove(),t=!1)},r}]),speedupObjectDetailModule.factory("detailPageFieldService",["configService","autocompleteService","listDataLoaderService","dateTimeService","detailPageMapService","fieldPropertiesService","objectService","notificationService","localizationService","fieldService","existingObjectDetailService","detailPageFieldValuesService","animationService",function(e,t,n,i,a,r,o,l,c,s,d,u,p){function f(){}function v(e,t){var n=e.find("div[key='"+t+"']>._simpleBlock ");n&&n.addClass("disabled")}function m(e,t){var n={},i=g.dataTypes;switch(t){case i.GeoData:n.latField=e.find("._maplatfield").attr("id"),n.longField=e.find("._maplongfield").attr("id"),n.mapZoomField=e.find("._mapzoomfield").attr("id"),n.addressField=e.find("._mapaddressfield").attr("id"),n.mapTypeField=e.find("._maptypefield").attr("id"),n.mapDiv=e.find(".mapdiv").attr("id")}return n}var g=e.getGlobalConfig(),h=g.dataTypes;return f.disableEditors=function(e,t,n){$.each(e,function(e,i){var a=s.isFieldReadOnly(i.PropertyName);(i.SystemProperty&&"Name"!=i.PropertyName||a||t&&i.DataType==h.AutoText)&&v(n,i.PropertyName)})},f.updateRelatedField=function(e,t,n,i,a){var r=e.find('[key="'+a+'"]>._simpleBlock a');r.length&&r.html(t);var l;l=e.hasClass("ContentObject")?e.find("._detailsContent"):e.closest("._detailsContent");var c=l.attr("odn"),s=l.attr("recordId"),d=n+":"+t;o.saveObjectField(c,a,i,d,s,!0)},f.cancelInlineEditing=function(e,t,n,r){t.find("._editedElement").removeClass("_editedElement");var o=g.dataTypes,l=t.attr("dtype"),c=t.attr("key"),s=t.find("._hdnOldPropertyValue").val(),d={PropertyValue:s,DataType:l,UniqueKey:n},f=u.setValuesForElements(d,c);if(o.CheckBox==l)t.find("._simpleBlock input[type='checkbox']").prop("checked",1==d.PropertyValue);else if(o.RichTextBox==l)t.find("._simpleBlock").html(d.PropertyValue);else if(o.DateTime==l)t.find("._simpleBlock").text(i.DateTimeFormat(f.LabelValue));else if(o.Date==l)t.find("._simpleBlock").text(i.DateFormat(f.LabelValue));else if(o.GeoData==l){var v=m(t,l);r.find("#"+v.latField).val(f.Latitude),r.find("#"+v.longField).val(f.Longitude),r.find("#"+v.mapZoomField).val(f.MapZoom),r.find("#"+v.addressField).val(f.Address),r.find("#"+v.mapTypeField).val(f.MapType);var h=!1,b=!0,y=!1;t.find("._simpleBlock").text(f.Address),a.initializeMap(f.Latitude,f.Longitude,v.latField,v.longField,h,v.mapDiv,f.Address,v.addressField,v.mapZoomField,v.mapTypeField,f.MapZoom,f.MapType,b,y,!0)}else o.MultiObjectRelationshipField==l||o.ObjectRelationship==l||o.ParentRelationship==l?(t.find("._simpleBlock").find("._viewdetailObjectRelationship").text(f.ObjectName),t.find("#txt"+c).val(f.ObjectName),t.parent().find('[key="'+c+'"]').attr("title",f.PropertyValue)):t.find("._simpleBlock").text(f.LabelValue);var S=t.find("._editBlock"),k=t.find("._simpleBlock");S.removeClass("displayblock").addClass("displaynone"),k.removeClass("displaynone").addClass("displayblock"),r.find("._editBlock").removeClass("_editedElement"),p.hideInlineLoader(e)},f}]),speedupObjectDetailModule.factory("inlineFieldValueValidatorService",["configService",function(e){function t(e,t){var i,a;return t==n.dataTypes.Date?(i={rules:{dateValidation:function(e){return!!kendo.parseDate($(e).val())}}},a=e.find(".tbldetail").kendoValidator(i).data("kendoValidator")):t==n.dataTypes.DateTime?(i={rules:{dateTimeValidation:function(e){var t=/^\d{4}-\d{2}-\d{2}\s\d{2}:\d{2}:\d{2}$/,n=t.test($(e).val());return n?!!kendo.parseDate($(e).val()):n}}},a=e.find(".tbldetail").kendoValidator(i).data("kendoValidator")):a=e.find(".tbldetail").kendoValidator().data("kendoValidator"),a}var n=e.getGlobalConfig(),i=function(){};return i.performValidation=function(e,t){var n=!0,i=t.parent().find("._editBlock").find("input[type!='hidden']"),a=i.attr("v-type"),r=this.getValidator(e,a);return r&&(n=r.validateInput(i)),n},i.getValidator=function(e,n){var i;return i=e instanceof DetailPageBlock?e.contentObject.element:e,t(i,n)},i}]),speedupObjectDetailModule.factory("inlineFieldValueSaverService",["animationService","fieldPropertiesService","detailPageFieldValuesService","detailPageFieldService","objectService","localizationService","notificationService","configService",function(e,t,n,i,a,r,o,l){function c(t,n,l,c,u){var p=n.attr("key"),f=n.attr("dtype");e.displayInlineLoader(t);var v=d(n,l,c),m=v.PropertyValue;return s(m,n,f)||i.cancelInlineEditing(t,n,l,u),a.saveObjectField(c,p,v.PropertyDefinition_fk,v.PropertyValue,l,!0).then(function(e){if("Update Successfull."==e){n.find("._hdnOldPropertyValue").val(v.PropertyValue),i.cancelInlineEditing(t,n,l,u);var a=r.translate("Messages.RecordUpdatedSuccessfully");o.showNotification(a)}},function(e){o.showNotification(e,!0)})}function s(e,t,n){var i=t.find("._hdnOldPropertyValue");if(i.length){var a=i.val(),r=(""+e).trim(),o=a.trim();if(n==f.CheckBox)return!o&&e||!o&&e;if(n==f.ObjectRelationship){if(""==o&&":"==r||":"==o&&""==r)return!1}else if(n==f.MultiObjectRelationshipField){var l=r.split(":");if(""==a&&!l[0])return!1}if(r==o||!e&&!a&&(0!==e||0===parseInt(a))&&(""!==r&&null!==e||""===o))return!1}return!0}function d(e,i,a){var r,o=e.attr("key"),l=e.attr("dtype"),c={};if(i){r=t.getAllPropertiesOfSingleField(o,a);var s=null;void 0!=o&&null!=o&&""!=o&&(s=n.getElementsValue(e,l,o),c.PropertyValue=s),c.ObjectEntry_fk=i,c.PropertyDefinition_fk=r.PropertyDefinition_ID}return c}function u(e,t,a,r){var o=t.attr("key"),l=t.attr("dtype"),c=null;o&&(c=n.getElementsValue(t,l,o)),t.find("._hdnOldPropertyValue").val(c),i.cancelInlineEditing(e,t,a,r)}var p=l.getGlobalConfig(),f=p.dataTypes,v=function(){};return v.checkValueChanged=function(e,t,n){var i=e.closest("._keycontainer"),a=i.attr("dtype"),r=d(i,t,n),o=r.PropertyValue;return s(o,i,a)},v.saveData=function(e,t,n,i){var a=e.contentObject.element,r=e.fieldInEditMode;if(!r)return!1;var o=r.siblings("._editBlock"),l=a.find(o).closest("._keycontainer");return e.fieldInEditMode=null,null!=o&&("single"==i?c(o,l,t,n,a):"multiple"==i&&u(o,l,t,a)),!1},v}]),speedupObjectDetailModule.factory("fieldInlineEditService",["$rootScope","configService","animationService","fieldPropertiesService","detailPageFieldValuesService","dateTimeService","detailPageMapService","inlineFieldValueValidatorService","inlineFieldValueSaverService","detailPageFieldService","fieldService","existingObjectDetailService","objectDetailService",function(e,t,n,i,a,r,o,l,c,s,d,u,p){function f(e){var t=e.find("input"),n=e.siblings("._editBlock").find('input[type="checkbox"]');t.prop("checked")&&n.prop("checked")?(t.prop("checked",!1),n.prop("checked",!1)):(t.prop("checked",!0),n.prop("checked",!0))}function v(e,t,n,i,a,r){p.unSelectWidget(e);var o=t.index(e),l=r?0:t.length-1,c=!1;if(-1!=o)if(o==l){var s=r?i.getPrevBlock():i.getNextBlock();if(s&&s.id!=i.id){var d=i.getRootBlock(i);d.setRootAwareOfCurrent(s);var u=jQuery.Event("activatePageBlock");u.reverse=r,s.contentObject.element.trigger(u),$("html, body").animate({scrollTop:s.element.offset().top},1e3)}else e=r?t.last():t.first(),c=!0}else{var f=r?o-1:o+1;e=t.eq(f),c=!0}else!e&&t.length&&(c=!0,e=t[0]);return c&&(m(e,n,i,a),g(e).select(),p.selectWidget(e)),e}function m(e,t,n,a){var r=e.closest("._keycontainer"),l=n.contentObject.element;$(document).off("escPressed"),$(document).on("escPressed",function(t){var i=t?t.which:event.keyCode;if(27==i&&n.fieldInEditMode){a.selectedBlock=n.fieldInEditMode;var o=n.fieldInEditMode;y.activateSimpleBlock(n.fieldInEditMode),n.fieldInEditMode=null,s.cancelInlineEditing(e,r,n.settings.currentRecord.id,l),g(o)}});var c=r.attr("key");if(d.isFieldReadOnly(c))return r.css("cursor","not-allowed"),!1;var u=r.find("._hdnOldPropertyValue").val(),p=i.getAllPropertiesOfSingleField(c,t);if(p.PropertyName=c,p.PropertyValue=u,d.initEditorField(p,l),p.DataType==b.dataTypes.GeoData){var f=r.find("._maplatfield").attr("id"),v=r.find("._maplongfield").attr("id"),m=r.find("._mapzoomfield").attr("id"),h=r.find("._mapaddressfield").attr("id"),S=r.find("._maptypefield").attr("id"),k=r.find(".mapdiv").attr("id"),D=l.find("#"+f).val(),O=l.find("#"+v).val(),j=l.find("#"+m).val();j=1==$.isNumeric(j)?j:14;var T=!0,E=l.find("#"+h).val(),C=l.find("#"+S).val();C=void 0==C||"undefined"==C?"":C;var P=!0,F=!0;o.initializeMap(D,O,f,v,T,k,E,h,m,S,j,C,P,F,!1)}return r.find("._editBlock").removeClass("displaynone"),r.find("._editBlock").addClass("displayblock"),l.find("._editBlock").removeClass("_editedElement"),r.find("._editBlock").addClass("_editedElement"),$(e).removeClass("displayblock").addClass("displaynone"),n.fieldInEditMode=e,r.find("._editBlock input:text, ._editBlock textarea").first().focus(),!1}function g(e){var t=!1,n=e.siblings("._editBlock"),i=n.find('input[type!="hidden"]');if(i.length||(i=n.find("textarea")),!i.length&&(i=n.find("select"),i.length)){var a=i.data("kendoDropDownList");a&&(a.focus(),t=!0)}return t||i.focus(),i}function h(e,t){var n,a=e.closest("._keycontainer"),r=a.attr("key"),o=i.getAllPropertiesOfSingleField(r,t),l=a.find("._hdnOldPropertyValue").val(),c=l.split(":"),s=c[0];o.DataType==b.dataTypes.MultiObjectRelationshipField?n=c[3]:void 0!=o.InputSettings&&(c=o.InputSettings.split(":"),n=c[1]);var d={type:"popup"},p="Default";return u.displayObjectDetail(s,n,p,d,!1),!1}var b=t.getGlobalConfig(),y=function(){};return y.checkBlockIsCurrent=function(t){if(e.currentPageBlock&&e.currentPageBlock.id!=t.id){e.currentPageBlock=t;var n=jQuery.Event("activatePageBlock");t.contentObject.element.trigger(n)}},y.activateCurrentPageBlock=function(t,n,i,a){n.selectedBlock=a?i.last():i.first(),n.selectedBlock&&this.activateSimpleBlock(n.selectedBlock),e.currentPageBlock=t},y.tabPressed=function(e,t,n,i,a,r,o,d){this.deactivateAllSimpleBlocks(i.contentObject.element);var u=!0;if(e&&i.fieldInEditMode)if(c.checkValueChanged(i.fieldInEditMode,a,n))l.performValidation(i,i.fieldInEditMode)?c.saveData(i,a,n,r):u=!1;else{var p=i.contentObject.element,f=i.fieldInEditMode.closest("._keycontainer"),m=f.find("._editBlock");s.cancelInlineEditing(m,f,a,p)}return u&&(e=v(e,t,n,i,o,d)),e},y.enterPressed=function(e,t,n,i,a,r,o){var s,d,u=b.dataTypes,p=t.selectedBlock;if(p&&(s=p.closest("._keycontainer"),d=s.attr("dtype")),d==u.CheckBox)f(p);else if(d==u.TextBox);else if(n.fieldInEditMode)if(t.selectedBlock=p=n.fieldInEditMode,s=n.fieldInEditMode.closest("._keycontainer"),d=s.attr("dtype"),d==u.CheckBox){var g=s.find('._editBlock input[type!="hidden"]');f(g)}else l.performValidation(n,n.fieldInEditMode)&&(c.saveData(n,a,i,r),t.selectedBlock=v(p,o,i,n,t));else t.selectedBlock&&m(t.selectedBlock,i,n,t)},y.activateSimpleBlock=function(e){e.addClass("active")},y.deactivateAllSimpleBlocks=function(e){e.find("._simpleBlock").removeClass("active")},y.inlineClick=function(e,t,n,i,a,r){var o=e.hasClass("ContainerDiv")?e:e.closest(".ContainerDiv");o.find("._objRelButton").length&&t.fieldInEditMode&&o.find(".simpleBlock").is(t.fieldInEditMode)||(t.fieldInEditMode&&0==e.parents("._editBlock").length&&!e.hasClass("k-icon")||e.is("._savelink")?l.performValidation(t,t.fieldInEditMode)&&(c.saveData(t,i,n,a),e.hasClass("_simpleBlock")&&(r.selectedBlock=e,this.activateSimpleBlock(e))):!e.hasClass("disabled")&&e.is("._simpleBlock")?(m(e,n,t,r),this.deactivateAllSimpleBlocks(t.contentObject.element),r.selectedBlock=e):e.is("._viewdetailObjectRelationship")&&h(e,n))},y}]),speedupObjectDetailModule.factory("tabStripService",["attachmentsService","existingObjectDetailService","objectDetailService","objectDetailDisplayerService","tsHeaderSubObjectService",function(e,t,n,i,a){var r=function(){};return r.onSelectTab=function(t,n,i,r,o){var l=r.currentRecord.id,c=r.odn,s=$(n).find(i.item),d=i.sender.select();if(d.hasClass("_tabDetails")?o.hideChildren():s.hasClass("_tabDetails")&&o.showChildren(),s.hasClass("_tabAttachments"))t.attachments&&t.attachments.attachments||e.getAttachments(l,c).then(function(e){t.attachments=e});else if(s.hasClass("_subObjectTab")){var u=s.data().$scope.tab,p=angular.element(i.contentElement),f=p.find("._subObjectContent");a.createSubObjectPage(f,u.ObjectDefinitionName,"Default",l,u.PropertyName)}},r}]),speedupObjectDetailModule.directive("tabStrip",["$timeout","tabStripService","configService",function(e,t,n){var i={showAttachments:!0,addAttachment:!0,recordId:null,odn:null};return{templateUrl:function(e,t){return t.templateUrl||n.getTemplateUrl("TabStrip/TabStrip.html")},restrict:"EA",transclude:!0,replace:!0,controller:["$scope",function(e){e.tabStrip.settings=e.tabStrip.settings?angular.extend(i,e.tabStrip.settings):i,e.tabStrip.settings.showAttachments&&(e.tabStrip.attachments=e.tabStrip.attachments||[])}],link:{post:function(n,i){e(function(){i.kendoTabStrip({select:function(e){return t.onSelectTab(n.tabStrip,i,e,n.settings,n.pageBlock)},animation:!1,navigatable:!1}),i.find(".k-content").css("min-height",i.find("._detailsContent:first").height()),n.$on(AttachmentImageChangedEvent,function(e,t){i.find(".ContainerDiv.widen").removeClass("widen"),i.find(".ContainerDiv.hidden").removeClass("hidden"),i.find("._AttachmentImages>img").attr("src",t)})})}}}}]),speedupObjectDetailModule.directive("objectDetailAttachment",["$timeout","attachmentsService","notificationService","configService",function(e,t,n,i){return{templateUrl:function(e,t){return t.templateUrl||i.getTemplateUrl("TabStrip/ObjectDetailAttachmentTemplate.html")},restrict:"EA",transclude:!0,replace:!0,scope:{source:"=source",settings:"=settings"},controller:["$scope",function(e){e.removeFile=function(i,a,r){t.removeFile(i,a,r).then(function(){var n=[];e.source.attachments.forEach(function(e){e.FileId!=i&&n.push(e)}),e.source.attachments=n;var a=t.updateImage(e.source.attachments);a&&e.$emit(AttachmentImageChangedEvent,a)},function(e){n.showNotification(e,!0)})}}],link:function(n,i){var a=n.settings.odn,r=n.settings.recordId;n.$watch("source",function(o){o.addAttachment&&e(function(){var e=i.find("."+o.fileUploadId);t.wrapUploader(e,a,r,n.source,function(e){var i=t.updateImage(e);i&&n.$emit(AttachmentImageChangedEvent,i)})})})}}}]),speedupObjectDetailModule.factory("objectDetailService",["$q","$rootScope","$compile","$http","configService","schemaService","detailPageFieldValuesService","fieldPropertiesService","dateTimeService","filesystemService","objectService","objectDetailDisplayerService","localizationService","eventManager","relatedObjectsService","notificationService","attachmentsService","objectTemplateService",function(e,t,n,i,a,r,o,l,c,s,d,u,p,f,v,m,g,h){function b(e){return e.DefaultValue||(e.DefaultValue="59.332488979498976:18.06976318359375:"),e.Latitude||(e.Latitude="59.332488979498976"),e.Longitude||(e.Longitude="18.06976318359375"),e}function y(e){f.fireEvent(NewODActionButtonClicked),f.fireEvent(NewODCreated,e);var t=p.translate("Messages.RecordSavedSuccessfully");m.showNotification(t)}function S(e,t){return Math.floor(Math.random()*(t-e+1))+e}var k=a.getGlobalConfig(),D=function(){};return D.unSelectWidget=function(e){return this.selectWidget(e,!0)},D.selectWidget=function(e,t){var n,i=k.dataTypes,a=e.closest("._keycontainer"),r=a.attr("dtype");switch(r){case i.DropDownList:n=a.find("select").data("kendoDropDownList");break;case i.SearchableDropDownList:n=a.find("select").data("kendoComboBox");break;case i.Date:n=a.find('input[type!="hidden"]').data("kendoDatePicker");break;case i.DateTime:n=a.find('input[type!="hidden"]').data("kendoDateTimePicker")}n&&(t?n.close():n.open())},D.generateTmpId=function(e){for(var t=8,n=+new Date,i=n.toString(),a=i.split("").reverse(),r="",o=0;t>o;++o){var l=S(0,a.length-1);r+=a[l]}return"Temp_"+e+"_"+r},D.openRelationalRecordPopup=function(e,t,n,i){var a=k.dataTypes,r=e.closest("._keycontainer"),o=r.attr("key"),l=null;t.some(function(e){return e.PropertyName==o?(l=e,!0):!1});var c,s,d=null,u=l.InputSettings,p=r.attr("dtype");p==a.MultiObjectRelationshipField?(d=$(r).find("#ddl"+o).data("kendoDropDownList"),c=d.text()):(u=u.split(":"),u.length>0&&(s=u[0],c=u[1]));var f=c;v.openRelatedObjectPopup(o,f,s,r,n,i,function(e){var t=e.ObjectEntry_ID,n=e.Name,i=t+":"+n;p.MultiObjectRelationshipField==p&&null!=d&&(i=i+":"+d.value()+":"+d.text()),$(r).find("#txt"+o).val(n)})},D.createNewObject=function(e,t,n,i){var a={odn:e,recordId:null,fieldEditMode:"multiple",pageSize:5,displayMode:{type:"popup"},editMode:"detail"};return t&&(a.currentRecord={id:t,name:n,fk:i}),D.addNewRecord(e,a).then(function(e){f.addListener(NewODActionButtonClicked,function(){e.onClose(function(){f.disposeListeners(a)}),e.close()},a)})},D.addNewRecord=function(e,t,n){n=n||p.translate("Headers.NewDetailTitle"),t.isNewEntry=!0;var i=D.getNewDetailPageBlockPromise(e,t);return i.then(function(e){var i=u.getDisplayer(t.displayMode);return i.getDetailViewNew(n,e),i})},D.afterCreateNewRecord=function(e,t,n){var i=e.parent().find("#hdnTempId");if(i.length){var a=i.val(),r=jQuery.parseJSON(n.SavedData),o=r[0].ObjectEntry_ID;g.saveTemporaryAttachments(t,o,a).then(function(){g.getAttachments(o,t).then(function(e){if(e&&e.attachments){var t=g.updateImage(e.attachments);t&&(n.image=t)}y(n)},function(){y(n)})})}else y(n)},D.saveNewRecord=function(e,t){var n=k.userName;return D.getEditedObjectData(e,t,n).then(function(e){return e[0].ObjectEntry_ID=null,e[0].CreatedBy=n,e[0].CreatedDate=c.DateTimeFormat(new Date),d.saveObject(e,t,!0)})},D.getEditedObjectData=function(e,t,n){return r.EmptySchema(t).then(function(t){return e.find("._tbldetail ._keycontainer").each(function(){var e=$(this).attr("key"),n=$(this).attr("dtype"),i=$(this),a=null;void 0!=e&&null!=e&&""!=e&&null!=n&&(a=o.getElementsValue(i,n,e),t[0][e]=void 0!=a&&null!=a?$.trim(a.toString()):a)}),t[0].ObjectDefinition_fk=void 0,t[0].oeIsDeleted=void 0,t[0].oeOrganizationID=void 0,t[0].oeOwnerID=void 0,t[0].oePortalID=void 0,t[0].RowNum=void 0,t[0].OrganizationID=void 0,t[0].OwnerID=void 0,t[0].PortalID=void 0,t[0].RecordType=void 0,t[0].IsDeleted=void 0,t[0].ChangedBy=n,t})},D.getNewDetailScope=function(e,n){var i=D.getFieldsForNewDetail(e,n),a=D.getEmptyTabStripObject();return i.then(function(n){return r.createPageTitle(e).then(function(e){var i=t.$new();return i.fields=n,i.tabStrip=a,i.objectName=e,i})})},D.getNewDetailPageBlockPromise=function(e,t){var i,a=t.editMode;return i="edit"==a?angular.element("<new-object-edit></new-object-edit>"):angular.element("<new-object-detail></new-object-detail>"),D.getNewDetailScope(e,t).then(function(e){var a=new DetailPageBlock(t),r=new ContentObject;return e.pageBlock=a,e.settings=t,r.content=n(i)(e),r.scope=e,a.contentObject=r,a})},D.GetEmptyDataItem=function(e,t){return r.EmptySchema(e).then(function(n){t=t||{};var i=[];i.Maps=new Array,i.Summary=new Array;var a=Object.getOwnPropertyNames(n[0]),r=l.getAllPropertiesOfFieldsArray(a,e);return $.each(r,function(n,a){var r=a.PropertyName;if(null!=a&&void 0!=a.PropertyLabel){if("CreatedDate"==r||"ChangedDate"==r||(a.DataType==k.dataTypes.Date?a.DefaultValue="":a.DataType==k.dataTypes.DateTime?a.DefaultValue=c.DateTimeFormat(new Date):a.DataType==k.dataTypes.Time&&(a.DefaultValue=kendo.toString(new Date,"HH:mm"))),t.overridenFields&&t.overridenFields.odn==e&&t.overridenFields[a.PropertyName]?a.PropertyValue=t.overridenFields[a.PropertyName]:a.PropertyValue=a.DefaultValue,(a.DataType==k.dataTypes.ParentRelationship||a.DataType==k.dataTypes.ObjectRelationship||a.DataType==k.dataTypes.MultiObjectRelationshipField)&&t.currentRecord&&t.currentRecord.id&&a.InputSettings){var l=a.InputSettings.split(":");l[0]&&t.currentRecord.fk&&l[0]==t.currentRecord.fk&&(a.PropertyValue=t.currentRecord.id+":"+t.currentRecord.name)}a.PropertyName=r,a.UniqueKey=t.recordId,a=o.setValuesForElements(a,r),a.DataType==k.dataTypes.GeoData?(b(a),i.Maps.push(a)):a.DataType==k.dataTypes.Summary?i.Summary.push(a):i.push(a)}}),i.ImageUrl=s.getPluginImageUrl("JS/img/NoImage.jpg"),i})},D.getFieldsForNewDetail=function(e,t){return D.GetEmptyDataItem(e,t).then(function(t){return h.getObjectTemplate(e).then(function(e){var n="";e&&e[0]&&e[0].SelectedColumnsForTemplate&&(n=e[0].SelectedColumnsForTemplate);var i=r.FilterFieldsSelected4Template(t,n),a=[i];return a[0].Maps=t.Maps,a[0].Summary=t.Summary,a[0].ImageUrl=t.ImageUrl,a[0].DisplaySaveRecordButton=!0,a})})},D.getEmptyTabStripObject=function(){return{settings:{showAttachments:!1,addAttachment:!1,recordId:null,displaySubObjectRecordAddButton:!1},tabs:[],attachments:[]}},D}]),speedupObjectDetailModule.factory("detailPageFieldValuesService",["configService","dateTimeService","schemaService",function(e,t,n){var i=e.getGlobalConfig(),a=function(){};return a.setValuesForElements=function(e,t){var a=i.dataTypes,r="",o="",l="",c="",s="",d="",u="";switch(e.LabelValue=void 0!=e.PropertyValue&&null!=e.PropertyValue?$.trim(e.PropertyValue.toString()):"",e.DataType){case a.GeoData:var p=null!=e.PropertyValue?e.PropertyValue.split(":"):"";p.length>0&&(r=void 0==p[0]?"":p[0],o=void 0==p[1]?"":p[1],l=void 0==p[2]?"":p[2],c=void 0==p[3]?"":p[3],s=void 0==p[4]?"":p[4]),e.Latitude=r,e.Longitude=o,e.Address=l,e.MapZoom=c,e.MapType=s,e.Mapdiv=n.UniqueId("mapdiv"+e.UniqueKey+t),e.LatField="txtLat"+e.UniqueKey+t,e.LongField="txtLong"+e.UniqueKey+t,e.AddressField="txtAdd"+e.UniqueKey+t,e.MapTypeField="hdnMapType"+e.UniqueKey+t,e.MapZoomField="hdnZoom"+e.UniqueKey+t,e.LabelValue=l;break;case a.ObjectRelationship:var f=null!=e.PropertyValue?e.PropertyValue.split(":"):"";f.length>0&&(d=void 0==f[0]?"":f[0],u=void 0==f[1]?"":f[1]),
e.ObjectId=d,e.ObjectName=u,e.LabelValue=u;break;case a.ParentRelationship:var f=null!=e.PropertyValue?e.PropertyValue.split(":"):"";f.length>0&&(d=void 0==f[0]?"":f[0],u=void 0==f[1]?"":f[1]),e.ObjectId=d,e.ObjectName=u,e.LabelValue=u;break;case a.MultiObjectRelationshipField:var f=null!=e.PropertyValue?e.PropertyValue.split(":"):"";f.length>0&&(d=void 0==f[0]?"":f[0],u=void 0==f[1]?"":f[1]),e.ObjectId=d,e.ObjectName=u,e.LabelValue=u;break;case a.TableRelationship:var f=null!=e.PropertyValue?e.PropertyValue.split(":"):"";f.length>0&&(d=void 0==f[0]?"":f[0],u=void 0==f[1]?"":f[1]),e.ObjectId=d,e.ObjectName=u,e.LabelValue=u}return e},a.getElementsValue=function(e,n,a){var r=e,o=null,l=null,c=i.dataTypes;switch(n){case c.DateTime:o=r.find("#txtdateTime"+a).data("kendoDateTimePicker"),l=void 0==o||null==o?void 0:t.DateTimeFormat(o.value());break;case c.Date:o=r.find("#txtdate"+a).data("kendoDatePicker"),l=void 0==o||null==o?void 0:t.DateFormat(o.value());break;case c.Time:o=r.find("#txttime"+a).data("kendoTimePicker"),l=void 0==o||null==o?void 0:kendo.toString(o.value(),"HH:mm");break;case c.GeoData:var s,d,u,p,f,v=":";s=r.find("._maplatfield").val(),d=r.find("._maplongfield").val(),u=r.find("._mapaddressfield").val(),f=r.find("._maptypefield").val(),p=r.find("._mapzoomfield").val(),l=void 0!=s&&null!=s?s+v+d+v+u+v+p+v+f:void 0;break;case c.URL:l=r.find("#txt"+a).val();break;case c.CheckBox:l=r.find("#chk"+a).is(":checked"),l=1==l?1:0;break;case c.RichTextBox:o=r.find("#richtxt"+a).data("kendoEditor"),l=void 0==o||null==o?void 0:o.value();break;case c.Email:l=r.find("#txt"+a).val();break;case c.DropDownList:o=r.find("#"+a).data("kendoDropDownList"),l=void 0==o||null==o?void 0:o.value();break;case c.MultiSelectList:o=r.find("#"+a).data("kendoMultiSelect"),l=void 0==o||null==o?void 0:o.value().join(",");break;case c.SearchableDropDownList:o=r.find("#"+a).data("kendoComboBox"),l=void 0==o||null==o?void 0:o.value();break;case c.NumericText:o=r.find("#txtNum"+a).data("kendoNumericTextBox"),l=void 0==o||null==o?void 0:o.value();break;case c.Numeric:o=r.find("#txtNum"+a).data("kendoNumericTextBox"),l=void 0==o||null==o?void 0:o.value();break;case c.ObjectRelationship:var m=r.find("#hdn"+a).val(),g=r.find("#txt"+a).val();l=void 0!=m?m+":"+g:void 0;break;case c.ParentRelationship:var m=r.find("#hdn"+a).val(),g=r.find("#txt"+a).val();l=void 0!=m?m+":"+g:void 0;break;case c.MultiObjectRelationshipField:var m=r.find("#hdn"+a).val(),g=r.find("#txt"+a).val(),h=r.find("#ddl"+a).data("kendoDropDownList"),b=null!=h?h.value():void 0,y=null!=h?h.text():void 0;l=void 0!=m?m+":"+g+":"+b+":"+y:void 0;break;default:l=r.find("#txt"+a).val()}return l},a}]),speedupObjectDetailModule.factory("existingObjectDetailService",["$q","$rootScope","$compile","$http","configService","schemaService","detailPageFieldValuesService","objectDataService","fieldPropertiesService","filesystemService","attachmentsService","objectDetailService","objectDetailDisplayerService","eventManager","notificationService","localizationService","objectTemplateService",function(e,t,n,i,a,r,o,l,c,s,d,u,p,f,v,m,g){function h(e,t,n,i,a,r){b(e,t,n,i,a,r).then(function(o){return!o||i>o?null:(a++,void h(e,t,n,i,a,r))})}function b(e,t,n,i,a,r){return D(e,t,n,i,a).then(function(t){if(!t)return null;var n=r.settings,a=y(t,e,i,n);return a.length?S(a,r).then(function(){return t.length}):null},function(){})}function y(e,t,n,i){var a=[];return e.forEach(function(e){var r=e.ObjectEntry_ID,o={odn:t,recordId:r,fieldEditMode:"single",displayMode:{type:"popup"},editMode:"detail",pageSize:n,currentRecord:{id:e.ObjectEntry_ID,name:e.Name,fk:e.ObjectDefinition_fk}};i.overridenFields&&(o.overridenFields=i.overridenFields),a.push(C.createDetailPageBlock(o,e).then(function(e){return C.appendSubObjects(e).then(function(){return e})}))}),a}function S(e,t){var n=e.shift();return e.forEach(function(e){n=n.then(function(n){return n&&t.appendChildBlock(n),e})}),n.then(function(e){return e&&t.appendChildBlock(e),f.fireEvent(LoadActionEndEvent),t})}function k(e,t,n){return g.getObjectTemplate(e).then(function(i){var a="";i&&i[0]&&i[0].SelectedColumnsForTemplate&&(a=i[0].SelectedColumnsForTemplate);var r=[];a.split(",").forEach(function(e){""!=e&&r.push(e.replace(/[[\]]/g,""))});var o=c.getAllPropertiesOfFieldsArray(r,e),l=T(o,n,t),s=[l.data];s[0].Maps=l.maps||[],s[0].Summary=l.summary||[];var d=C.getAttachmentImage(n);return d&&(s[0].ImageUrl=d),s})}function D(e,t,n,i,a){var r=t?" ["+t+"] Like '"+n+":%' ":"";return l.fetchObjects(e,i,a,r)}function O(e,t){return g.getObjectTemplate(e).then(function(n){var i;return t=t||"RelatedObjectUnderMainRecord",i=n&&n[0]&&n[0][t]?n[0][t]:null,l.getSubObjects(e,i,!0)})}function j(e){return g.getObjectTemplate(e).then(function(t){var n;return n=t&&t[0]&&t[0].SelectedRelatedObjectsForTemplate?t[0].SelectedRelatedObjectsForTemplate:null,l.getSubObjects(e,n)})}function T(e,t,n){var i,a,r={maps:[],summary:[],data:[]};return e.forEach(function(e){if(i=e.PropertyName,a=t[i],e&&e.PropertyLabel&&void 0!=a){if(e.DataType==E.dataTypes.DateTime){var l=kendo.parseDate(a);l&&(a=kendo.toString(l,"yyyy-MM-dd HH:mm:ss"))}e.PropertyValue=a,e.ObjectEntry_fk="",e.InlineEdit=!1,e.UniqueKey=n,e=o.setValuesForElements(e,i),e.DataType==E.dataTypes.GeoData?r.maps.push(e):e.DataType==E.dataTypes.Summary?r.summary.push(e):r.data.push(e)}}),r}var E=a.getGlobalConfig(),C=function(){};return C.displayObjectDetail=function(e,t,n,i,a){var r={odn:t,recordId:e,fieldEditMode:"single",pageSize:5,displayMode:n,editMode:"detail"};i&&(r.overridenFields=i),C.getObjectsWithSubObjects(r,a)},C.getObjectsWithSubObjects=function(e,t){return C.createDetailPageBlock(e).then(function(n){return r.createPageTitle(e.odn).then(function(i){var a=p.getDisplayer(e.displayMode);return a.getDetailView(i,n),t||C.appendSubObjects(n),a})},function(){f.fireEvent(LoadActionEndEvent);var e=m.translate("Messages.FailedToLoadData");v.showNotification(e,!0)})},C.appendSubObjects=function(t){var n=t.settings,i=n.odn,a=n.pageSize,r=n.recordId,o=n.subObjectsField;return O(i,o).then(function(n){return $.isArray(n)&&n.length?void n.forEach(function(e){var n=e.ObjectDefinitionName,i=e.PropertyName,o=0;h(n,i,r,a,o,t)}):e.when("noObj")})},C.createDetailPageBlock=function(i,a){return f.fireEvent(LoadActionStartEvent),r.getSchema(i.odn).then(function(){return g.getObjectTemplate(i.odn).then(function(){var o=i.odn,l=i.recordId,c=new DetailPageBlock(i),s=[C.getActionsListPromise(o),C.getTabStripTabsPromise(o,l),C.getDetailPageTemplate(),r.createPageTitle(o),C.getFieldsPromise(o,l,i,a)];return e.all(s).then(function(e){var a=t.$new();a.fields=e[4],a.actions=e[0],a.tabStrip=e[1];var r=e[2];a.objectType=e[3],a.settings=i,a.pageBlock=c;var o=new ContentObject;return n(r)(a),o.content=r,c.contentObject=o,f.fireEvent(LoadActionEndEvent),c})})})},C.getFieldsPromise=function(e,t,n,i){return i?k(e,t,i):l.fetchSingleObjectData(t,e).then(function(i){if(!i)throw new NoDataException("Failed to get data from server");return n.currentRecord={id:i.ObjectEntry_ID,name:i.Name,fk:i.ObjectDefinition_fk},k(e,t,i)})},C.getAttachmentImage=function(e){var t="";e&&e[SUConstants.RecordFirstImageColumn]&&(t=e[SUConstants.RecordFirstImageColumn]);var n;if(s.isImageUrlAbsolute(t))n=t;else if(t){var i=s.getFileExtension(t);s.fileIsImageByExtension(i)&&(n=s.changeImageUrl(t))}return n},C.getAttachmentImage_old=function(e){var t="";e&&e[SUConstants.RecordFirstImageColumn]&&(t=e[SUConstants.RecordFirstImageColumn]);var n;if(s.isImageUrlAbsolute(t))n=t;else if(t){var i=s.getFileExtension(t);s.fileIsImageByExtension(i)?n=s.changeImageUrl(t):(n=d.getIconImagesLarge(i),n||(n=s.getPluginImageUrl("JS/img/NoImage.jpg")))}else n=s.getPluginImageUrl("JS/img/NoImage.jpg");return n},C.getActionsListPromise=function(e){return g.getObjectTemplate(e).then(function(t){var n;return t&&t[0]&&t[0].SelectedRelatedObjectsForTemplate?(n=t[0].SelectedRelatedObjectsForTemplate,t[0].RelatedObjectUnderMainRecord&&(n+=t[0].RelatedObjectUnderMainRecord)):n=null,l.getSubObjects(e,n).then(function(t){var n={subObjects:t};return"Work_Order_Detail"==e&&(n.objectRepeatable=!0),n})})},C.getTabStripTabsPromise=function(e,t){return j(e).then(function(n){return{settings:{showAttachments:!0,addAttachment:!0,recordId:t,displaySubObjectRecordAddButton:!0,attachmentId:"attachmentContent"+e+"_"+t,odn:e},tabs:n,attachments:[]}})},C.getDetailPageTemplate=function(){var t=e.defer(),n=a.getTemplateUrl("ObjectDetail/ExistingObjectDetail.html");return i.get(n).success(function(e){t.resolve(angular.element(e))}).error(function(){t.reject("Error loading template "+n)}),t.promise},C}]),speedupObjectDetailModule.directive("odDetailsBlock",["configService","dateTimeService","filesystemService","objectDetailService","detailPageFieldService","eventManager","notificationService","localizationService","fieldService","detailPageMapService","fieldInlineEditService","fieldPropertiesService",function(e,t,n,i,a,r,o,l,c,s,d,u){return{templateUrl:function(t,n){return n.templateUrl||e.getTemplateUrl("ObjectDetail/DetailsBlock.html")},restrict:"EA",transclude:!0,replace:!0,controller:function(e,i,a,r){if(e.fields&&e.fields.length){var o=angular.element("#odDetailsBlock",i),l=kendo.template(o.html());e.fields[0].helpers={dateTimeFormat:t.DateTimeFormat,dateFormat:t.DateFormat,getPluginImageUrl:n.getPluginImageUrl};var c=kendo.render(l,e.fields);i.html(c)}},link:function(t,n){if(t.fields&&t.fields.length){var l=e.getGlobalConfig(),p=l.dataTypes,f=t.settings.odn,v=t.settings.recordId,m=t.settings.fieldEditMode,g=t.pageBlock,h=g.contentObject.element;setTimeout(function(){g.setRootAwareOfCurrent(g,!0);var e=g.getRootBlock(g);g.id==e.currentPageBlock.id&&(d.activateCurrentPageBlock(g,t,b,!1),$(document).on("activateFirstPageBlock",function(e){g.getRootBlock(g);d.activateCurrentPageBlock(g,t,b,!1)}))},1e3);var b=h.find(".simpleBlock").filter(function(e,t){var n=$(t).closest("._keycontainer"),i=$(n).attr("key");if(i&&-1!=i.indexOf("empty"))return!1;var a=u.getAllPropertiesOfSingleField(i,f);return angular.isObject(a)&&a.DataType&&a.DataType==p.GeoData?!1:!c.isFieldReadOnly(i)});c.initializeEditors(t.fields[0],n);var y=t.settings.isNewEntry||!1;a.disableEditors(t.fields[0],y,n),t.fields[0].Maps&&setTimeout(function(){s.createMaps(t.fields[0].Maps)},2e3),h.find(".detailPageMainBlock").click(function(e){var i=n.find(e.target);d.checkBlockIsCurrent(g),d.inlineClick(i,g,f,v,m,t)}),h.on("detailKeypress",function(e){var i=e.keyCode||e.which;if(9==i)e.preventDefault(),t.selectedBlock=d.tabPressed(t.selectedBlock,b,f,g,v,m,t);else if(13==i){var a=n.find(e.target);d.enterPressed(a,t,g,f,v,m,b)}else 169==i&&(e.preventDefault(),t.selectedBlock=d.tabPressed(t.selectedBlock,b,f,g,v,m,t,!0))}),h.on("activatePageBlock",function(e){var n=g.getRootBlock(g);g.id==n.currentPageBlock.id&&d.activateCurrentPageBlock(g,t,b,e.reverse)}),t.fields[0].DisplaySaveRecordButton&&(h.find("._btnCreateRecord").one("click",function(e){return r.fireEvent(LoadActionStartEvent),i.saveNewRecord(h,f).then(function(e){r.fireEvent(LoadActionStartEvent),i.afterCreateNewRecord(n,f,e)},function(e){r.fireEvent(LoadActionStartEvent),o.showNotification(e,!0)})}),h.find("._btnCancelCreateRecord").bind("click",function(){r.fireEvent(NewODActionButtonClicked)})),h.find("._objRelButton").click(function(e){var n=angular.element(e.currentTarget),a=n.closest("._editBlock"),r=a.find('input[id^="txt"]').val(),o=g.element.offset().top+50+"px";return i.openRelationalRecordPopup(n,t.fields[0],r,o),!1}),h.find(".getAddressLink").click(function(){var e=t.fields[0].Maps[0];s.getAddressFromLatLong(e.LatField,e.LongField,e.AddressField,e.Mapdiv,e.MapZoomField,e.mapTypeField)}),h.find(".getLatLongLink").click(function(){var e=t.fields[0].Maps[0];s.getLatLongFromAddress(e.LatField,e.LongField,e.AddressField,e.Mapdiv,e.MapZoomField,e.mapTypeField)}),h.find(".getCurrentLocationLink").click(function(){var e=t.fields[0].Maps[0];s.getCurrentLocation(e.LatField,e.LongField,e.AddressField,e.Mapdiv,e.MapZoomField,e.mapTypeField)}),r.addListener(ObjectDetailFieldUpdatedEvent,function(e){a.updateRelatedField(e.container,e.value,e.propertyId,e.propertyFk,e.propertyName)},g.settings),r.addListener(NewEntryAttachmentUploadedEvent,function(e){e&&n.find(".attachmentImages img").attr("src",e)},g.settings)}}}}]).directive("newObjectDetail",["$timeout","configService","attachmentsService","objectDetailService",function(e,t,n,i){return{templateUrl:t.getTemplateUrl("ObjectDetail/CreateNewObjectDetail.html"),restrict:"EA",replace:!0,link:function(t,a,r,o,l){e(function(){var e=a.find("._recordAttachment");if(e.length){var r=t.settings.odn,o=i.generateTmpId(r);a.find("#hdnTempId").val(o),n.wrapUploader(e,r,o,[])}},500)}}}]),speedupObjectDetailModule.factory("repeatActionService",["$q","$rootScope","$compile","$modal","localizationService","objectService","notificationService","popupService",function(e,t,n,i,a,r,o,l){function c(e,t,n){var i={};i.ObjectEntry_ID=t;var a=e.find("#repeatType").val();if(i.RepeatType=a,i.RepeatFrequency=e.find("#"+a+"RepeatEveryNumeric").val(),"weekly"==a){var o=new Array;e.find("input[name='weeklyRepeatOn[]']:checked").each(function(e,t){o.push($.objectLanguage.DaysOfWeekCap[$(t).val()].key)}),o.length&&(i.RepeatOn=o.join(","))}else if("monthly"==a){var l=e.find("input:radio[name ='monthlyRepeatBy']:checked").val();"dayOfWeek"==l?i.RepeatBy="dayOfWeek":"dayOfMonth"==l&&(i.RepeatBy="dayOfMonth")}i.StartsOn=e.find("#weeklyStartOnDatePicker").val(),i.StartsOn!=kendo.toString(n,"yyyy-MM-dd")?i.UseStartDateInWeekly="true":i.UseStartDateInWeekly="false";var c=e.find("input:radio[name ='"+a+"RepeatEnd']:checked").val();return"After"==c?i.RepeatCount=e.find("#"+a+"RepeatEndAfterNumeric").val():"On"==c&&(i.RepeatEndDate=e.find("#"+a+"EndOnDatePicker").val()),i.FieldsToUpdate="Start_Date",i.FieldsToCalculate=["End_Date:Start_Date"],r.repeatObject(i)}var s=function(){};return s.repeatObject=function(e,i,r){var s="<event-recurrence></event-recurrence>",d=new Date(i);d.addMonths(1);var u=a.translate("RepeatTypes"),p=[];if(1==kendo.culture().calendar.firstDay){for(var f=1;6>=f;f++)p.push($.objectLanguage.DaysOfWeekCap[f].one);p.push($.objectLanguage.DaysOfWeekCap[0].one)}else for(var f=0;6>=f;f++)p.push($.objectLanguage.DaysOfWeekCap[f].one);var v=t.$new();v.defaultRepeatType="weekly",v.day=i.getDay(),v.startDate=i,v.endDate=d,v.repeatTypes=u,v.daysOfWeek=p;var m=n(s)(v);l.confirmWithContent(a.translate("Titles.RepeatObject"),m,{top:r}).then(function(){c(m,e,i).then(function(){var e=a.translate("Messages.RepeatAddedToQueue");o.showNotification(e)},function(){var e=a.translate("Messages.EventRepeatFailed");o.showNotification(e,!0)})})},s.initFields=function(e,t,n,i,r){e.find("#repeatType").kendoDropDownList({dataTextField:"text",dataValueField:"value",dataSource:a.translate("RepeatTypes"),index:0,change:function(t){t.sender.value()!=t.sender.old&&(e.find(".repetableSettingsBlock").hide(),e.find("#"+t.sender.value()+"Block").show())}}),t.forEach(function(t){e.find("#"+t.value+"RepeatEveryNumeric").kendoNumericTextBox({format:"n0",value:1,min:1,max:30,step:1}),e.find("#"+t.value+"StartOnDatePicker").kendoDatePicker({value:n,min:n,parseFormats:["MM-dd-yyyy"],change:function(){var t,n=this,i=n.value();e.find("input[id$='StartOnDatePicker']").each(function(a,r){t=e.find(r).data("kendoDatePicker"),t!=n&&t.value(i)})}}),e.find("#"+t.value+"EndOnDatePicker").kendoDatePicker({value:i,min:n,parseFormats:["MM-dd-yyyy"],change:function(){var t,n=this,i=n.value();e.find("input[id$='EndOnDatePicker']").each(function(a,r){t=e.find(r).data("kendoDatePicker"),t!=n&&t.value(i)})}}),e.find("#"+t.value+"RepeatEndAfterNumeric").kendoNumericTextBox({format:"n0",value:1,min:1,max:30,step:1})}),e.find("#"+r+"Block").show()},s}]),speedupObjectDetailModule.directive("eventRecurrence",["$timeout","configService","repeatActionService",function(e,t,n){return{templateUrl:function(e,n){return n.templateUrl||t.getTemplateUrl("ObjectRecurrence/ObjectRecurrence.html")},restrict:"EA",replace:!0,link:function(t,i){e(function(){n.initFields(i,t.repeatTypes,t.startDate,t.endDate,t.defaultRepeatType)})}}}]),speedupObjectDetailModule.directive("oeDetailsBlock",["$rootScope","configService","localizationService","filesystemService","objectDetailService","detailPageMapService","eventManager","fieldService","objectEditService","fieldInlineEditService","fieldPropertiesService",function(e,t,n,i,a,r,o,l,c,s,d){return{templateUrl:function(e,n){return n.templateUrl||t.getTemplateUrl("ObjectEdit/ObjectEdit.html")},restrict:"EA",transclude:!0,replace:!0,controller:function(e,t,n,a){if(e.fields&&e.fields.length){var r=angular.element("#oeDetailsBlock",t),o=kendo.template(r.html());e.fields[0].helpers={getPluginImageUrl:i.getPluginImageUrl};var l=kendo.render(o,e.fields);t.html(l)}},link:function(n,i){if(n.fields&&n.fields.length){var s=t.getGlobalConfig(),u=s.dataTypes,p=n.settings.odn,f=n.pageBlock,v=f.contentObject.element,m=v.find("._keycontainer").filter(function(e,t){var n=$(t).attr("key"),i=d.getAllPropertiesOfSingleField(n,p);return angular.isObject(i)&&i.DataType&&(i.DataType==u.GeoData||i.DataType==u.AutoText)?!1:!l.isFieldReadOnly(n)});c.activateSimpleBlock(m.first()),n.selectedBlock=m.first(),e.currentPageBlock=f,v.click(function(e){c.deactivateAllSimpleBlocks($(this));var t=i.find(e.target),a=t.closest("._keycontainer");a.length&&(n.selectedBlock=a)}),v.on("detailKeypress",function(e){var t=e.keyCode||e.which;9==t?(e.preventDefault(),n.selectedBlock=c.tabPressed(n.selectedBlock,f,m)):13==t?n.selectedBlock=c.enterPressed(n.selectedBlock,f,m):169==t&&(e.preventDefault(),n.selectedBlock=c.tabPressed(n.selectedBlock,f,m,!0))}),setTimeout(function(){r.createMaps(n.fields[0].Maps)},2e3),l.initializeEditors(n.fields[0],i);var g=n.settings.isNewEntry||!1;c.disableEditors(n.fields[0],g,i),v.find("._objRelButton").click(function(e){var t=angular.element(e.currentTarget),i=t.parent().find('input[id^="txt"]').val();return a.openRelationalRecordPopup(t,n.fields[0],i),!1}),v.find("._saveObjectButton").bind("click",function(e){var t=i.find(".tbldetail").kendoValidator().data("kendoValidator");t.validate()&&($(this).unbind("click"),c.saveObject(i,p,v))}),v.find("._cancelObjectButton").bind("click",function(){o.fireEvent(NewOEActionButtonClicked)}),v.find(".getAddressLink").click(function(){var e=n.fields[0].Maps[0];r.getAddressFromLatLong(e.LatField,e.LongField,e.AddressField,e.Mapdiv,e.MapZoomField,e.mapTypeField)}),v.find(".getLatLongLink").click(function(){var e=n.fields[0].Maps[0];r.getLatLongFromAddress(e.LatField,e.LongField,e.AddressField,e.Mapdiv,e.MapZoomField,e.mapTypeField)}),v.find(".getCurrentLocationLink").click(function(){var e=n.fields[0].Maps[0];r.getCurrentLocation(e.LatField,e.LongField,e.AddressField,e.Mapdiv,e.MapZoomField,e.mapTypeField)}),o.addListener(NewEntryAttachmentUploadedEvent,function(e){e&&(i.find(".imageContainer").removeClass("hidden"),i.find(".attachmentImages img").attr("src",e))},n.pageBlock.settings)}}}}]).directive("newObjectEdit",["$timeout","configService","attachmentsService","objectDetailService",function(e,t,n,i){return{templateUrl:t.getTemplateUrl("ObjectEdit/CreateNewObjectEdit.html"),restrict:"EA",replace:!0,link:function(t,a,r,o,l){e(function(){var e=a.find("._recordAttachment");if(e.length){var r=t.settings.odn,o=i.generateTmpId(r);a.find("#hdnTempId").val(o),n.wrapUploader(e,r,o,[])}},100)}}}]),speedupObjectDetailModule.factory("objectEditService",["$q","eventManager","localizationService","objectDetailDisplayerService","configService","objectDetailService","fieldService","notificationService","inlineFieldValueValidatorService",function(e,t,n,i,a,r,o,l,c){function s(e){var t=e.find('input[type!="hidden"]');t.prop("checked")?t.prop("checked",!1):t.prop("checked",!0)}function d(e){var t=u.dataTypes,n=!1;e.addClass("active");var i,a=e.attr("dtype");if(a==t.ObjectRelationship){i=e.find('input[type!="hidden"]');var r=i.data("kendoAutoComplete");r&&r.focus()}else{if(i=e.find('input[type!="hidden"]'),i.length||(i=e.find("textarea")),!i.length&&(i=e.find("select"),i.length)){var o=i.data("kendoDropDownList");o&&(o.focus(),n=!0)}n||i.focus()}return i}var u=a.getGlobalConfig(),p=function(){};return p.performValidation=function(e,t){var n=!0,i=t.find("input[type!='hidden']"),a=i.attr("v-type"),r=c.getValidator(e,a);return r&&(n=r.validateInput(i)),n},p.tabPressed=function(e,t,n,i){return this.deactivateAllSimpleBlocks(t.contentObject.element),e&&c.performValidation(t,e)&&(e=this.setNextBlockEdited(e,n,i)),e},p.enterPressed=function(e,t,n){var i=u.dataTypes,a=e.closest("._keycontainer"),r=a.attr("dtype");return r!=i.CheckBox?this.tabPressed(e,t,n,!1):(s(a),e)},p.activateSimpleBlock=function(e){e.addClass("active"),d(e).select()},p.deactivateAllSimpleBlocks=function(e){e.find("._keycontainer").removeClass("active")},p.saveObject=function(e,i,a){return t.fireEvent(LoadActionStartEvent),r.saveNewRecord(a,i).then(function(a){t.fireEvent(LoadActionStartEvent),r.afterCreateNewRecord(e,i,a),t.fireEvent(NewOEActionButtonClicked);var o=n.translate("Messages.RecordSavedSuccessfully");l.showNotification(o)},function(e){t.fireEvent(LoadActionStartEvent),l.showNotification(e,!0)})},p.createNewObject=function(e,n,i,a,o){var l={odn:e,recordId:null,fieldEditMode:"multiple",pageSize:5,displayMode:{type:"popup"},editMode:"edit"};return o&&(l.overridenFields=o),n&&(l.currentRecord={id:n,name:i,fk:a}),r.addNewRecord(e,l).then(function(e){t.addListener(NewOEActionButtonClicked,function(){e.onClose(function(){t.disposeListeners(l);var e=jQuery.Event("bindKeyboardEvents");$(window).trigger(e)}),e.close()},l)})},p.disableEditors=function(e,t,n){var i=u.dataTypes;$.each(e,function(e,a){var r=a.DataType,l=o.isFieldReadOnly(a.PropertyName);if(a.SystemProperty&&"Name"!=a.PropertyName||l||t&&a.DataType==i.AutoText)switch(r){case i.DateTime:var c=n.find("#txtdateTime"+a.PropertyName).data("kendoDateTimePicker");c&&c.readonly();break;default:c=n.find("#txt"+a.PropertyName),c&&c.prop("disabled",!0)}})},p.setNextBlockEdited=function(e,t,n){r.unSelectWidget(e);var i=t.index(e),a=!1;return-1!=i?(e=n?0==i?t.last():t.eq(i-1):i==t.length-1?t.first():t.eq(i+1),a=!0):!e&&t.length&&(a=!0,e=t[0]),a&&(d(e).select(),r.selectWidget(e)),e},p}]),angular.module("speedup.modal",[]).factory("$$stackedMap",function(){return{createNew:function(){var e=[];return{add:function(t,n){e.push({key:t,value:n})},get:function(t){for(var n=0;n<e.length;n++)if(t==e[n].key)return e[n]},keys:function(){for(var t=[],n=0;n<e.length;n++)t.push(e[n].key);return t},top:function(){return e[e.length-1]},remove:function(t){for(var n=-1,i=0;i<e.length;i++)if(t==e[i].key){n=i;break}return e.splice(n,1)[0]},removeTop:function(){return e.splice(e.length-1,1)[0]},length:function(){return e.length}}}}}).directive("modalWindow",["$modalStack","$q",function(e,t){return{restrict:"EA",scope:{index:"@"},replace:!0,transclude:!0,templateUrl:function(e,t){return t.templateUrl||"modal.window.html"},link:function(n,i,a){i.addClass(a.windowClass||""),n.$isRendered=!0;var r=t.defer();a.$observe("modalRender",function(e){"true"==e&&r.resolve()}),r.promise.then(function(){var t=i[0].querySelectorAll("[autofocus]");t.length?t[0].focus():i[0].focus();var n=e.getTop();n&&e.modalRendered(n.key)})}}}]).directive("modalTransclude",function(){return{link:function(e,t,n,i,a){a(e.$parent,function(e){t.empty(),t.append(e)})}}}).factory("$modalStack",["$document","$compile","$rootScope","$$stackedMap",function(e,t,n,i){function a(t,n){var i=e.find("body").eq(0),a=l.get(t).value;l.remove(t),n||a.windowObj.close(),i.toggleClass(o,l.length()>0)}function r(e,t,n){return!e.value.modalScope.$broadcast("modal.closing",t,n).defaultPrevented}var o="modal-open",l=i.createNew(),c={};return c.open=function(t,n){var i=e[0].activeElement,a=e.find("body").eq(0),r=n.content,s=angular.element(n.template),d=s.find(".content");d.length?d.append(r):s.append(r),a.append(s),a.addClass(o);var u=($(window).width()-parseInt(n.settings.width))/2+"px",p=n.settings.top||window.pageYOffset+25+"px",f=angular.extend({},n.settings,{position:{top:p,left:u},autoFocus:!1});s.kendoWindow(f);var v=s.data("kendoWindow");f.doCenterVert&&v.center();var v=s.data("kendoWindow"),m=function(){return c.dismiss(t,"closed by user [x]",!0)};v.bind("close",m),kendo.ui.Window.fn._keydown=function(e){var t=27;return function(n){n.which!==t&&e.call(this,n)}}(kendo.ui.Window.fn._keydown),v.open(),l.add(t,{deferred:n.deferred,renderDeferred:n.renderDeferred,modalScope:n.scope,keyboard:n.keyboard,element:s,windowObj:v}),l.top().value.modalDomEl=s,l.top().value.modalOpener=i},c.close=function(e,t){var n=l.get(e);return n&&r(n,t,!0)?(n.value.deferred.resolve(t),a(e),n.value.modalOpener.focus(),!0):!n},c.dismiss=function(e,t,n){var i=l.get(e);return i&&r(i,t,!1)?(i.value.deferred.reject(t),a(e,n),i.value.modalOpener.focus(),!0):!i},c.dismissAll=function(e){for(var t=this.getTop();t&&this.dismiss(t.key,e);)t=this.getTop()},c.getTop=function(){return l.top()},c.modalRendered=function(e){var t=l.get(e);t&&t.value.renderDeferred.resolve()},c}]).provider("$modal",function(){var e={options:{keyboard:!0,templateType:"angular"},$get:["$injector","$rootScope","$q","$http","$templateCache","$controller","$modalStack",function(t,n,i,a,r,o,l){function c(e){return e.template?i.when(e.template):a.get(angular.isFunction(e.templateUrl)?e.templateUrl():e.templateUrl,{cache:r}).then(function(e){return e.data})}function s(e){var n=[];return angular.forEach(e,function(e){(angular.isFunction(e)||angular.isArray(e))&&n.push(i.when(t.invoke(e)))}),n}var d={};return d.open=function(t){var a=i.defer(),r=i.defer(),d=i.defer(),u={result:a.promise,opened:r.promise,rendered:d.promise,close:function(e){return l.close(u,e)},dismiss:function(e){return l.dismiss(u,e)}};if(t=angular.extend({},e.options,t),t.resolve=t.resolve||{},!t.template&&!t.templateUrl)throw new Error("One of template or templateUrl options is required.");var p=i.all([c(t)].concat(s(t.resolve)));return p.then(function(e){var i=(t.scope||n).$new();i.$close=u.close,i.$dismiss=u.dismiss;var r,c={},s=1;t.controller&&(c.$scope=i,c.$modalInstance=u,angular.forEach(t.resolve,function(t,n){c[n]=e[s++]}),r=o(t.controller,c),t.controllerAs&&(i[t.controllerAs]=r)),l.open(u,{scope:i,settings:t.settings,deferred:a,renderDeferred:d,template:e[0],content:e[1],keyboard:t.keyboard,templateType:t.templateType,windowClass:t.windowClass,windowTemplateUrl:t.windowTemplateUrl})},function(e){a.reject(e)}),p.then(function(){r.resolve(!0)},function(e){r.reject(e)}),u},d}]};return e}),CSVapp.factory("objectService",["$q","$http","$rootScope","configService","eventManager","localizationService","fieldPropertiesService","objectPropertySaverFactory",function(e,t,n,i,a,r,o,l){var c=i.getGlobalConfig(),s={};return s.batchEdit=function(n,r,o){var l=e.defer();if(!(n&&n.entries&&n.entries.length&&n.data&&n.data.length))return l.reject("Empty input params"),l.promise;var s=[],d="";n.data.forEach(function(e){e.fk&&e.value&&(d=e.fk+":"+e.value,s.push(d))});var u={ObjectEntryIds:n.entries.join(","),PropertyIDPropertyValue:s},p=i.getUrlBase("batchEdit")+"/"+c.token;return t.post(p,u).then(function(e){if(e&&e.data&&e.data.BatchEditMessage)if(-1!=e.data.BatchEditMessage.indexOf("Success")){o&&a.fireEvent(ObjectsBatchUpdatedEvent,{data:n,odn:r});var t=e.data.BatchEditMessage.indexOf("Count"),i=t?parseInt(e.data.BatchEditMessage.substr(t+6)):0;l.resolve(i)}else l.reject(e);else l.reject(e)},l.reject),l.promise},s.repeatObject=function(n,r){var o=e.defer(),l=i.getUrlBase("repeatedRecordWithChildren")+"/"+c.token;return t.post(l,JSON.stringify(n)).success(function(e){angular.isObject(e)&&e.Message.indexOf("Que")?(o.resolve(),r&&a.fireEvent(ObjectRepeatedEvent)):o.reject()}).error(function(){o.reject()}),o.promise},s.copyObject=function(n,o,l){var s=e.defer(),d=i.getUrlBase("copyRecordWithChildren")+"/"+n+"/"+c.token;return t.get(d).success(function(e){if(angular.isObject(e)&&e.Message&&e.Message.indexOf("Successfully")){var t={ObjectEntry_ID:e.NewObjectEntry_ID,Name:e.NewObjectEntry_Name,ObjectDefinitionName:o};l&&a.fireEvent(ObjectCopiedEvent,t),s.resolve(t)}else{var n=r.translate("Messages.UnableToCopyObject")+r.translate("Messages.InvalidJson");s.reject(n)}}).error(function(){var e=r.translate("Messages.UnableToCopyObject");s.reject(e)}),s.promise},s.deleteObject=function(n,r,o){var l=e.defer(),s=i.getUrlBase("deleteObjectRecord")+"/"+r+"/"+n+"/"+c.token+"?RequestType=do";return t.get(s).success(function(e){l.resolve(e),o&&a.fireEvent(ObjectDeletedEvent,{odn:r,recordId:n})}).error(function(){l.reject('Unable to delete object "'+r+'" with id: '+n)}),l.promise},s.saveObject=function(t,n,o){var l=e.defer(),s=i.getUrlBase("saveObjectWithResponse")+"/"+n+"/"+c.token;return $.ajax({type:"POST",url:s,data:JSON.stringify(t),dataType:"json",success:function(e){var t="Exception";e.ResponseMessage.indexOf(t)>-1?l.reject(e):(o&&a.fireEvent(ObjectSavedEvent,e),l.resolve(e))},error:function(e,t,n){var i=e.getResponseHeader("ResponseCode");if("UnAuthorized"==i)l.reject(i);else{var a=r.translate("Messages.UnableToSaveRecord");l.reject(a)}}}),l.promise},s.extractItemFromSaveAPIResponse=function(e){if(angular.isObject(e)){var t=JSON.parse(e.SavedData);if($.isArray(t))return t[0]}return{}},s.getSettingsAndSaveObjectField=function(e,t,n,i,a){var r=o.getAllPropertiesOfSingleField(e,i);return s.saveObjectField(i,e,r.PropertyDefinition_ID,t,n,a)},s.saveObjectField=function(e,t,n,i,a,r){var o=l.getSaver(c.inlineSaveMethod);return o.saveObjectField(e,t,n,i,a,r)},s}]),CSVapp.factory("objectPropertySaverFactory",["$q","configService","eventManager",function(e,t,n){function i(){}function a(){this.type="local",a.base.constructor.call(this,arguments)}function r(){this.type="server",r.base.constructor.call(this,arguments)}function o(i,a,r,o,c,s){var d=e.defer(),u={PropertyValue:o,ObjectEntry_fk:c,PropertyDefinition_fk:r,RequestType:"sio"},p=t.getUrlBase("saveObjectField")+"/"+l.token;return $.ajax({type:"POST",url:p,data:JSON.stringify(u),dataType:"json",success:function(e){var t="Exception";e.ResponseMessage&&e.ResponseMessage.indexOf(t)>-1?d.reject(e.ResponseMessage):(s&&n.fireEvent(ObjectPropertySavedEvent,{fieldName:a,fieldValue:o,recordId:c,odn:i}),d.resolve(e))},error:function(e,t,n){d.reject(e.getResponseHeader("ResponseCode"))}}),d.promise}var l=t.getGlobalConfig(),c={};return c.getSaver=function(e){switch(e){case"local":return new a;case"server":return new r;default:throw new BadParameterException("Wrong type of ObjectPropertySaver: "+e)}},Object.inherit(i,a,{saveObjectField:function(t,i,a,r,l,c){var s=e.defer();return c&&n.fireEvent(ObjectPropertySavedEvent,{fieldName:i,fieldValue:r,recordId:l,odn:t}),s.resolve("Update Successfull."),o(t,i,a,r,l,!1),s.promise}}),Object.inherit(i,r,{saveObjectField:function(e,t,n,i,a,r){return o(e,t,n,i,a,r)}}),c}]),DetailPageBlockIdGenerator.currentId=0,DetailPageBlockIdGenerator.generateId=function(){return++DetailPageBlockIdGenerator.currentId},DetailPageBlock.prototype.getRootBlock=function(e){return e.parentBlock?this.getRootBlock(e.parentBlock):e},DetailPageBlock.prototype.getVeryLastChildBlock=function(e){if(e||(e=this.getRootBlock(this)),!e)return null;var t=e.getLastChildBlock();return t&&t.getChildrenCount()?this.getVeryLastChildBlock(t):t},DetailPageBlock.prototype.getLastChildBlock=function(e){if(!this.childBlocks||0>e)return null;e||0===e||(e=this.childBlocks.length-1);var t=this.childBlocks[e];return t||(t=this.getLastChildBlock(e-1)),t},DetailPageBlock.prototype.getNextBlock=function(){var e=this.getNextChildBlock();return e||(e=this.getNextSiblingBlock()),e?e:this.getRootBlock(this)},DetailPageBlock.prototype.getPrevBlock=function(){var e=this.getPrevSiblingBlock();return e?e:this.parentBlock?this.parentBlock:this.getVeryLastChildBlock()},DetailPageBlock.prototype.getNextSiblingBlock=function(){var e=null,t=this.parentBlock;return t&&(e=t.getNextChildBlock(this),
!e)?t.getNextSiblingBlock():e},DetailPageBlock.prototype.getPrevSiblingBlock=function(){var e=null,t=this.parentBlock;return t&&(e=t.getPrevChildBlock(this),!e)?t.getPrevSiblingBlock():e},DetailPageBlock.prototype.getNextChildBlock=function(e){var t=null,n=!1;return this.childBlocks.some(function(i){return i?e?i.id==e.id?(n=!0,!1):n?(t=i,!0):!1:(t=i,!0):void 0}),t},DetailPageBlock.prototype.getPrevChildBlock=function(e){var t=null,n=!1;return this.childBlocks.some(function(i){return i?e?i.id==e.id?(t&&(n=!0),!0):(t=i,!1):(t=i,n=!0,!0):void 0}),n?t:null},DetailPageBlock.prototype.setRootAwareOfCurrent=function(e,t){var n=this.getRootBlock(e);(!t||t&&!n.currentPageBlock)&&(n.currentPageBlock=e)},DetailPageBlock.prototype.showChildren=function(){this.childContainer&&this.childContainer.length&&this.childContainer.show()},DetailPageBlock.prototype.hideChildren=function(){this.childContainer&&this.childContainer.length&&this.childContainer.hide()},DetailPageBlock.prototype.substituteBlockBy=function(e){return this.clearBlock(),this.element.append(e.element),e.displayer=this.displayer,e},DetailPageBlock.prototype.getChildrenCount=function(){var e=0;return this.childBlocks.forEach(function(t){t&&e++}),e},DetailPageBlock.prototype.clearBlock=function(){this.contentObject&&this.contentObject.element&&this.contentObject.element.off(),this.element.empty(),this.childContainer=null,this._contentObject=null,this.childBlocks.forEach(function(e){e&&e.clearBlock()}),this.childBlocks=[]},DetailPageBlock.prototype.appendChildBlock=function(e){var t=e.element;if(e.parentBlock=this,this.childContainer){var n=null;this.childBlocks.forEach(function(t){t.id<e.id&&(!n||t.id>n.id)&&(n=t)}),n?n.element.after(t):this.childContainer.prepend(t)}else this.childContainer=angular.element('<div class="childContainer"></div>'),this.element.append(this.childContainer),this.childContainer.append(t);this.childBlocks[""+e.id]=e},DetailPageBlock.prototype.removeBlock=function(){this.parentBlock?this.parentBlock.removeChildBlockById(this.id):(this.clearBlock(),this.element.remove(),delete this)},DetailPageBlock.prototype.removeChildBlockById=function(e){return e=""+e,this.childBlocks[e]?(this.childBlocks[e].clearBlock(),this.childBlocks[e]=null,!0):!1},ContentObject.prototype.generateContent=function(){return this.content},Object.inherit(ContentObject,DetailObject,{generateContent:function(){var e=this;return $q.all(detailObject._promiseBlocks).then(function(){e._promiseBlocks=[];var t=angular.element(e._header),n=angular.element(e._menu),i=angular.element(e._tabStrip),a=angular.element(e._fields);return e.content=angular.element("<div></div>").append(t).append(n).append(i).append(a),e.content})}});var LoadActionStartEvent="LoadActionStart",LoadActionEndEvent="LoadActionEndEvent",GridFilterSetEvent="GridFilterSetEvent",GridEventListenReadyEvent="GridEventListenReadyEvent",FilterGridByGenericSearchEvent="FilterGridByGenericSearch",FilterGridByFilterExpressionEvent="FilterGridByFilterExpression",ObjectsBatchUpdatedEvent="ObjectsBatchUpdated",ObjectDetailFieldUpdatedEvent="ObjectDetailFieldUpdated",ObjectRepeatedEvent="ObjectRepeated",ObjectCopiedEvent="ObjectCopied",ObjectPropertySavedEvent="ObjectPropertySaved",ObjectSavedEvent="ObjectSaved",ObjectDeletedEvent="ObjectDeleted",NewODCreated="NewObjectDetailCreated",NewODActionButtonClicked="NewObjectDetailActionButtonClicked",NewOEActionButtonClicked="NewObjectEditActionButtonClicked",NewEntryAttachmentUploadedEvent="NewEntryAttachmentUploadedEvent",FilterSetEvent="FilterSet",FilterTabButtonExpandedEvent="FilterTabButtonExpanded",FilterTabButtonCollapsedEvent="FilterTabButtonCollapsed",FilterExpandedEvent="FilterExpanded",FilterCollapsedEvent="FilterCollapsed",FilterReadyEvent="FilterReady",CheckFilterStateEvent="CheckFilterStateEvent",SchedulerReadyEvent="SchedulerReady",SchedulerResourceButtonClickedEvent="SchedulerResourceButtonClicked",SchedulerResourcePanelToggleEvent="SchedulerResourcePanelToggleEvent",SchedulerChangeWidthEvent="SchedulerChangeWidth",ResourcePanelFilterChangedEvent="ResourcePanelFilterChanged",SchedulerResourcesLoadedEvent="SchedulerResourcesLoaded",AdvancedSearchFilterSetEvent="AdvancedSearchFilterSet",AdvancedSearchTabButtonExpandedEvent="AdvancedSearchTabButtonExpanded",AdvancedSearchTabButtonCollapsedEvent="AdvancedSearchTabButtonCollapsed",ASTabChangeWidthEvent="ASTabChangeWidth",AttachmentImageChangedEvent="AttachmentImageChanged",DisplayerElementClosedEvent="DisplayerElementClosed",BatchFormOpenedEvent="BatchFormOpened",BatchFormClosedEvent="BatchFormClosed",BatchEditBtnClickedEvent="BatchEditBtnClicked";CSVapp.factory("notificationService",[function(){var e={};return e.showNotification=function(e,t){if(0==$("._pluginnotificationmsg").length){var n=$("<div class='pluginNotificationMsg _pluginnotificationmsg '><h3>"+e+"</h3></div>");$(document.body).prepend(n)}t?$("._pluginnotificationmsg").removeClass("pluginsuccessmsg").addClass("pluginerrormsg"):$("._pluginnotificationmsg").removeClass("pluginerrormsg").addClass("pluginsuccessmsg"),$("._pluginnotificationmsg").css("left","40%").fadeIn(500).delay(200).fadeOut(500),$("._pluginnotificationmsg").bind("click",function(){$(this).fadeOut().remove()});var i=2e3;t&&(i=4e3),setTimeout(function(){$("._pluginnotificationmsg").fadeOut().remove()},i)},e}]),CSVapp.factory("popupNotificationService",["$cookies","$modal","localizationService","filesystemService",function(e,t,n,i){function a(e){var i='<div><div class="content"></div><button class="k-button k-primary" id="popupYesButton"">'+n.translate("Buttons.GotIt")+"</button></div>";return t.open({template:i,settings:r,resolve:{items:function(){return e}},content:e})}var r={modal:!0,visible:!1,maxHeight:1e3,minHeight:300,width:750,resizable:!1,actions:["Close"]},o={};return o.displayMainPageNotification=function(){var t=SUConstants.NotificationCookieName;if(!e.get(t)&&$("#notificationBlock").length){o.displayNotificationPopup($("#notificationBlock"));var n=new Date;n.setDate(n.getDate()+100),e.put(t,"1",{expires:n})}},o.displayNotificationPopup=function(e){e.show();var t=e.find("li");if(t.length){var n=e.find(".notificationsList");e.find("img").each(function(e,t){$(t).attr("src",i.getImageUrl($(t).data("addr")))});var r=n.anythingSlider({buildArrows:!0,buildNavigation:!1,buildStartStop:!1}),o=a(e);o.opened.then(function(){var e=angular.element("#popupYesButton");1==t.length&&e.css("visibility","visible"),r.bind("slide_complete",function(n,i){i.currentPage==t.length&&e.css("visibility","visible")}),e.click(function(){o.dismiss()})})}},o}]),CSVapp.factory("objectTemplateService",["$q","$http","pageTemplateObjectService","schemaService","objectDataService",function(e,t,n,i,a){function r(t){var n=[i.getSchema(t),a.getSubObjects(t)];return e.all(n).then(function(e){return[{Name:"FakeTemplate",PageTemplateLabel:"User Template",RecordFirstImagePath:"",RelatedObjectDisplayType:"Grid",RelatedObjectUnderMainRecord:o(e[1]),SelectedColumnsForTemplate:l(e[0].SelectedColumnsList),SelectedRelatedObjectsForTemplate:o(e[1])}]})}function o(e){var t="";return angular.isArray(e)&&e.forEach(function(e){t+=e.ObjectDefinitionID+":dummyOrgId:"+e.ObjectDefinitionName+";"}),t}function l(e){var t="";return angular.isArray(e)&&e.forEach(function(e){t+="["+e.PropertyName+"],"}),t}var c=function(){};return c.getObjectTemplate=function(e){return n.getObjectTemplateSettings(e).then(function(t){return t||(t=r(e)),t})},c}]),CSVapp.factory("pageTemplateObjectCacheService",[function(){var e={},t=function(){};return t.getCachedPageTemplateObject=function(t,n){var i=e[t];if(!i)return null;var a;if(n)a=i[n];else{var r=Object.getOwnPropertyNames(i);a=i[r[0]]}return a||null},t.preservePageTemplate=function(t){var n=t.ObjectDefinitionName,i=t.PageTemplate;if(angular.isArray(i)&&angular.isObject(i[0])){var a,r=t.PageTemplate[0].Name,o=e[n];o?(a=o[r],a||(o[r]=t)):(a={},a[r]=t,e[n]=a)}},t}]),CSVapp.factory("pageTemplateObjectService",["$q","$http","configService","pageTemplateObjectCacheService",function(e,t,n,i){var a=n.getGlobalConfig(),r=function(){};return r.getObjectTemplateSettings=function(r){var o,l=e.defer(),c=[];o=a.perspectivePageTemplate&&a.perspectivePageTemplate[r]?a.perspectivePageTemplate[r]:a.objectDefinitionName==r&&a.pageTemplateName?a.pageTemplateName:"Default";var s=i.getCachedPageTemplateObject(r,o);if(s&&$.isArray(s.PageTemplate)&&s.PageTemplate.length)c=s.PageTemplate,l.resolve(null==c||""==c?"":c);else{var d=n.getUrlBase("objectPageLayout")+"/"+r+"/"+o+"/"+a.token;t.get(d).success(function(e){c=jQuery.parseJSON(e),!c||$.isArray(c)&&!c.length?l.resolve(""):(i.preservePageTemplate({ObjectDefinitionName:r,PageTemplate:c}),l.resolve(c||""))}).error(function(){l.resolve("")})}return l.promise},r}]),CSVapp.factory("schemaService",["$q","$http","configService","conversionCacheService","printTemplateCacheService","pageTemplateObjectService","pageTemplateObjectCacheService",function(e,t,n,a,r,o,l){function c(e,t,n,i){var a=[];if(!angular.isArray(e))return[];switch(n){case"all":a=e;break;case"selected":a=R.FilterFieldsSelected4Template(e,i);break;case"jsonSelected":t&&t[0]&&t[0].SelectedColumnsForTemplate&&(a=R.FilterFieldsSelected4Template(e,t[0].SelectedColumnsForTemplate));break;case"visible":a=e.filter(function(e){return e.Visible})}return a}function s(e){var t={};return e.forEach(function(e,n){t[e.PropertyName]=n}),t}function d(t,n){var i=e.defer(),a=null,r=null,l=[];T.pageTemplateName;return void 0!=t&&null!=t&&(a=P.filter(function(e){return t==e.ObjectDefinitionName?e:void 0})[0]),a?(r=a.AllColumnsList,o.getObjectTemplateSettings(t).then(function(e){l=c(r,e,n),i.resolve(l)})):o.getObjectTemplateSettings(t).then(function(e){var a=function(){l=c(T.visibleColumns,e,n),i.resolve(l)},r=function(t){var a=t.AllColumnsList;l=c(a,e,n),i.resolve(l)};u(t).then(r,a)}),i.promise}function u(t){var n=e.defer(),i="http://185.31.160.22/shop",a='<Context   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"><TypeName>'+t+"</TypeName><OperationName>GetObjectMetaData</OperationName></Context>";return $.ajax({type:"post",dataType:"xml",data:a,url:i}).success(function(e){var i=v(e);m(i,t);var a=R.GetSchemaByObjectDefinitionName(t);n.resolve(a)}).error(function(e,t,a){var r=e.getResponseHeader("ResponseCode");"UnAuthorized"==r?n.reject(e.getResponseHeader("ResponseCode")):n.reject(i+":=:"+e.status+" "+t+" "+a)}),n.promise}function p(e){return L[e]||e}function f(e){return I[e]||e}function v(e){var t=[{PropertyName:"CreatedDate",DataType:T.dataTypes.Date}];return $(e).find("EntityItem").each(function(e,n){$(n).find("Attributes").children().each(function(e,n){var i={};for(e=0;e<n.attributes.length;e++){var a=n.attributes[e].name,r=p(a),o=n.attributes[e].nodeValue;switch(r){case"DataType":i[r]=f(o);break;case"PropertyName":var l=f(o);i[r]=l,i.PropertyLabel=l;break;default:i[r]=o}}t.push(i)})}),t}function m(e,t){var n=new Object;n.ObjectDefinitionName=t,n.AllColumnsList=e,n.SelectedColumnsList=new Array;for(var i in e){var a=new Object;void 0!=e[i].Visible&&null!=e[i].Visible&&1==e[i].Visible&&(a=e[i],n.SelectedColumnsList.push(a))}return n.Model=R.CreateModelSchema(e),g(n),n}function g(e){var t=P.filter(function(t){return e.ObjectDefinitionName==t.ObjectDefinitionName?t:void 0})[0];(null==t||void 0==t)&&P.push(e)}function h(e){if(""!=e){e=JSON.parse(e);var t=Object.keys(e);if(null!=t&&t.length>0)for(k=0;k<t.length;k++){var n=t[k],i=O(n,e);if(null!=i){var o=new Object;o.ObjectDefinitionName=n,o.ObjectDefinitionProperties=i,C.push(o)}var c=j(n,e);null!=c&&m(c,n);var s=D(n,e),o=new Object;o.ObjectDefinitionName=n,o.SubObjectsObject=null!=s?s:null,R.preserveSubObject(o);var d=S(n,e),u=new Object;u.ObjectDefinitionName=n,null!=d&&void 0!=d.length?u.PageTemplate=d:u.PageTemplate=[],l.preservePageTemplate(u);var p=y(n,e);if(null!=p){var f=new Object;f.ObjectDefinitionName=n,f.ConversionList=p,a.preserveConversionObject(f)}var v=b(n,e),g=new Object;g.ObjectDefinitionName=n,g.PrintTemplateList=null!=v?v:null,r.preservePrintTemplateObject(g)}}}function b(e,t){return null!=t[e]?t[e].PrintTemplate:null}function y(e,t){return null!=t[e]?t[e].ConversionList:null}function S(e,t){return null!=t[e]?t[e].PageTemplate:null}function D(e,t){var n=$.grep(Object.keys(t),function(n){return t[n].ParentObjectName===e?Object.keys(t):void 0}),a=[];if(null!=n&&n.length>0){for(i=0;i<n.length;i++){var r=O(n[i],t);if(r){var o=new Object;o.ObjectDefinitionID=r.ObjectDefinition_ID,o.ObjectDefinitionName=r.ObjectName,o.PropertyDefinitionID=t[n[i]].PropertyDefinitionID,o.PropertyName=t[n[i]].ParentPropertyName,o.ObjectLabel=r.ObjectLabel,a.push(o)}}return a}return null}function O(e,t){return null!=t[e]?t[e].ObjectDefinition:null}function j(e,t){return null!=t[e]?t[e].PropertyDefinition:null}var T=n.getGlobalConfig(),E=T.objectDefinitionName,C=[],P=[],F=[],w=[],B=[],N=[],x=0,R=function(){};R.createPageTitle=function(e,t){var n=" >> ",i="";return e&&t||(n=""),R.getObjectDefinition(e).then(function(e){return e&&(i=e.ObjectLabel),i=t?i+n+t:i})},R.getDropDownListOutputSettings=function(){return N},R.preserveSubObject=function(e){var t=F.filter(function(t){return e.ObjectDefinitionName==t.ObjectDefinitionName?t:void 0})[0];(null==t||void 0==t)&&F.push(e)},R.getSubObjectByObjectDefinitionName=function(e){return F.filter(function(t){return t.ObjectDefinitionName==e?t:void 0})[0]},R.PreserveConditionalFields=function(e,t){var n=B.filter(function(n){return n.DefinitionName==t&&n.PropertyId==e.PropertyId?n:void 0})[0];void 0==n&&(e.DefinitionName=t,B.push(e))},R.PreserveConditionalFields=function(e,t){var n=N.filter(function(n){return n.DefinitionName==t&&n.PropertyName==e.PropertyName?n:void 0})[0];void 0==n&&N.push(e)},R.GetVisibleColumns=function(){return w},R.getObjectDefinition=function(i){var a=e.defer();i||a.reject("No object definition name");var r=M(i);if(r)a.resolve(r.ObjectDefinitionProperties);else{var o=null,l=n.getUrlBase("objectDefinition")+"/"+i+"/"+T.token;t.get(l).success(function(e){o=e,C.push({ObjectDefinitionName:i,ObjectDefinitionProperties:e}),a.resolve(e)}).error(function(){a.reject("Error loading page template object for '"+i+"'")})}return a.promise},R.getSchema=function(t){var n=e.defer(),i=R.GetSchemaByObjectDefinitionName(t);return null==i||void 0==i?u(t).then(function(e){n.resolve(e)},n.reject):n.resolve(i),n.promise},R.UniqueId=function(e){var t=""+ ++x;return e?e+t:t},R.GetVisibleFieldsDetails=function(t,n){var i=e.defer();return d(t,n).then(function(e){i.resolve(e)}),i.promise},R.Init=function(){var e=T.jsonStructure;h(e),R.GetSchemaByObjectDefinitionName(E)||u(E)};var M=function(e){return C.filter(function(t){return t.ObjectDefinitionName==e?t:void 0})[0]};R.EmptySchema=function(t){var n=e.defer(),i=R.GetSchemaByObjectDefinitionName(t),a=[],r={};if(void 0==i||null==i||0==i.AllColumnsList.length)u(t).then(function(e){var t=e.AllColumnsList;for(var i in t)(void 0!=t[i].Visible||null!=t[i].Visible||1==t[i].Visible||void 0==t[i].Visible)&&(r[t[i].PropertyName]=null);a.push(r),n.resolve(a)},function(e){n.resolve(a)});else{var o=i.AllColumnsList;for(var l in o)(void 0!=o[l].Visible||null!=o[l].Visible||1==o[l].Visible||void 0==o[l].Visible)&&(r[o[l].PropertyName]=null);a.push(r),n.resolve(a)}return n.promise},R.GetSchemaByObjectDefinitionName=function(e){return P.filter(function(t){return t.ObjectDefinitionName==e?t:void 0})[0]},R.CreateModelSchema=function(e){var t=new Object,n="{";for(var i in e)switch(e[i].DataType){case T.dataTypes.DateTime:n+='"'+e[i].PropertyName+'": {"type":"date"},';case T.dataTypes.Date:n+='"'+e[i].PropertyName+'": {"type":"date"},'}return n=n.substring(0,n.length-1)+"}",t.id=T.modelId,t.fields=JSON.parse(n),t},R.FilterFieldsSelected4Template=function(e,t){t=t||T.selectedColumns;var n,i=[],a=s(e),r=t.split(",");return r.forEach(function(t){if(""!=t){var r=t.replace(/[[\]]/g,"");n=a[r],null!=n&&void 0!=n&&i.push(e[n])}}),i};var L={Name:"PropertyName",Type:"DataType",Mandatory:"IsRequired"},I={String:"Text",Int32:"Numeric"};return R}]);var GCPostData={ObjectDefinitionName:"",RecordID:"",PageNumber:"",PageSize:"",OrderByExpression:"",Token:"",RequestType:"",Clear:function(){this.ObjectDefinitionName=void 0,this.RecordID=void 0,this.PageNumber=void 0,this.PageSize=void 0,this.OrderByExpression=void 0,this.Token=void 0,this.RequestType=""}},GCUrls={batchEdit:"BatchEdit",getFilters:"ObjectFilterList",getObjectModuleUserSettings:"GetObjectModuleUserSettings",updateObjectModuleUserSettings:"UpdateObjectModuleUserSettings",saveObjectField:"ObjectPropertyValue",getObjectSchema:"ObjectPropertyDefinition",fetchListData:"ObjectListValues",fetchMultipleObjectListData:"MultipleObjectListValues",deleteObjectRecord:"DeleteObjectRecord",objectRecordList:"ObjectRecordList",objectPageLayout:"ObjectPageLayout",documentsAndAttachments:"DocumentsAndAttachements",documentsAndAttachementsTemporary:"DocumentsAndAttachementsTemporary",deleteAttachment:"DeleteDocumentsAndAttachements",objectDefinition:"ObjectDefinition",getSubObjects:"ObjectSubObjectList",saveObjectWithResponse:"ObjectRecordWithResponse",objectRecordsCount:"ObjectRecordListCount",copyRecordWithChildren:"CopyRecordWithChildren",repeatedRecordWithChildren:"RepeatedRecordCopyWithChildren",objectConversionList:"ObjectConversionList",runObjectConversion:"RunObjectConversion",objectPrintTemplateList:"ObjectPrintTemplateList",objectPrintTemplateHTML:"ObjectPrintTemplateHTML",saveTemporaryAttachments:"MoveDocumentsAndAttachementsTemporary"},GCCookies={CookieFilterOpened:"FilterOpened",CookieAdvancedSearchTabOpened:"AdvancedSearchTabOpened"},GCFieldDataTypes={Date:"Date",DateTime:"DateTime",Text:"Text",AutoText:"AutoText",TextBox:"TextBox",DropDownList:"DropDownList",SearchableDropDownList:"SearchableDropDownList",ParentRelationship:"ParentRelationship",ObjectRelationship:"ObjectRelationship",CheckBox:"TrueFalse",Image:"Image",LinkButton:"",Time:"Time",URL:"URL",RichTextBox:"RichTextBox",Email:"Email",GeoData:"GeoData",MultiSelectList:"MultiSelectList",NumericText:"NumericText",Numeric:"Numeric",Formula:"Formula",MultilineTextBox:"TextBox",Summary:"Summary",MultiObjectRelationshipField:"MultiObjectRelationshipField",TableRelationship:"TableRelationship"};CSVapp.factory("configService",["filesystemService",function(e){function t(t){n="prod"!=t,e.InitPathsByEnv(t)}var n=!0,i=function(){};i.Init=function(){return t(r.environment),i.getGlobalConfig()},i.getTemplateUrl=function(t){var n=r.version||"";return e.getTemplateUrl(t,n)},i.getUrlBase=function(e){var t=r.urls[e];return t&&(t=r.baseUrl+"/"+t),t},i.init=function(){return legacyConfig.Settings(r.baseUrl,r.token,r.userName).Init(),legacyConfig},i.getConfig=function(){return"undefined"!=typeof $config?$config:$.config},i.getSchedulerConfig=function(){return SchedulerConfig},i.getPageConfig=function(){return pageConfig},i.getGlobalConfig=function(){return r};var a=i.getPageConfig(),r={baseUrl:a.baseUrl,token:a.token,userName:a.userName,objectDefinitionName:a.objectDefinitionName,pageTemplateName:a.pageTemplateName,perspectiveFilter:a.hfPerspectiveFilter,perspectivePageTemplate:a.perspectivePageTemplate,selectedColumns:a.selectedColumns,urls:GCUrls,postData:GCPostData,cookies:GCCookies,dataTypes:GCFieldDataTypes,jsonStructure:a.JSONStructure,modelId:a.modelId||"ObjectEntry_ID",environment:a.environment,version:a.templateVersion,objectDetailDisplayType:a.objectDetailDisplayType,objectDetailPageSize:a.objectDetailPageSize,inlineSaveMethod:a.inlineSaveMethod||"server",mobileView:a.mobile,gridEditable:a.gridEditable||!1,gridContainer:a.gridContainer,defaultSortOrder:a.defaultSortOrder,gridPageSize:a.gridPageSize,waitForFilter:a.waitForFilter,showFirstRecord:a.showFirstRecord,mobile:a.mobile,batchUpdate:a.batchUpdate,enableKeyboard:a.enableKeyboard,advancedSearchTpl:a.advancedSearchTpl};return i}]),CSVapp.factory("filesystemService",[function(){var e="",t="",n="",i="DesktopModules/src/components",a=["jpg","jpeg","gif","png"],r=function(){};return r.isImageUrlAbsolute=function(e){return-1!=(""+e).indexOf("http://")},r.getTemplateUrl=function(e,t){return t=t?"?v"+t:"",i+"/"+e+t},r.InitPathsByEnv=function(a,r){switch(a){case"local":t="http://localhost/Speedup_dnn/",n="http://localhost/Speedup_dnn/images/SU_images/FileExtensionImages/",e="/speedup_dnn/DesktopModules/SpeedUp.ObjectManagement.ClientSideViewer/";break;case"test":e="/speedupcustomers/DesktopModules/SpeedUp.ObjectManagement.ClientSideViewer/",t="http://test-srv1.speeduperp.com/speedupcustomers/",n="http://test-srv1.speeduperp.com/speedupcustomers/images/SU_images/FileExtensionImages/";break;case"stage":e="/speedupcustomers/DesktopModules/SpeedUp.ObjectManagement.ClientSideViewer/",t="http://staging-srv1.speeduperp.com/speedupcustomers/",n="http://staging-srv1.speeduperp.com/speedupcustomers/images/SU_images/FileExtensionImages/";break;case"prod":e="/speedupcustomers/DesktopModules/SpeedUp.ObjectManagement.ClientSideViewer/",n="http://speeduperp.com/Speedupcustomers/images/SU_images/FileExtensionImages/",t="http://speeduperp.com/speedupcustomers/";break;default:if(r)throw"wrong environment variable: '"+a+"'"}i=t+i},r.getImageIconUrl=function(e){return r.createCompletePath(e,"icon")},r.getImageUrl=function(e){return e?r.createCompletePath(e,"image"):""},r.getPluginImageUrl=function(e){return r.createCompletePath(e,"plugin")},r.getCompletePluginFilePath=function(e){return r.createCompletePath(e,"plugin")},r.createCompletePath=function(i,a){var r;switch(a){case"image":r=t;break;case"plugin":r=e;break;case"icon":r=n}var o="";if(null==r||""==r)o=i;else{var l=r.slice(-1);o="/"==l?r+i:r+"/"+i}return o},r.fileIsImageByExtension=function(e){return-1!=$.inArray(e,a)},r.getFileExtension=function(e){var t="",n=e.lastIndexOf(".");return-1!=n&&(t=e.substr(n+1).toLowerCase()),t},r.changeTmpImageUrl=function(e,n,i){return e?t+"/Upload/"+e.substring(e.lastIndexOf("Temp_OM_Uploads"),e.length)+"/"+n+"."+i:""},r.changeImageUrl=function(e){if(null==e||""==e)return"";e=r.imageUrlFromRelative(e);var t=e.lastIndexOf("."),n=e.substring(0,t),i=e.substring(t),a=SUConstants.ImageSizes.h500;return n+a+i},r.imageUrlFromRelative=function(e){return e.replace("~",t)},r.changeImageUrlAndSize=function(e,t){if(null==e||""==e)e=r.getPluginImageUrl("JS/img/NoImage.jpg");else{e=r.imageUrlFromRelative(e);var n=e.lastIndexOf("."),i=e.substring(0,n),a=e.substring(n);e=i+t+a}return e},r}]),CSVapp.factory("autocompleteService",["configService","eventManager",function(e,t){function n(e){if(b&&b.Values){var t=b.Values;for(var n in t)if("length"!==n&&t.hasOwnProperty(n)&&(t[n].Name==e||t[n].RelatedEntityName==e))return i(t,n)}return[]}function i(e,t){try{var n=e[t].Values||[],i=[];for(var a in n)"length"!==a&&n.hasOwnProperty(a)&&i.push(n[a]);return i}catch(r){return[]}}function a(e){var t=h.dataTypes,n=[];return e?(e.find("._keycontainer").each(function(e,i){var a=angular.element(i).attr("dtype");if(a===t.ParentRelationship||a===t.ObjectRelationship){var e=angular.element(i).attr("key"),r=$(i).find("#txt"+e);if(r.length){var o=$.data(r[0],"jqacuid");o&&n.push(o)}}}),n):n}function r(e,t,n,i,a,r,l){if(t){var c=t.Values,u=t.Dependencies;if(c&&u){var p=[],f=s(c,a,r);!f&&l&&(f=d(l,r)),o(e,u,c,n,i,a,f,p,l)}}}function o(e,t,n,i,a,r,c,s,d){r=""+r,s.push(r);var u,p=t[r];for(key in p)if("length"!==key&&p.hasOwnProperty(key))for(key1 in a)if("length"!==key1&&a.hasOwnProperty(key1)){u=a[key1];var f=e[u];if(f&&f.oid==key&&-1==$.inArray(""+f.oid,s)){if(!p[key])continue;var v=p[key][c];if(v&&v.length){var m=[];v.forEach(function(e){n[key].Values[e]&&m.push(n[key].Values[e])});var g=l(i,f.element,f.propertyName,m,b.Values,key,d)}else l(i,f.element,f.propertyName,[],b.Values,key,d);g&&o(e,t,n,i,a,key,g,s,d)}}}function l(e,t,n,i,a,r,o){var l=t.data("kendoAutoComplete"),u=new kendo.data.DataSource({data:i});l.setDataSource(u);var p,f;return 1==i.length?(p=i[0],f=s(a,r,p),!f&&o&&(f=d(o,p)),c(p,f,e,r,n,l)):0==i.length&&(p="",f="",c(p,f,e,r,n,l)),l.value(p),f}function c(e,n,i,a,r,o){var l=i.find("#txt"+r);l&&l.val()!=e&&(i.find("#hdn"+r).val(n),t.fireEvent(ObjectDetailFieldUpdatedEvent,{container:i,value:e,propertyId:n,propertyFk:a,propertyName:r}),o.value(e))}function s(e,t,n){try{var i=e[t].InvertedValues[n]}catch(a){i=void 0}return i}function d(e,t){if(b&&b.Values){var n=b.Values;for(var i in n)if("length"!==i&&n.hasOwnProperty(i)&&(n[i].Name==e||n[i].RelatedEntityName==e))return n[i].InvertedValues[t]}return null}function u(e){var t,n,i,a;for(var r in e)if("length"!==r&&e.hasOwnProperty(r)){t=e[r];for(var o in t)if(i=e[o]||{},"length"!==o&&t.hasOwnProperty(o)){n=t[o];for(var l in n)"length"!==l&&n.hasOwnProperty(l)&&(a=n[l],a&&a.length&&a.forEach(function(e){i[r]||(i[r]={}),i[r][e]?-1===$.inArray(l,i[r][e])&&i[r][e].push(l):i[r][e]=[l]}));e[o]=i}}}function p(e){for(var t in e)if("length"!==t&&e.hasOwnProperty(t))for(var n in e[t])if("length"!==n&&e[t].hasOwnProperty(n)&&$.isArray(e[t][n])){var i={};e[t][n].forEach(function(e){for(var t in e)"length"!==t&&e.hasOwnProperty(t)&&(i[t]=e[t])}),e[t][n]=i}}function f(e){var t;return Object.keys(e).forEach(function(n){t={};var i=e[n].Values;Object.keys(i).forEach(function(e){t[i[e]]=e}),e[n].InvertedValues=t}),e}function v(e){var t={};return $.isArray(e)&&e.length>0&&(t=e.reduce(function(e,t){return m(e.Values,t.Values),m(e.Dependencies,t.Dependencies),e})),t}function m(e,t){if(!t)return e;if(!e)return t;for(var n in t)"length"!==n&&t.hasOwnProperty(n)&&(e.hasOwnProperty(n)||(e[n]=t[n]));return e}function g(){return++S}var h=e.getGlobalConfig(),b=[],y={},S=0,k=function(){};return k.getValuesWithIds=function(e){var t=[];if(e&&b.Values&&b.Values[e]){var n=b.Values[e].Values;for(var i in n){if(!n.hasOwnProperty(i))return!1;t.push({id:i,text:n[i]})}}return t},k.wrapElement=function(e,t,o,l,c,u,p,f,v){var m=$.data(t[0],"jqacuid");if(m||$.data(t[0],"jqacuid",g()),m&&y[m]&&y[m].element){if($.isArray(c)){var h=y[m].element.data("kendoAutoComplete");h&&h.dataSource.data(c)}}else{$.isArray(c)||(b.Values&&b.Values[l]&&(c=i(b.Values,l)),c||(c=n(o),!c.length&&v&&(c=n(v))),c=c||[]);var S=$.data(t[0],"jqacuid",g()),k={dataSource:c,filter:"contains",placeholder:"",separator:"",animation:!1,select:function(t){if(t.item&&t.item.text()){var n=t.item.text(),i=s(b.Values,l,n);!i&&v&&(i=d(v,n)),i&&(e.find("#hdn"+o).val(i),e.find("#txt"+o).val(n));var c=a(e);c.length&&!f&&r(y,b,e,c,l,n,v),$.isFunction(p)&&p(t)}}},D=angular.isObject(u)?angular.extend({},k,u):k;y[""+S]={element:t.kendoAutoComplete(D),propertyName:o,oid:l}}},k.getValuesByODN=function(e){var t=[];return b||k.prepareACData(acData),b&&(t=n(e)),t},k.prepareACData=function(e){var t=v(e),n={};return t.Values?(n.Values=t.Values,n.Values=f(n.Values),t.Dependencies&&(n.Dependencies=t.Dependencies,p(n.Dependencies),u(n.Dependencies)),void(b=n)):null},k}]),CSVapp.factory("popupService",["$q","$modal","localizationService",function(e,t,n){function i(e,n){var i=t.open({template:"<div></div>",settings:e,resolve:{items:function(){return n}},content:n});return i}function a(n,i){var a=e.defer(),r=t.open({template:"<div></div>",settings:n,resolve:{items:function(){return i}},content:i});return i.find("#yesButton").one("click",function(e){r.close(),a.resolve()}),i.find("#noButton").one("click",function(e){r.close(),a.reject()}),a.promise}var r={width:"250px",modal:!0,visible:!1,doCenterVert:!0},o={width:"405px",modal:!0,visible:!1,doCenterVert:!0},l={modal:!0,visible:!1,resizable:!0,maxHeight:650,minHeight:300,width:700,actions:["Pin","Minimize","Maximize","Close"]},c=function(){};return c.displayPrintTemplatePopup=function(e,t){return i(l,t)},c.displayMapPopup=function(e,t){return i(l,t)},c.confirm=function(e,t,i){var o,l=n.translate("Buttons.Yes"),c=n.translate("Buttons.No"),s='<div id="okCancelWindow">  <div style="text-align: center; width:100%">    <div style="margin:10px 0 15px 0">'+t+'</div>    <button class="k-button k-primary" id="yesButton" style="z-index=20000">'+l+'</button>    <button class="k-button" id="noButton" style="z-index=20000">'+c+"</button>    </div> </div> ";o=i?angular.extend({},r,i):r;var d=angular.element(s);return a(o,d)},c.confirmWithContent=function(e,t,i){var r=n.translate("Buttons.Done"),l=n.translate("Buttons.Cancel"),c='<div id="confirmPopup">  <div style="text-align: center; width:100%">   <div id="ModalPopupContent"></div>   <button class="k-button k-primary" id="yesButton" style="z-index:20001">'+r+'</button>    <button class="k-button" id="noButton" style="z-index:20001">'+l+"</button>    </div> </div> ",s=angular.element(c);s.find("#ModalPopupContent").append(angular.element(t));var d;return d=i?angular.extend({},o,i):o,d.title=e,a(d,s)},c}]),CSVapp.factory("listDataService",["$resource","configService",function(e,t){var n=t.getGlobalConfig(),i=n.token,a=t.getUrlBase("fetchListData"),r=a+"/:list/"+i+"?RequestType=ListValues";return e(r)}]),CSVapp.factory("listDataLoaderService",["$q","$http","configService","schemaService",function(e,t,n,i){function a(e){var t=o.filter(function(t){return e.ListName==t.ListName?t:void 0})[0];(null==t||void 0==t)&&o.push(e)}var r=n.getGlobalConfig(),o=[],l=function(){};return l.addEmptyListValue=function(e){return e},l.fetchMultipleListsData=function(o){var l=e.defer(),c=n.getUrlBase("fetchMultipleObjectListData")+"/"+r.token+"?RequestType=mlv",s=r.dataTypes,d=[];return i.getSchema(o).then(function(e){e?($.each(e.AllColumnsList,function(e,t){if(s.DropDownList==t.DataType||s.SearchableDropDownList==t.DataType||s.MultiSelectList==t.DataType){var n=new Object;n.ListName=t.InputSettings,d.push(n)}}),d&&d.length?t.post(c,JSON.stringify(d)).success(function(e){var t={};e.forEach(function(e){t[e.ListName]||(t[e.ListName]={ListName:e.ListName,ListValues:[]}),t[e.ListName].ListValues.push(e)});for(listKey in t)t.hasOwnProperty(listKey)&&a(t[listKey]);l.resolve(t)}).error(function(){l.reject("Failed to fetch multiple lists data")}):l.resolve([])):l.reject("Failed to fetch multiple lists data.No schema for object: "+o)}),l.promise},l.GetListObject=function(e,t){return l.GetListsData(e).then(function(e){return t&&(e=l.addEmptyListValue(e)),e})},l.GetListsDataByListName=function(e){return o.filter(function(t){return t.ListName==e?t:void 0})[0]},l.GetListsData=function(t){var i=e.defer(),o=n.getUrlBase("fetchListData")+"/"+t+"/"+r.token+"?RequestType=ListValues",c=null,s=l.GetListsDataByListName(t);return null!=s?(c=s.ListValues,i.resolve(c)):$.ajax({type:"GET",url:o,dataType:"json",success:function(e){null!=e&&e.unshift({Text:"",Value:""}),s=new Object,s.ListName=t,s.ListValues=e,a(s),c=e,i.resolve(c)},error:function(e,t,n){i.reject(e.getResponseHeader("ResponseCode"))}}),i.promise},l}]),CSVapp.factory("advancedSearchFilterExpressionService",["configService",function(e){function t(e,t){return"api"==e||t&&"main"!=t.toLowerCase()?new o(e):new l(e)}function n(e,t,n){var i=null;return t.properties.some(function(t){return t.propertyName==n?(i={key:t.string,value:e.filterObject},!0):!1}),i}var i=e.getGlobalConfig(),a=i.dataTypes,r=function(){};r.filterIsEmpty=function(e,n){var i=t(n);return i.filterIsEmpty(e)},r.processFilters=function(e,n,i){var a=t(n,i);return a.processFilters(e)},r.getFilterObject=function(e,n,i,a,r,o){var l=t(o,i);return{filterObject:l.getFilterObject(e,n,a,r),type:i,propertyName:a}},r.appendFilterObject=function(e,n,i,a,r,o,l,c){var s=t(l,c);return s.appendFilterObject(e,n,i,a,r,o)};var o=function(e){this.type=e};o.prototype.filterIsEmpty=function(e){return!(e.filters||e.customASFilters&&e.customASFilters.length)},o.prototype.processFilters=function(e){var t="";return e.forEach(function(e){""!=t&&(t+=" AND "),t+=e.filterObject}),t},o.prototype.appendFilterObject=function(e,t,i,a,r,o){if(e.filterObject.trim())if("main"==e.type.toLowerCase())i.push(e);else{var l=n(e,o[t.odn],r);l&&a.push(l)}},o.prototype.getFilterObject=function(e,t,n,i){var r="";switch(e.DataType){case a.Date:case a.DateTime:r="before"==i.type?"CONVERT(DATETIME2, ["+n+"]) <= CONVERT(DATETIME2, '"+t+"')":"CONVERT(DATETIME2, ["+n+"]) >= CONVERT(DATETIME2, '"+t+"')";
break;case a.Text:case a.AutoText:case a.TextBox:case a.ParentRelationship:case a.ObjectRelationship:r="["+n+"] like '%"+t+"%'";break;case a.DropDownList:case a.SearchableDropDownList:r="["+n+"] = '"+t+"'";break;case a.CheckBox:r="["+n+"] = '1'"}return r};var l=function(e){this.type=e};return l.prototype.filterIsEmpty=function(e){},l.prototype.processFilters=function(e){return e},l.prototype.appendFilterObject=function(e,t,i,a,r,o){if(e.filterObject)if("main"==e.type.toLowerCase())i.push(e);else{var l=n(e,o[t.odn],r);l&&a.push(l)}},l.prototype.getFilterObject=function(e,t,n,i){var r={type:e.DataType,name:n,value:t};switch(e.DataType){case a.Date:case a.DateTime:"before"==i.type?r.operator="<=":r.operator=">=";break;case a.Text:case a.AutoText:case a.TextBox:case a.ParentRelationship:case a.ObjectRelationship:r.operator="like";break;case a.DropDownList:case a.SearchableDropDownList:r.operator="==";break;case a.CheckBox:r.operator="==",r.value="1";break;default:r=null}return r},r}]),CSVapp.factory("advancedSearchService",["$rootScope","$q","schemaService","configService","autocompleteService","listDataLoaderService","fieldPropertiesService","advancedSearchFilterExpressionService",function(e,t,n,i,a,r,o,l){function c(e){var n,i,o=t.defer(),l=[],c=[],s=[];return e.forEach(function(e){switch(e.DataType){case u.DropDownList:case u.SearchableDropDownList:n=e.InputSettings,l.push(r.GetListObject(n,!0).then(function(t){return t.propertyId=e[p],t}));break;case u.ParentRelationship:case u.ObjectRelationship:i={};var t=e.InputSettings.split(":"),o=t[0],c=t[1];o&&c&&(i.values=a.getValuesByODN(c),i.propertyId=e[p],i.oid=o,i.odn=c,s.push(i))}}),l.length?t.all(l).then(function(e){o.resolve({listObjects:e,acValues:s})}):o.resolve({listObjects:c,acValues:s}),o.promise}function s(e){var t=[];return e.forEach(function(e){(e.DataType==u.DropDownList||e.DataType==u.SearchableDropDownList)&&t.push(""+e[p])}),t}var d=i.getGlobalConfig(),u=d.dataTypes,p=SUConstants.PropertyDefinitionID,f=function(){};f.filterIsEmpty=function(e,t){return l.filterIsEmpty(e,t)},f.setDefaultValues=function(e,t){e.forEach(function(e){switch(e.DataType){case u.Date:case u.DateTime:t[e[p]]={type:"before",valid:!0}}})},f.getFieldsObjects=function(e){var n=t.defer(),i=[],a=[];for(var r in e){if(!e.hasOwnProperty(r))return;var l=e[r].properties.map(function(e){return e.propertyName});a.push(o.getAllPropertiesOfFieldsArrayPromise(l,r))}var c=0;return a.forEach(function(e){e.then(function(e){c++,e.forEach(function(t){t.odn=e.odn,i.push(t)}),c==a.length&&n.resolve(i)},function(){c++,c==a.length&&n.resolve(i)})}),n.promise},f.CheckOptions=function(e){return e.odn&&e.propertyID&&e.propertyViewType?!0:!1},f.createFilterObject=function(e,t,n,i){var a,r,o,c,s,d,f=[],m=[],g=[];t.forEach(function(t){if(c=t[p],r=e[c],a=r?r.value:null,t.DataType==u.DropDownList||t.DataType==u.SearchableDropDownList){var h=t[p],b=angular.element("#ddl_"+h);!b.length;var y=b.data("kendoDropDownList");y&&(a=y.value())}a&&(o=t.PropertyName,s=n[t.odn].type,v(a,t.DataType)?(d=l.getFilterObject(t,a,s,o,r,i),l.appendFilterObject(d,t,f,g,o,n,i,s)):m.push({type:t.DataType,name:o,value:a,index:t[p]}))});var h=l.processFilters(f,i);return{filters:h,errors:m,customASFilters:g}},f.WrapElements=function(e,t){c(e).then(function(e){var n,i,r=$.isArray(e.listObjects)?e.listObjects:[];r.forEach(function(e){n=e.propertyId,i=angular.element("#ddl_"+n),i.kendoDropDownList({dataSource:new kendo.data.DataSource({data:e}),dataTextField:"Text",dataValueField:"Value",optionLabel:" "})});var o=$.isArray(e.acValues)?e.acValues:[];o.forEach(function(e){n=e.propertyId,i=angular.element("#rel_"+n);var r=n;a.wrapElement(null,i,e.odn,e.oid,e.values,{width:200},function(e){var n=e.item;if(n){var i=n.text();t[r]?t[r].value=i:t[r]={value:i}}},!0)})})},f.ClearInvalidFields=function(e){for(elem in e)e.hasOwnProperty(elem)&&(e[elem].valid=!0)},f.ClearParamsValues=function(e,t){var n=s(t);for(param in e)if(e.hasOwnProperty(param))if(-1!=$.inArray(param,n)){var i=angular.element("#ddl_"+param),a=i.data("kendoDropDownList");a&&a.value("")}else e[param].value=""};var v=function(e,t){switch(t){case u.DateTime:case u.Date:if(e){var n=kendo.parseDate(e);if(n&&!isNaN(n.getDate()))return!0}return!1}return!0};return f}]),CSVapp.factory("advancedSearchTemplateService",["$q","$http","configService","schemaService",function(e,t,n,i){function a(t){var n=e.defer();if(p)n.resolve(p);else if(d.advancedSearchTpl){var i=d.advancedSearchTpl;p=r(i),n.resolve(p)}else l(t).then(function(e){p=e,n.resolve(p)},n.resolve(null));return n.promise}function r(e){if(!e)return null;var t=e.split(",");if(!t.length)return null;var n=[];return t.forEach(function(e){if("string"!=typeof e)return!1;var t=e.trim().split(".");t.length<3||(n=o(n,t,e))}),n}function o(e,t,n){var i=t.length-1;if("string"==typeof t[0]||"string"==typeof t[i]||"string"==typeof t[i-1]){var a=t[i-1].trim(),r=t[0].trim(),o=t[i].trim();t.pop();var l=t.join("."),c={propertyName:o,string:l};e.hasOwnProperty(a)?e[a].properties.push(c):e[a]={type:r,properties:[c]}}return e}function l(t){var n=e.defer();return n.resolve(null),n.promise}function c(e,t){return i.GetVisibleFieldsDetails(e,t).then(function(t){var n=s(t),i=[];return i[e]={type:"Main",properties:[]},n.forEach(function(t){i[e].properties.push({propertyName:t.PropertyName,string:"Main."+e+"."+t.PropertyName})}),i})}function s(e){return e.filter(function(e){return-1!=$.inArray(e.DataType,f)})}var d=n.getGlobalConfig(),u=d.dataTypes,p=null,f=[u.Date,u.DateTime,u.Text,u.AutoText,u.TextBox,u.DropDownList,u.SearchableDropDownList,u.ParentRelationship,u.ObjectRelationship,u.CheckBox],v=function(){};return v.getFieldParentalType=function(e,t,n){return n[t].type},v.getAdvancedSearchTemplate=function(e,t){return a(e).then(function(n){return n?n:c(e,t).then(function(e){return e})})},v}]),CSVapp.directive("advancedsearchtab",["$rootScope","configService","localizationService",function(e,t,n){var i={type:"local",propertyID:"PropertyDefinition_ID",propertyViewType:"selected"},a=function(e,t,n){e?n.show():n.hide();var i=n.width();e?t.$emit(FilterExpandedEvent,i):t.$emit(FilterCollapsedEvent,i);var a=e?-i:i;t.$emit(ASTabChangeWidthEvent,a)};return{restrict:"EA",templateUrl:function(e,n){return n.templateUrl||t.getTemplateUrl("AdvancedSearch/AdvancedSearchToolbarTemplate.html")},replace:!0,scope:!0,controller:["$scope","$element","$rootScope","$timeout","$attrs","schemaService","configService","advancedSearchService","notificationService","advancedSearchTemplateService",function(e,t,r,o,l,c,s,d,u,p){o(function(){var o;return o=l.asOptions&&angular.isObject(e[l.asOptions])?angular.extend(i,e[l.asOptions]):i,d.CheckOptions(o)?(p.getAdvancedSearchTemplate(o.odn,o.propertyViewType).then(function(t){d.getFieldsObjects(t).then(function(n){e.propertyList=n,e.asTemplateObjects=t})}),e.odn=o.odn,e.options=o,e.dateTimePickerOptions={format:"G"},e.tr={search:n.translate("AdvancedSearch.Search"),clear:n.translate("AdvancedSearch.Clear"),before:n.translate("AdvancedSearch.Before"),after:n.translate("AdvancedSearch.After")},e.filter="",e.propertyList=[],e.elementParams=[],e.propertyID=o.propertyID,e.search=function(){var t=d.createFilterObject(e.elementParams,e.propertyList,e.asTemplateObjects,e.options.type),n=t.errors;return d.ClearInvalidFields(e.elementParams),angular.isArray(n)&&n.length>0?n.forEach(function(t){e.elementParams[t.index].valid=!1}):d.filterIsEmpty(t,e.options.type)||r.$broadcast(AdvancedSearchFilterSetEvent,{filters:t.filters,customASFilters:t.customASFilters}),!1},e.clear=function(){"local"==e.type?e.filter=[]:e.filter="",d.ClearParamsValues(e.elementParams,e.propertyList),d.ClearInvalidFields(e.elementParams),r.$broadcast(AdvancedSearchFilterSetEvent,{filters:e.filter,customASFilters:[]})},r.$on(AdvancedSearchTabButtonCollapsedEvent,function(){e.showMe=!1,a(e.showMe,e,t)}),void r.$on(AdvancedSearchTabButtonExpandedEvent,function(){e.showMe=!0,a(e.showMe,e,t)})):void u.showNotification("Advanced search component options are invalid",!0)})}]}}]),CSVapp.directive("onRepeatDoneAs",["$timeout","advancedSearchService",function(e,t){return{restriction:"A",link:function(n,i,a){e(function(){n.$last&&(t.WrapElements(n.propertyList,n.elementParams),t.setDefaultValues(n.propertyList,n.elementParams))},500)}}}]),CSVapp.directive("advancedsearchtabbutton",["$rootScope","$cookieStore","configService","localizationService",function(e,t,n,i){var a=n.getGlobalConfig(),r=a.cookies.CookieAdvancedSearchTabOpened,o=function(n){n?(e.$broadcast(AdvancedSearchTabButtonExpandedEvent),t.put(r,"1")):(e.$broadcast(AdvancedSearchTabButtonCollapsedEvent),t.remove(r))};return{restrict:"EA",templateUrl:function(e,t){return t.templateUrl||n.getTemplateUrl("AdvancedSearch/ButtonTemplate.html")},replace:!0,scope:!0,priority:120,controller:["$scope",function(e){e.showMe=t.get(r)?!0:!1,o(e.showMe),e.title=i.translate("Headers.AdvancedSearch"),e.labelHide=i.translate("Filters.Hide"),e.showMe=!1,e.toggle=function(){e.showMe=!e.showMe,o(e.showMe)}}]}}]),CSVapp.directive("advancedsearchelement",["configService",function(e){return{restrict:"E",templateUrl:function(t,n){return n.templateUrl||e.getTemplateUrl("AdvancedSearch/ElementTemplate.html")},replace:!0}}]),CSVapp.factory("filterService",["$rootScope","$q","schemaService","configService","notificationService",function(e,t,n,i,a){function r(e,t,n){for(var i=e.length;i--;)e[i]&&e[i].hasOwnProperty(t)&&arguments.length>2&&e[i][t]===n&&e.splice(i,1);return e}function o(e,t){var n=v+t;return e.filter(function(e){return e.SettingKey==n?e:void 0})[0]}function l(e){var n=t.defer(),a=s(e),r=i.getUrlBase("getObjectModuleUserSettings");if(null==a&&r){var o=r+"/"+g.token+"?RequestType=us",l=new Object;l.SettingKey="SavedFilter_"+e,l.SettingGroup=e,$.ajax({type:"POST",url:o,data:JSON.stringify(l),dataType:"json",success:function(e){n.resolve(e)},error:function(e,t,i){n.reject(e.getResponseHeader("ResponseCode"))}})}else n.resolve([a]);return n.promise}function c(e){var t=i.getUrlBase("updateObjectModuleUserSettings");if(t){var n=t+"/"+g.token+"?RequestType=uus";$.ajax({type:"POST",url:n,data:JSON.stringify(e),dataType:"json",success:function(e){},error:function(e,t,n){var i=e.getResponseHeader("ResponseCode");"UnAuthorized"==i?alert(e.getResponseHeader("ResponseCode")):alert($config.URLs.UpdateObjectModuleUserSettingsURL+":=:"+e.status+" "+t+" "+n)}})}}function s(e){return m.filter(function(t){return t.SettingGroup==e?t:void 0})[0]}function d(e){return f.filter(function(t){return t.ObjectDefinitionName==e?t:void 0})[0]}function u(e){var t=d(e.ObjectDefinitionName);(null==t||void 0==t)&&f.push(e)}function p(e,t,n){var r=g.postData,o=new Object;void 0!=r.RequestType&&(o.RequestType="ofl");var l=i.getUrlBase("getFilters");if(l){var c=l+"/"+e+"/"+g.token;$.ajax({type:"GET",url:c,data:o,dataType:"json",cache:!1,async:!1,success:function(i){console.log("get filters success");var a=new Object;if(a.ObjectDefinitionName=e,null!=i){var r=new Object;r.FilterID="nonefilter",r.FitlerLabel=$.objectLanguage.Filters.NoFilter,r.FitlerName=$.objectLanguage.Filters.NoFilter,r.FitlerExpression="",r.SettingGroup=e,i.unshift(r)}a.FilterList=i,$.each(a.FilterList,function(e,t){(""==t.FitlerLabel||null==t.FitlerLabel)&&(t.FitlerLabel=t.FitlerName)}),u(a),"function"==typeof n&&n(e,t,i,!0)},error:function(i,r,o){console.log("get filters error");var l=i.getResponseHeader("ResponseCode");"UnAuthorized"==l?a.showNotification(i.getResponseHeader("ResponseCode"),!0):n(e,t,[],!0)}})}}var f=[],v="SavedFilter_",m=[],g=i.getGlobalConfig(),h=function(){};return h.CheckOptions=function(e){return e.odn?!0:!1},h.AddFilterSetting=function(e,t){var n=[],i=v+t,a={SettingKey:i,SettingValue:e.FilterID,SettingGroup:t,UserName:g.userName};n.push(a),r(m,"SettingKey",i),m.push(a),c(n)},h.getFiltersList=function(e,t){var n=d(e);return void 0==n||null==n?p(e,t,h.SetSelectedFilter):void(t.filterList=n.FilterList)},h.SetSelectedFilter=function(t,n,i,c){var s=function(a){var l=null;if(void 0!=a)var s=o(a,t);if(void 0!=s&&null!=s){var d=v+t;r(m,"SettingKey",d),m.push(s),i.some(function(e){var t=e.FilterID;return s.SettingValue==t?(l=e,e.Checked=!0,!0):!1}),i.length&&!l&&(i[0].Checked=!0)}c&&(l=l||"",e.appliedFilter=l,e.$broadcast(FilterSetEvent,l)),n.filterList=i},d=function(t){i.length&&(i[0].Checked=!0),"UnAuthorized"==t&&a.showNotification(t),c&&(e.appliedFilter=null,e.$broadcast(FilterSetEvent,"")),n.filterList=i};l(t).then(s,d)},h}]),CSVapp.directive("filterDropdownScheduler",["$rootScope","filterService","notificationService",function(e,t,n){function i(n,i){var a=n.sender.dataItem();e.$broadcast(FilterSetEvent,a),t.AddFilterSetting(a,i)}var a;return{restrict:"E",template:'<li class="filterDropdownContainer"><div id="filterDropDown"></div></li>',replace:!0,scope:!0,priority:120,link:function(e,t,n){a=t.find("#filterDropDown").kendoDropDownList({dataTextField:"FitlerLabel",dataValueField:"FitlerID",dataSource:e.filterList,index:0,change:function(t){i(t,e.odn)}}),e.$watch("filterList",function(t){var n=null;a.data("kendoDropDownList").dataSource.data(t),t.length&&(t.some(function(e,t){return e.Checked?(n=t,!0):!1}),null!==n&&a.data("kendoDropDownList").select(n),e.$emit(FilterReadyEvent))})},controller:["$scope","$attrs",function(e,i){var a,r={};return a=i.filterOptions&&angular.isObject(e[i.filterOptions])?angular.extend(r,e[i.filterOptions]):r,t.CheckOptions(a)?(e.odn=a.odn,e.filterList=[],void t.getFiltersList(e.odn,e)):void n.showNotification("Filter component options are invalid",!0)}]}}]),CSVapp.directive("filterdropdown",["$rootScope","filterService","notificationService",function(e,t,n){function i(n,i){var a=n.sender.dataItem();e.$broadcast(FilterSetEvent,a),t.AddFilterSetting(a,i)}var a;return{restrict:"E",template:'<span class="filterDropdownContainer"><div id="filterDropDown"></div></span>',replace:!0,scope:!0,priority:120,link:function(e,t,n){a=t.find("#filterDropDown").kendoDropDownList({dataTextField:"FitlerLabel",dataValueField:"FitlerID",dataSource:e.filterList,index:0,change:function(t){i(t,e.odn)}}),e.$watch("filterList",function(t){var n=null;a.data("kendoDropDownList").dataSource.data(t),t.length&&(t.some(function(e,t){return e.Checked?(n=t,!0):!1}),null!==n&&a.data("kendoDropDownList").select(n),e.$emit(FilterReadyEvent))})},controller:["$scope","$attrs",function(e,i){var a,r={};return a=i.filterOptions&&angular.isObject(e[i.filterOptions])?angular.extend(r,e[i.filterOptions]):r,t.CheckOptions(a)?(e.odn=a.odn,e.filterList=[],void t.getFiltersList(e.odn,e)):void n.showNotification("Filter component options are invalid",!0)}]}}]),CSVapp.directive("filtertab",["$rootScope",function(e){var t=$("#ObjectFilterToolbarTemplate").html(),n=function(t){t?e.$broadcast(FilterExpandedEvent):e.$broadcast(FilterCollapsedEvent)};return{restrict:"EA",template:t,replace:!0,scope:!0,priority:110,controller:["$scope","$element","$attrs","$timeout","$rootScope","filterService","notificationService",function(e,t,i,a,r,o,l){var c,s={};if(c=i.filterOptions&&angular.isObject(e[i.filterOptions])?angular.extend(s,e[i.asOptions]):s,!o.CheckOptions(c))return void l.showNotification("Filter component options are invalid",!0);var d=c.odn;e.filterList=[],o.getFiltersList(d,e),e.showMe=!1,e.$on(CheckFilterStateEvent,function(){console.log("FilterEvent"),a(function(){$("._filterContainer",t).buttonset()},0)}),r.$on(FilterTabButtonCollapsedEvent,function(){e.showMe=!1,n(e.showMe)}),r.$on(FilterTabButtonExpandedEvent,function(){e.showMe=!0,n(e.showMe)}),e.toggle=function(){e.showMe=!e.showMe},e.selected=function(t){var n=e.filterList[t];n&&!n.Checked&&(e.filterList.forEach(function(e,n){e.Checked=n==t?!0:!1}),r.$broadcast(FilterSetEvent,n),o.AddFilterSetting(n,d))}}]}}]),CSVapp.directive("onRepeatDone",function(){return{restriction:"A",link:function(e,t,n){e.$last&&e.$emit(FilterReadyEvent)}}}),CSVapp.directive("filtertabbutton",["$rootScope","$cookieStore","configService",function(e,t,n){var i=n.getGlobalConfig(),a=i.cookies.CookieFilterOpened,r=$("#ObjectFilterToolbarButtonTemplate").html(),o=function(n){n?(e.$broadcast(FilterTabButtonExpandedEvent),t.put(a,"1")):(e.$broadcast(FilterTabButtonCollapsedEvent),t.remove(a))};return{restrict:"EA",template:r,replace:!0,scope:!0,priority:120,controller:["$scope",function(e){e.$on(CheckFilterStateEvent,function(){console.log(CheckFilterStateEvent+" catched"),e.showMe=t.get(a)?!0:!1,o(e.showMe)}),e.title=$.objectLanguage.Headers.Filters,e.labelHide=$.objectLanguage.Filters.Hide,e.showMe=!1,e.toggle=function(){e.showMe=!e.showMe,o(e.showMe)}}]}}]);var speedupSchedulerModule=angular.module("speedup.scheduler",["speedup.CSVModule"]);speedupSchedulerModule.factory("schedulerAPIFilterService",["configService",function(e){function t(e,t){var n=i.startField;return"["+n+"] IS NOT NULL AND ["+n+"] <> '' AND SUBSTRING(["+n+"], 1, 3) = '201' AND CONVERT(DATETIME2, ["+n+"]) >= CONVERT(DATETIME2, '"+e+"') AND CONVERT(DATETIME2, ["+n+"]) <= CONVERT(DATETIME2, '"+t+"')"}var n=function(){},i=e.getSchedulerConfig();return n.mergeFilterExpression=function(e,t){return e?t?e+" AND "+t:e:t},n.getFilterExpressionByDate=function(n){var i=e.getSchedulerConfig(),a=new Date(n.getFullYear(),n.getMonth(),1),r=new Date(n.getFullYear(),n.getMonth()+1,0),o=i.numberOfDaysToAdd;a.setDate(a.getDate()-o),r.setDate(r.getDate()+o);var l=a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate(),c=r.getFullYear()+"-"+(r.getMonth()+1)+"-"+r.getDate();return t(l,c)},n}]),speedupSchedulerModule.directive("speedupScheduler",["$rootScope","$compile","schemaService","configService","notificationService","schedulerHelper","eventManager","schedulerDataSourceService","schedulerParametersService","schedulerRefreshService",function(e,t,n,i,a,r,o,l,c,s){return{templateUrl:function(e,t){return t.templateUrl||i.getTemplateUrl("Sheduler/SchedulerDirectiveTemplate.html")},restrict:"EA",transclude:!0,replace:!0,link:function(e,n){var a=i.getSchedulerConfig(),d=i.getGlobalConfig(),u=a.objectDefinitionName,p=d.objectDefinitionName;e.asOptions={type:"local",odn:u,pageTemplateName:a.pageTemplateName,propertyViewType:"jsonSelected"};var f=c.getObjectParameters(e,u);o.addListener(ObjectPropertySavedEvent,function(e){if(e.odn==u){var t=e.fieldName,n=e.fieldValue,i=e.recordId,r=angular.element(a.schedulerHolder).data("kendoScheduler");t&&n&&i&&r&&l.updateSingleProperty(t,n,i,r)}}),o.addListener(ObjectCopiedEvent,function(e){r.refreshObjectDS(e,u,a.schedulerHolder,!0)}),o.addListener(ObjectSavedEvent,function(e){r.refreshObjectDS(e,u,a.schedulerHolder)}),o.addListener(ObjectDeletedEvent,function(e){r.removeObjectFromDS(e,u,p,a.schedulerHolder)}),e.$on(FilterSetEvent,function(t,n){n?(n.FitlerExpression!=f.ForeignFilter||e.waitForFilter)&&(e.waitForFilter=!1,f.ForeignFilter=n.FitlerExpression,s.refreshWithFilter(f,f.OwnFilter,f.ForeignFilter),e.advancedSearchRefreshPending=!0):(e.waitForFilter=!1,s.refreshWithFilter(f,f.OwnFilter,f.ForeignFilter),e.advancedSearchRefreshPending=!0)}),e.$on(AdvancedSearchFilterSetEvent,function(e,t){f.LocalASFilters=t.filters,f.CustomASFilters=t.customASFilters;var n=a.resourceField;s.refreshWithAdvancedSearch(f,!0,u,n)}),e.$on(ResourcePanelFilterChangedEvent,function(e,t){var n=a.resourceField;f.ResourcePanelFilters=t,s.refreshWithAdvancedSearch(f,!1,u,n)}),c.getWidgetParameters(e,f).then(function(n){e.schedulerOptions=n;var i=a.schedulerHolder;if(i){$(i).kendoScheduler(n);var r=$(i).data("kendoScheduler"),o=angular.element('<filter-dropdown-scheduler filter-options="filterOptions"></filter-dropdown-scheduler>');if(t(o)(e),angular.element(".k-scheduler-views").append(o),a.showResourcePanel){$.isArray(n.resources)&&n.resources.length&&(e.resourcePanelData=n.resources[1].dataSource);var l=angular.element("<scheduler-resource-button></scheduler-resource-button>"),c=e.$new();t(l)(c),$(".k-scheduler-toolbar").prepend(l),e.$on(SchedulerResourceButtonClickedEvent,function(t,n){e.$broadcast(SchedulerResourcePanelToggleEvent,n)}),e.$on(SchedulerChangeWidthEvent,function(e,t){var n=$(i).width()+t;$(i).width(n),r.refresh()})}}})}}}]),speedupSchedulerModule.directive("schedulerResourcePanel",["configService",function(e){return{templateUrl:function(t,n){return n.templateUrl||e.getTemplateUrl("Sheduler/ResourcePanel/SchedulerResourcePanelTemplate.html")},restrict:"EA",replace:!0,transclude:!0,link:function(e,t){e.colorBackground=function(){t.find(".k-checkbox-label").each(function(t,n){if(0!=t){var i=e.resourcePanelData[t-1].color,a="#"+$(n).attr("id");$("<style>"+a+":before{background-color:"+i+"}</style>").appendTo("head")}})},e.filterContent=function(){var t=e.resourcePanelData.filter(function(e){return e.selected});e.$emit(ResourcePanelFilterChangedEvent,t)},e.checkAllState=!0,e.checkAll=function(){e.resourcePanelData.forEach(function(t){t.selected=e.checkAllState}),e.filterContent()},e.$on(SchedulerResourcePanelToggleEvent,function(n,i){i?t.show():t.hide();var a=t.width()+40,r=i?-a:a;e.$emit(SchedulerChangeWidthEvent,r)})}}}]).directive("schedulerResourceButton",[function(){return{template:"<div class='scheduler-resource-button'><span class='scheduler-resource-btn-img'></span></div>",restrict:"EA",replace:!0,transclude:!0,link:function(e,t){e.opened=!1,t.on("click",function(){e.opened=!e.opened,e.$emit(SchedulerResourceButtonClickedEvent,e.opened)})}}}]).directive("rpPostRepeat",["$timeout",function(e){return{link:function(t,n){t.$last&&e(t.colorBackground)}}}]),speedupSchedulerModule.factory("schedulerDataSourceService",["configService",function(e){var t={},n=e.getSchedulerConfig();return t.updateSingleProperty=function(e,i,a,r){var o=r.dataSource;if(o){var l=o.data();if(l){var c=n.resourceField;l.some(function(s){return s.ObjectEntry_ID==a?(e==n.startField?s.start=kendo.parseDate(i):e==n.endField?s.end=kendo.parseDate(i):s[e]=i,t.checkAndUpdateIfDatePassed(s,!0,c),o.data(l),r.refresh(),!0):!1})}}},t.checkAndUpdateIfDatePassed=function(e,t,i){var a,r=(new Date).getTime();if(t)a=e.end;else{var o=n.endField;a=kendo.parseDate(e[o])}if(a){var l=a.getTime();r>l&&i?e.eventEndPassed=e[i]:delete e.eventEndPassed}},t}]),speedupSchedulerModule.factory("schedulerPopupService",["$modal","$log","configService","notificationService","objectDataService","localizationService","objectDetailService","existingObjectDetailService","eventManager","objectDetailDisplayerService","schemaService",function(e,t,n,i,a,r,o,l,c,s,d){var u=n.getSchedulerConfig(),p=u.objectDefinitionName,f=u.mainObjectDefinitionName,v=u.pageTemplateName||"Default",m={};return m.openPopupHandler=function(e){var t=e.event,n=$(u.schedulerPopupHolder),i=kendo.toString(e.event.start,"yyyy-MM-dd HH:mm:ss"),a={odn:p};if(a[u.startField]=i,a[u.endField]=kendo.toString(new Date(e.event.start.getTime()+6e4*u.startEndDiff),"yyyy-MM-dd HH:mm:ss"),t.id){var r=t.Work_Order.split(":"),o=r[0];r[1];m.openPopup(o,a)}else m.openPopupNewEntity(e,a);e.preventDefault(),e.container=$(n)},m.openPopupNewEntity=function(e,t){c.fireEvent(LoadActionStartEvent);var i=n.getSchedulerConfig(),a={odn:f,recordId:null,fieldEditMode:"multiple",pageSize:5,displayMode:{type:i.ObjectDetailDisplayMode},editMode:"detail"};t&&(a.overridenFields=t),o.addNewRecord(f,a).then(function(e){c.fireEvent(LoadActionEndEvent),c.addListener(NewODActionButtonClicked,function(){e.close()},a),c.addListener(NewODCreated,function(e){c.disposeListeners(a),m.openPopupForRecentlyCreatedEvent(e,t)},a),e.onClose(function(){c.disposeListeners(a)})})},m.openPopupForRecentlyCreatedEvent=function(e,t){var n=(e.ObjectDefinitionName,JSON.parse(e.SavedData)[0]);e.image&&(n[SUConstants.RecordFirstImageColumn]=e.image);var i=e.ObjectEntryID,a={odn:f,pageTemplateName:v,recordId:i,fieldEditMode:"single",pageSize:5,displayMode:{type:u.ObjectDetailDisplayMode},editMode:"detail",currentRecord:{id:e.ObjectEntryID,name:e.ObjectEntryName,fk:e.ObjectDefinitionID}};t&&(a.overridenFields=t),l.createDetailPageBlock(a,n).then(function(e){d.createPageTitle(a.odn).then(function(t){var n=s.getDisplayer(a.displayMode);n.getDetailViewNew(t,e)})})},m.openPopup=function(e,t){var n={odn:f,pageTemplateName:v,recordId:e,fieldEditMode:"single",pageSize:5,displayMode:{type:u.ObjectDetailDisplayMode},editMode:"detail"};t&&(n.overridenFields=t),l.getObjectsWithSubObjects(n)},m}]),speedupSchedulerModule.factory("schedulerHelper",["$rootScope","$compile","$q","configService","notificationService","objectService","schedulerDataSourceService","localizationService",function(e,t,n,i,a,r,o,l){var c=i.getSchedulerConfig(),s=c.objectDefinitionName,d=i.getGlobalConfig(),u={};return u.read=function(e,t,n){if(t)e.success([]);else{var r=i.getUrlBase("objectRecordList")+"/"+d.token;$.ajax({type:"POST",url:r,data:kendo.stringify(n),contentType:"application/json; charset=utf-8",dataType:"json",success:function(t){e.success(u.parseResponse(t))},error:function(e,t,n){var i=l.translate("Messages.InvalidJson");a.showNotification(i,!0)}})}},u.removeObjectFromDS=function(e,t,n,i){var a=e.odn;if(t==a||n==a){var r=angular.element(i);if(r.length){var o=r.data("kendoScheduler");o&&(o.dataSource.read(),o.refresh())}}},u.refreshObjectDS=function(e,t,n,i){var a=e.ObjectDefinitionName;if(t==a||i){var r=angular.element(n);if(r.length){var o=r.data("kendoScheduler");o&&(o.dataSource.read(),o.refresh())}}},u.destroy=function(e){r.deleteObject(e.data[d.modelId],s,!0).then(function(t){e.success(t)},function(e){var t=l.translate("Messages.UnableToDeleteRecord");a.showNotification(t,!0)})},u.eventResizedSave=function(e){var t,n,i,o=e.event,l=!1;if(t=kendo.toString(e.start,"yyyy-MM-dd HH:mm:ss"),t!=kendo.toString(o.start,"yyyy-MM-dd HH:mm:ss")?(n=o.start,i=c.startField,o.start=e.start,l=!0):t=kendo.toString(e.end,"yyyy-MM-dd HH:mm:ss"),l||t==kendo.toString(o.end,"yyyy-MM-dd HH:mm:ss")||(n=o.end,i=c.endField,o.end=e.end,l=!0),l){var d=o.ObjectEntry_ID;r.getSettingsAndSaveObjectField(i,t,d,s,!0).then(function(){e.sender.refresh()},function(e){a.showNotification(e,!0),o.field=n})}e.preventDefault()},u.eventMovedSave=function(e){var t=e.event;if(kendo.toString(e.start,"yyyy-MM-dd HH:mm:ss")!=kendo.toString(t.start,"yyyy-MM-dd HH:mm:ss")){var n=t.ObjectEntry_ID,i=t.start,o=t.end;t.start=e.start,t.end=e.end;var l=function(){e.sender.refresh()},d=function(e){a.showNotification(e,!0),t.start=i,t.end=o},u=function(n){a.showNotification(n,!0),t.end=o,e.sender.refresh()},p=c.startField,f=c.endField,v=kendo.toString(t.start,"yyyy-MM-dd HH:mm:ss"),m=kendo.toString(t.end,"yyyy-MM-dd HH:mm:ss");r.getSettingsAndSaveObjectField(p,v,n,s,!0).then(r.getSettingsAndSaveObjectField(f,m,n,s,!0).then(l,u),d)}e.preventDefault()},u.parseResponse=function(e){var t,n,r=i.getSchedulerConfig(),l=r.startField,c=r.endField,s=r.titleField;try{null!=e&&e.length>0&&(e=$.parseJSON(e));var d=[],p=r.resourceField;e.forEach(function(e){t=u._getDateTimeStamp(e[l]),t?(n=u._getDateTimeStamp(e[c]),"undefined"==typeof e.Header&&(e.Header=e[s]),n?n>t&&(e[l]="/Date("+t+")/",e[c]="/Date("+n+")/",d.push(e)):console.log(e[s]+" End date is incorrect.")):console.log(e[s]+" Start date is incorrect."),o.checkAndUpdateIfDatePassed(e,!1,p)})}catch(f){a.showNotification($.objectLanguage.Messages.InvalidJson,!0)}return d},u._getDateTimeStamp=function(e){var t=new Date(e);return u._validateDate(t)||(t=kendo.parseDate(e,"yyyy-MM-dd HH:mm:ss"),t||(t=kendo.parseDate(e,"yyyy-MM-dd HH:mm")))?t.getTime():""},u._validateDate=function(e){var t=e.getTime();return t===t},u}]),speedupSchedulerModule.factory("schedulerParametersService",["$rootScope","configService","schedulerPopupService","schedulerHelper","schedulerRefreshService","schedulerResourcesService","schedulerAPIFilterService",function(e,t,n,i,a,r,o){function l(e,t){var n={editable:{mode:"inline"},batch:!1,transport:{read:function(n){i.read(n,e.waitForFilter,t)},destroy:i.destroy},schema:{model:{id:d.modelId,fields:{start:{from:s.startField,type:"date"},end:{from:s.endField,type:"date"},title:{from:"Header"}}}}};return d.mobileView&&(n.mobile=d.mobileView),n}function c(){return[{type:"day",dateHeaderTemplate:"<span class='k-link k-nav-day'>#=kendo.toString(date, 'ddd dd/M')#</span>"},{type:"week",dateHeaderTemplate:"<span class='k-link k-nav-day'>#=kendo.toString(date, 'ddd dd/M')#</span>"},{type:"workWeek",selected:!0,dateHeaderTemplate:"<span class='k-link k-nav-day'>#=kendo.toString(date, 'ddd dd/M')#</span>"},"month"]}var s=t.getSchedulerConfig(),d=t.getGlobalConfig(),u=function(){};return u.getObjectParameters=function(t,n){var i=new Date;t.waitForFilter=s.waitForFilter,t.advancedSearchRefreshPending=!1;var a=o.getFilterExpressionByDate(i),r="",l=angular.isObject(d.perspectiveFilter)&&d.perspectiveFilter[n]?d.perspectiveFilter[n]:"";l&&a?a=l+" AND "+a:l&&(a=l),e.appliedFilter?(t.waitForFilter=!1,r=e.appliedFilter):null===e.appliedFilter&&(t.waitForFilter=!1);var c=[],u=null,p=[];return{PageSize:-1,PageNumber:-1,Token:d.token,RequestType:"Detail",ObjectDefinitionName:n,OrderByExpression:"",FilterExpression:a,Perspective:l,SelectedGridColumns:"*",GenericSearch:"",CustomASFilters:[],OwnFilter:a,ForeignFilter:r,CurrentDate:i,AdvancedSearchFilters:p,LocalASFilters:c,ResourcePanelFilters:u}},u.getWidgetParameters=function(e,t){var o={objectParameters:t,editable:{mode:"inline"},height:s.height,views:c(),edit:n.openPopupHandler,resizeEnd:i.eventResizedSave,moveEnd:i.eventMovedSave,navigate:function(n){a.reload(e,t,n)},dataBinding:function(){e.waitForFilter&&e.$emit(SchedulerReadyEvent)},dataBound:function(){if(e.advancedSearchRefreshPending){e.advancedSearchRefreshPending=!1;var n=s.resourceField;a.refreshWithAdvancedSearch(t,!1,t.odn,n)}},workDayStart:new Date(s.workDayStart),workDayEnd:new Date(s.workDayEnd),showWorkHours:!0,dataSource:l(e,t)};return r.getResources(t.ObjectDefinitionName).then(function(e){return o.resources=e,o})},u}]),speedupSchedulerModule.factory("schedulerRefreshService",["$q","schedulerAPIFilterService","fieldPropertiesService","configService",function(e,t,n,i){function a(t){var n=e.defer();t=t||!1;var a=i.getSchedulerConfig(),r=$(a.schedulerHolder).data("kendoScheduler");if(r){if(t)return r.dataSource.read();r.refresh(),n.resolve()}return n.promise}function r(e,t,n){return angular.isArray(t)&&t.length&&e.filters.push({field:d(n),operator:function(e){return-1!=$.inArray(e,t)}}),e}function o(e){if(!angular.isArray(e))return null;if(!e.length)return["#*undefined*#"];var t=[];return e.forEach(function(e){t.push(e.value)}),t}function l(e){return"[object Date]"!==Object.prototype.toString.call(e)?!1:!isNaN(e.getTime())}function c(e,t,n,i){var a=null;switch(i){case v.Date:if(e=kendo.parseDate(e),t=kendo.parseDate(t),!l(e)||!l(t))return console.log("date is invalid"),a=!1;e.setHours(0),t.setHours(0),e.setMinutes(0),t.setMinutes(0),e.setSeconds(0),t.setSeconds(0),e.setMilliseconds(0),t.setMilliseconds(0);break;case v.DateTime:if(e=kendo.parseDate(e),t=kendo.parseDate(t),!l(e)||!l(t))return console.log("date is invalid"),a=!1;e.setMilliseconds(0),t.setMilliseconds(0);break;case v.Text:case v.TextBox:case v.DropDownList:case v.SearchableDropDownList:case v.ParentRelationship:case v.ObjectRelationship:case v.CheckBox:e=e.toLowerCase(),t=t.toLowerCase()}if(a||a===!1)return a;switch(n){case"<":return t>e;case">":return e>t;case"==":return e==t;case"<=":return t>=e;case">=":return e>=t;case"like":return-1==e.indexOf(t)?!1:!0}}function s(e){var t={logic:"and",filters:[]};if(angular.isArray(e)){var n;e.forEach(function(e){var i=e.filterObject;n={field:d(i.name),operator:function(e){return c(e,i.value,i.operator,i.type)}},t.filters.push(n)})}return t}function d(e){var t="";switch(e){case p.startField:t="start";break;case p.endField:t="end";break;default:t=e}return t}function u(e){return $.isArray(e)&&$.isArray(m)?e.length!=m.length?!1:e.length?e.some(function(e){return m.some(function(t){return e.key==t.key&&e.value==t.value})}):!0:!1}var p=i.getSchedulerConfig(),f=i.getGlobalConfig(),v=f.dataTypes,m=[],g=function(){};return g.reload=function(e,n,i){e.waitForFilter=!1;var a=i.date.getMonth(),r=n.CurrentDate.getMonth();
a!=r&&("previous"==i.action||"next"==i.action||"changeDate"==i.action)&&(n.CurrentDate=i.date,n.OwnFilter=t.getFilterExpressionByDate(i.date),n.FilterExpression=t.mergeFilterExpression(n.OwnFilter,n.ForeignFilter),i.sender.dataSource.read(),i.sender.refresh())},g.refreshWithAdvancedSearch=function(t,i,l,c){var d;d=Array.isArray(t.ResourcePanelFilters)&&t.ResourcePanelFilters.length&&c&&l?n.getAllPropertiesOfSingleFieldPromise(c,l):e.when([]);var f=$(p.schedulerHolder).data("kendoScheduler");return f?d.then(function(e){var n=t.LocalASFilters,l=s(n);if(angular.isObject(e))var d=(e.dataType,t.ResourcePanelFilters),p=o(d),v=r(l,p,c);else if(Array.isArray(e)&&!e.length)var p=o([]),v=r(l,p,c);else v=l;var g=t.customASFilters;return g&&i&&!u(g)?(m=g,t.CustomASFilters=g,a(!0).then(function(){return f.dataSource.filter(v),a(!1)}),void 0):(f.dataSource.filter(v),a(!1))}):d},g.refreshWithFilter=function(e,t,n){var i=[];""!=t&&i.push(t),""!=n&&i.push(n),e.FilterExpression=i.join(" AND "),a(!0)},g}]),speedupSchedulerModule.factory("schedulerResourcesService",["$q","configService","fieldPropertiesService","autocompleteService","localizationService",function(e,t,n,i,a){function r(e){switch(e){case c.ParentRelationship:case c.ObjectRelationship:return":";default:return""}}var o=t.getSchedulerConfig(),l=t.getGlobalConfig(),c=l.dataTypes,s=[{present:"#97cff2",passed:"rgba(151, 207, 242, 0.51)"},{present:"#2e9dc8",passed:"rgba(46, 157, 200, 0.51)"},{present:"#C83DA0",passed:"rgba(200, 142, 185, 0.51)"},{present:"#AF1CC8",passed:"rgba(175, 28, 200, 0.51)"},{present:"#7C36C8",passed:"rgba(124, 54, 200, 0.51)"},{present:"#2E2BC8",passed:"rgba(46, 43, 200, 0.51)"},{present:"#4484C8",passed:"rgba(68, 132, 200, 0.51)"},{present:"#2DA9C8",passed:"rgba(45, 169, 200, 0.51)"},{present:"#38C8BF",passed:"rgba(56, 200, 191, 0.51)"},{present:"#27C880",passed:"rgba(39, 200, 128, 0.51)"},{present:"#3CC837",passed:"rgba(60, 200, 55, 0.51)"},{present:"#96C838",passed:"rgba(150, 200, 56, 0.51)"},{present:"#C8C52B",passed:"rgba(200, 197, 43, 0.51)"},{present:"#C88B1A",passed:"rgba(200, 139, 26, 0.51)"},{present:"#C8581F",passed:"rgba(200, 88, 31, 0.51)"},{present:"#C8412E",passed:"rgba(200, 65, 46, 0.51)"},{present:"#C80000",passed:"rgba(187, 6, 0, 0.51)"},{present:"#00C800",passed:"rgba(0, 200, 0, 0.50)"},{present:"#0000C8",passed:"rgba(0, 0, 200, 0.50)"},{present:"#5750C8",passed:"rgba(87, 80, 200, 0.50)"},{present:"#BBBBBB",passed:"rgba(187, 187, 187, 0.51)"}],d=function(){};return d.getResources=function(t){var l=e.defer(),d=o.resourceField;if(!d)return l.resolve([]),l.promise;var u;return"string"==typeof d&&(u=d,n.getAllPropertiesOfSingleFieldPromise(u,t).then(function(e){var t=e.DataType;if(t==c.ParentRelationship||t==c.ObjectRelationship){var n=e.PropertyDefinition_ID,o=i.getValuesWithIds(n),d=o.sort(function(e,t){var n=(""+e.text).toLowerCase(),i=(""+t.text).toLowerCase();return n>i?1:i>n?-1:0}),p=1,f=s.length,v=r(e.DataType),m=a.translate("Labels.Unassigned"),g=[{text:m,value:v,color:s[0].present,selected:!0}],h=[{text:m,value:v,color:s[0].passed}];d.forEach(function(e){p>=f&&(p=1),g.push({text:e.text,value:e.id+":"+e.text,color:s[p].present,selected:!0}),h.push({text:e.text,value:e.id+":"+e.text,color:s[p].passed}),p++});var b=[{field:"eventEndPassed",dataSource:h,title:"eventEndPassed"},{field:u,dataSource:g}]}l.resolve(b)})),l.promise},d}]);var speedupGridModule=angular.module("speedup.grid",["speedup.CSVModule"]);speedupGridModule.controller("GridController",["$scope","configService",function(e,t){var n=t.getGlobalConfig(),i=n.objectDefinitionName;e.gridParameters={odn:i,selectedPage:0,perspectiveFilter:n.perspectiveFilter,filterExpression:"",genericSearch:"",refreshButton:!0,recordCountFilterExpression:"",gridHeight:400,pageSize:n.gridPageSize,columnWidth:"auto",columnMinWidth:150,columnMaxWidth:"auto",showEditButton:!1,showSelectButton:!1,showDeleteButton:!1,selectFirstRecord:!1,showCheckboxForRowSelection:!0,toolbar:e.gridToolbar||!1,displayMode:n.objectDetailDisplayType,pageTemplateName:n.pageTemplateName,odPageSize:n.objectDetailPageSize,showFirstRecord:n.showFirstRecord,batchUpdate:n.batchUpdate}}]),speedupGridModule.factory("gridRefreshService",["fieldPropertiesService","configService",function(e,t){var n=t.getGlobalConfig(),i=n.dataTypes,a=function(){};return a.removeObjectFromDS=function(e,t,n){var i=e.odn;t==i&&n&&n.dataSource.read()},a.refreshObjectDS=function(e,t,n){var i=e.ObjectDefinitionName;t==i&&n&&n.dataSource.read()},a.refreshSinglePropertyDS=function(e,t,n){var i=e.odn;t==i&&n&&(n.dataSource.data().some(function(t){return t.ObjectEntry_ID===e.recordId?(t[e.fieldName]=e.fieldValue,!0):!1}),n.refreshedWithoutAPICall=!0,n.refresh())},a.refreshMultiple=function(t,n,a){var r=t.odn,o=t.data;n==r&&a&&(a.dataSource.data().forEach(function(t){var a=$.inArray(t.ObjectEntry_ID,o.entries);-1!=a&&o.data.forEach(function(a){var r=e.getAllPropertiesOfSingleField(a.name,n),o=r.DataType;if(o==i.MultiObjectRelationshipField){var l,c=a.value.split(":");l=4==c.length?c[0]+":"+c[1]:a.value,t[a.name]=l}else t[a.name]=a.value})}),a.refreshedWithoutAPICall=!0,a.refresh())},a.refreshByGenericSearch=function(e,t,n){t.genericSearch=n,e.dataSource.read()},a.refreshByFilterExpression=function(e,t,n,i){t.filterExpression=n,t.customASFilters=i,e.dataSource.read()},a}]),speedupGridModule.factory("gridHelper",["$rootScope","$compile","filesystemService","gridFilterExpressionService","configService","notificationService","localizationService","gridDataService","commonService","existingObjectDetailService","relatedObjectsService","detailPageMapService","popupService","eventManager",function(e,t,n,i,a,r,o,l,c,s,d,u,p,f){function v(e){var t=[];return $(e).find("EntityItem").each(function(e,n){var i={};for(var a in n.attributes)if(n.attributes.hasOwnProperty(a)){var r=n.attributes[a].name;i[r]=n.attributes[a].value}$(n).find("Attributes").children().each(function(e,t){var n=t.tagName;i[n]=t.textContent}),t.push(i)}),t}function m(e){e.objectDetailDisplayer&&(e.objectDetailDisplayer.close(),e.objectDetailDisplayer=null)}function g(e){var t,i;t=e[SUConstants.RecordFirstImageColumn],i=SUConstants.ImageSizes.h60,e.image_h60=n.changeImageUrlAndSize(t,i)}function h(){f.fireEvent(LoadActionStartEvent)}function b(){f.fireEvent(LoadActionEndEvent)}var y=a.getGlobalConfig(),S=function(){};return S.openMapPopup=function(e,t){var n=$(t),i=n.data("lat"),a=n.data("long"),r=n.data("add"),o=n.data("zoom");o=1==$.isNumeric(o)?o:14;var l=!1,c=n.data("maptype");c=void 0==c||"undefined"==c?"":c;var s=!1,d=!1,f="<div id='ObjectGeoDataPopUp' style='height:350px;width:500px'></div>",v="ObjectGeoDataPopUp",m=p.displayMapPopup("Map",f);m.result.then(function(e){$("#ObjectGeoDataPopUp").remove()},function(){$("#ObjectGeoDataPopUp").remove()}),setTimeout(function(){u.initializeMap(i,a,null,null,l,v,r,null,null,null,o,c,s,d,!1)},1e3)},S.getGridOptions=function(e){return{mobile:y.mobileView,objectParameters:e,dataSource:{requestStart:h,requestEnd:b,pageSize:y.gridPageSize,serverPaging:!0,serverSorting:!0,serverFiltering:!0,isAfterSave:!1,selectedItem:[],transport:{read:{cache:!1,url:"http://185.31.160.22/shop",type:"POST",dataType:"xml"},parameterMap:function(t){return S.parameterMap(t,e)}},schema:null},height:e.gridHeight,scrollable:!0,filterable:{extra:!0,operators:{string:{startswith:"Starts with",endswith:"Ends With",eq:"Is equal to",neq:"Is not equal to",contains:"Contains"},date:{eq:"Is equal to",neq:"Is not equal to",gte:"Is after or equal to",lte:"Is before or equal to"}}},sortable:{mode:"single",allowUnsort:!0},selectable:"multiple, row",reorderable:!0,columnMenu:!0,pageable:{refresh:e.showEditButton},resizable:!1,editable:y.gridEditable,columns:[],dataBound:function(t){S.dataBound(t,e)},change:function(t){S.selectRow(t,e)},toolbar:'<div class="gridToolbar"></div>'}},S.selectRowByCheckbox=function(e,t,n,i){var a=t.element.find("tr.k-state-selected"),r=$(e.currentTarget).closest("tr"),o=t.dataItem(r),l=i.checked;if(l)a.length?m(n):S.showFirstRecord(o.ObjectEntry_ID,n),r.addClass("k-state-selected");else if(r.removeClass("k-state-selected"),2==a.length){var c=t.element.find("tr.k-state-selected"),s=t.dataItem(c);S.showFirstRecord(s.ObjectEntry_ID,n)}else m(n)},S.selectRowsByIds=function(e,t){if(!$.isArray(t)&&!t.length)return!1;var n=SUConstants.ObjectId;$.each(e.tbody.find("tr"),function(){var i=e.dataItem(this);-1!=$.inArray(i[n],t)&&($("[data-uid="+i.uid+"]").addClass("k-state-selected"),$(this).find("._check_row").prop("checked",!0))})},S.selectRow=function(e,t){var n=e.sender,i=(n.select(),n.select());if(n.element.find("._check_row").prop("checked",!1),i.find("._check_row").prop("checked",!0),i.length>1)m(t);else{var a=n.dataItem(i);S.showFirstRecord(a.ObjectEntry_ID,t)}},S.showRelationalRecord=function(e,t,n,i,a){var r,o=y.dataTypes,l=null,c="";e==o.MultiObjectRelationshipField?(l=$(i).find("#ddl"+n).data("kendoDropDownList"),c=l.text()):(t=t.split(":"),t.length>0&&(r=t[0],c=t[1]));var s=c;return d.openRelatedObjectPopup(n,s,r,i,function(t){var r=t.ObjectEntry_ID,o=t.Name,c=r+":"+o;e.MultiObjectRelationshipField==e&&null!=l&&(c=c+":"+l.value()+":"+l.text()),void 0!=a&&null!=a&&($(i).find("#txt"+n).val(o),a.set(n,c))})},S.gridDestroy=function(e){e.data("kendoGrid").destroy(),e.empty()},S.dataBound=function(e,t){var n=e.sender;if(n.element.find("._viewObjectGeoData").off("click"),n.element.find("._viewObjectGeoData").on("click",function(e){S.openMapPopup(e,this)}),t.showFirstRecord&&!n.refreshedWithoutAPICall){var i=n.dataSource.data();if(i&&i.length){var a=i[0].ObjectEntry_ID;S.showFirstRecord(a,t);var r=n.tbody.find(">tr:first");r.find("._check_row").prop("checked",!0),r.addClass("k-state-selected")}}n.refreshedWithoutAPICall&&(n.refreshedWithoutAPICall=!1)},S.parse=function(e){try{e=v(e),e.forEach(function(e){g(e)})}catch(t){var n=o.translate("Messages.InvalidJson");r.showNotification(n,!0)}return e||""},S.parameterMap=function(e,t){t.selectedPage=e.page-1;var n="",a=angular.isObject(y.perspectiveFilter)&&y.perspectiveFilter[t.odn]?y.perspectiveFilter[t.odn]:"";n=a&&t.filterExpression?a+" AND "+t.filterExpression:a?a:t.filterExpression;var r=e.filter?" "+i.getFilterExpression(e.filter,e.filter.logic):"";null==r||""==$.trim(r)?r=n:(n=""==(null==n||$.trim(n))?"":n+" AND ",r=n+r),t.recordCountFilterExpression=r;var o='<?xml version="1.0" encoding="utf-8" ?><Context ID="Shop" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"><TypeName>'+t.odn+'</TypeName><OperationName>SearchObject</OperationName> <Filters>    <Filter>           <String>lorem</String>       </Filter>   </Filters>   <ResultSet>       <Sorting TypeSort="Asc">           <Column>Description</Column>       </Sorting>       <Pager>           <Page>'+(e.page-1)+"</Page>           <Count>"+e.pageSize+"</Count>       </Pager>   </ResultSet></Context>";return o},S.showFirstRecord=function(e,t){m(t);var n={odn:t.odn,pageTemplateName:t.pageTemplateName,recordId:e,fieldEditMode:"single",pageSize:t.pageSize,displayMode:t.displayMode,editMode:"detail",currentRecord:{id:e}};s.getObjectsWithSubObjects(n).then(function(e){t.objectDetailDisplayer=e})},S}]),speedupGridModule.factory("gridColumnsService",["localizationService","notificationService","objectService","configService","gridDataService","fieldService","listDataLoaderService","filesystemService","relatedObjectsService","gridHelper","existingObjectDetailService",function(e,t,n,i,a,r,o,l,c,s,d){function u(i){var a={title:"",field:"",width:75,viewOrder:1==i.showCheckboxForRowSelection?1:0},r=[];if(i.showSelectButton){var o={};o.text=e.translate("ColumnNames.Select"),o.click=function(e){var n=this.dataItem($(e.target).closest("tr"));return null==i.onSelect?t.showNotification("On Select function not defined.",!0):i.onSelect(n),!1},r.push(o)}if(i.showEditButton){var l={name:"Edit",text:""};l.click=function(e){var t=this.dataItem($(e.target).closest("tr"));return null==i.onEditObject?s.showFirstRecord(t.ObjectEntry_ID,i):i.onEditObject(t),!1},r.push(l)}if(i.showDeleteButton){var c={name:"Delete",text:""};c.click=function(a){var r=this.dataItem($(a.target).closest("tr")),o=e.translate("Messages.DeleteObject");return confirm(o)&&n.deleteObject(r.ObjectEntry_ID,i.odn,!0).then(function(){var n=e.translate("Messages.RecordDeletedSuccessfully");t.showNotification(n,!1)}),!1},r.push(c)}return a.command=r,a}function p(){return{title:"<input id='checkAll' type='checkbox' class='check-box' />",template:"<input type=\"checkbox\" class='_check_row'/>",width:35,viewOrder:0}}function f(e){var t={};return t.title="",t.template='<img style="width:60px;" class="_viewObjectLargeImage" imgsrc="#= data.'+SUConstants.RecordFirstImageColumn+'#"  src=\'#=data.image_h60#\' alt="" />',t.width=70,t.viewOrder=1==e.showCheckboxForRowSelection?2:1,t}function v(t){var n=e.translate("Options.SelectOne");t.kendoDropDownList({dataSource:new kendo.data.DataSource({data:[{title:"True",value:1},{title:"False",value:0}]}),dataTextField:"title",dataValueField:"value",optionLabel:n})}function m(e,t,n){var i={};i.dataType=e.DataType,i.field=e.PropertyName,i.title="<div class='wraplong' title='"+e.PropertyLabel+"'>"+e.PropertyLabel+"</div>","GeoPosition"==i.field||"Address"==i.field||"Picture_Location"==i.field||"GeoData_Property_Name"==i.field?i.width=50:"Start_Date"==i.field||"End_Date"==i.field||"Date_Property_Name"==i.field?i.width=80:"Time_Property_Name"==i.field?i.width=50:"Approved_By_WorkLeader"==i.field||"Approved_By_Employee"==i.field||"Arbetsorder"==i.field||"TrueFalse_Property_Name"==i.field?i.width=35:"DateTime_Property_Name"==i.field||"CreatedDate"==i.field||"ChangedDate"==i.field?i.width=140:(i.width=t.columnWidth,i.maxwidth=t.columnMaxWidth,i.minwidth=t.columnMinWidth),i.viewOrder=n,i.sortable=!0,e.DataType==y.dataTypes.CheckBox&&(i.filterable={extra:!1,ui:v,operators:{string:{eq:"Is equal to",neq:"Is not equal to"}}});var a=b(e.DataType,e.PropertyName);if(""!=a&&(i.template=a),t.editable){var r;e.PropertyName!=SUConstants.ObjectPropertyNameField&&(r=g(e,t.odn,t)),""!=r&&(i.editor=r)}return i}function g(e,t,i){return function(a,r){var o=i.currentEditField;if(a.hasClass("clickedOutside")){var l=r.model.ObjectEntry_ID,c=e.PropertyDefinition_ID,s=r.model[r.field];s&&n.saveObjectField(t,r.field,c,s,l,!1),i.currentEditField=null,a.find("._grideditBlock").removeClass("_grideditBlock"),a.removeClass("clickedOutside")}else if(o){if(o!=a){o.addClass("clickedOutside");var d=o.closest(".dynamicObjectGridContainer").data("kendoGrid");d&&(d.editCell(o),i.currentEditField=null)}}else{var u=e.PropertyName,p=e.DataType;if(!O.isCellEditable(u,p))return!1;h(a,t,e,r),i.currentEditField=a}}}function h(e,t,n,i){var a=n.DataType,c=n.PropertyName,d=n.InputSettings,u=n.PropertyDefinition_ID;switch(a){case S.DropDownList:$(e).addClass("_grideditBlock"),o.GetListsData(d).then(function(n){$('<input required id="'+c+'" data-text-field="Text" data-value-field="Value" data-bind="value:'+i.field+'"/>').appendTo(e).kendoDropDownList({autoBind:!1,dataTextField:"Text",dataValueField:"Value",dataSource:n}),r.loadCurrentElement(t,u,i.model,a,e)},function(e){});break;case S.SearchableDropDownList:$(e).addClass("_grideditBlock"),o.GetListsData(d).then(function(n){$('<input required id="'+c+'" data-text-field="Text" data-value-field="Value" data-bind="value:'+i.field+'"/>').appendTo(e).kendoComboBox({autoBind:!1,dataTextField:"Text",dataValueField:"Value",dataSource:n}),r.loadCurrentElement(t,u,i.model,a,e)},function(e){});break;case S.DateTime:$(e).addClass("_grideditBlock"),$('<input  data-bind="value:'+i.field+'"/>').appendTo(e).kendoDateTimePicker({format:"yyyy-MM-dd HH:mm:ss",parseFormats:["yyyy-MM-dd HH:mm:ss"]});break;case S.Date:$(e).addClass("_grideditBlock"),$('<input  data-bind="value:'+i.field+'"/>').appendTo(e).kendoDatePicker({format:"yyyy-MM-dd",parseFormats:["yyyy-MM-dd"]});break;case S.Time:$(e).addClass("_grideditBlock"),$('<input  data-bind="value:'+i.field+'"/>').appendTo(e).kendoTimePicker({format:"HH:mm",parseFormats:["HH:mm"],change:function(){i.model[i.field]=kendo.toString(this.value(),"HH:mm")}});break;case S.NumericText:$(e).addClass("_grideditBlock"),$('<input  data-bind="value:'+i.field+'"/>').appendTo(e).kendoNumericTextBox({});break;case S.Numeric:$(e).addClass("_grideditBlock");var p=d.split(":"),f=""==p[0]?0:p[0],v=""==p[1]?0:p[1],m=""==p[2]?1:p[2];$('<input  data-bind="value:'+i.field+'"/>').appendTo(e).kendoNumericTextBox({min:f,max:v,step:m});break;case S.ParentRelationship:case S.ObjectRelationship:$(e).addClass("_grideditBlock");var g=i.model[i.field];g=void 0==g.split(":")[1]?"":g.split(":")[1];var h=kendo.template('<input id="txt'+i.field+'" value="'+g+'" />');$(h(i)).appendTo(e);var b=$('<div><input type="image" class="_objRelButton" src='+l.getPluginImageUrl("JS/img/search.png")+"  /></div>");b.appendTo(e),b.find("._objRelButton").click(function(t){t.preventDefault(),s.showRelationalRecord(a,d,i.field,e,i.model),t.stopPropagation()});break;case S.MultiObjectRelationshipField:$(e).addClass("_grideditBlock");var g=i.model[i.field];g=void 0==g.split(":")[1]?"":g.split(":")[1];var y=kendo.template('<input id="txt'+i.field+'" value="'+g+'" />');$(y(i)).appendTo(e);var b=$('<div><select id="ddl'+i.field+'"></select><input type="image" class="_objRelButton" src='+l.getPluginImageUrl("JS/img/search.png")+"  /></div>");b.appendTo(e);var k=[],D=n;D.PropertyName=i.field,D.PropertyValue=null,k.push(D),r.initEditorField(k,e),b.find("._objRelButton").click(function(t){t.preventDefault(),s.showRelationalRecord(a,d,i.field,e,i.model),t.stopPropagation()});var O=i.model[i.field];if(O=void 0!=O?O.split(":")[2]:null,null!=O){var j=$(e).find("#ddl"+i.field).data("kendoDropDownList");j.value(O)}break;default:$(e).addClass("_grideditBlock"),$('<input  data-bind="value:'+i.field+'"/>').appendTo(e)}}function b(e,t){var n=y.dataTypes,i="";switch(e){case n.DateTime:i=k.DateTime.replace(/\@/g,t);break;case n.Date:i=k.Date.replace(/\@/g,t);break;case n.Time:i=k.Time.replace(/\@/g,t);break;case n.Image:i=k.Image.replace(/\@/g,t);break;case n.URL:i=k.URL.replace(/\@/g,t);break;case n.CheckBox:i=k.Checkbox.replace(/\@/g,t);break;case n.RichTextBox:i=k.RichTextBox.replace(/\@/g,t);break;case n.Email:i=k.Email.replace(/\@/g,t);break;case n.MultiSelectList:i=k.MultiSelectList.replace(/\@/g,t);break;case n.ParentRelationship:i=k.ParentObjectRelationship.replace(/\@/g,t).replace("$dataType$",n.ObjectRelationship);break;case n.ObjectRelationship:i=k.ObjectRelationship.replace(/\@/g,t).replace("$dataType$",n.ObjectRelationship);break;case n.TableRelationship:i=k.TableRelationship.replace(/\@/g,t).replace("$dataType$",n.ObjectRelationship);break;case n.MultiObjectRelationshipField:i=k.MultiObjectRelationshipField.replace(/\@/g,t).replace("$dataType$",n.ObjectRelationship);break;case n.GeoData:i=k.GeoData.replace(/\@/g,t);break;default:i=k.DefaultTemplateForTitle.replace(/\@/g,t)}if($.inArray(e,D)>-1&&(i=e==n.ParentRelationship||e==n.ObjectRelationship||e==n.TableRelationship||e==n.MultiObjectRelationshipField?k.ObjectRelationshipWithellipses.replace(/\@/g,t).replace("$dataType$",n.ObjectRelationship):k.EllipsesContent.replace(/\@/g,t)),t==SUConstants.ObjectPropertyNameField){var a=i.indexOf("class");a>-1&&(i=i.substr(0,a+7)+"gridNameField "+i.substr(a+7))}return kendo.template(i,{useWithBlock:!1})}var y=i.getGlobalConfig(),S=y.dataTypes,k={EllipsesContent:'<span class="_viewParentObjectRelationship decoration-none withellipsescontent" title="#= data.@#" >#= data.@#</span>',DefaultTemplateForTitle:'<span class="_viewParentObjectRelationship decoration-none" >#= data.@#</span>',URL:'<a href="#= data.@#" target="_blank" title="#= data.@#" >#= data.@#</a>',Image:'<img style="width:60px;"  src="#= data.@#" alt="" />',Date:"<span class='typeDatecolumn'> #=  DateTimeHelper.DateFormat(data.@) #</span>",DateTime:"<span > #=  DateTimeHelper.DateTimeFormat(data.@) #</span>",Time:'<span>#= kendo.toString(data.@, "HH:mm") #</span>',Checkbox:'<input type="checkbox" #=data.@ ==1 ? "checked=checked" : "" # disabled="disabled" ></input>',RichTextBox:"<span title='#=data.@#'> #= data.@# </span>",Email:'<a href="mailto:#= data.@#" target="_blank" title="#= data.@#" >#= data.@#</a>',MultiSelectList:"<span title='#= data.@#'> #= data.@ # </span>",ParentObjectRelationship:'<span class="_viewParentObjectRelationship k-grid-view decoration-none"                                   title="#=data.@.split(":")[1]==undefined?"":data.@.split(":")[1]#" >#=data.@.split(":")[1]==undefined?"":data.@.split(":")[1]#</span>',ObjectRelationship:'<span class="_viewObjectRelationship k-grid-view decoration-none" title="#=data.@.split(":")[1]                 ==undefined?"":data.@.split(":")[1]#" > #=data.@.split(":")[1]==undefined?"":data.@.split(":")[1]#</span>',TableRelationship:'<span title="#=data.@.split(":")[1]==undefined?"":data.@.split(":")[1]#"> #=data.@.split(":")[1]==undefined?"":data.@.split(":")[1]#</span>',MultiObjectRelationshipField:'<span  class="_viewObjectRelationship k-grid-view decoration-none" title="#=data.@.split(":")[1]==undefined?"":data.@.split(":")[1]#" > #=data.@.split(":")[1]==undefined?"":data.@.split(":")[1]#</span>',GeoData:'<a href="javascript:void(0)" data-lat="#=data.@.split(":")[0]==undefined?"":data.@.split(":")[0]#" data-long="#=data.@.split(":")[1]==undefined?"":data.@.split(":")[1]#" data-add="#=data.@.split(":")[2]==undefined?"":data.@.split(":")[2]#" data-zoom="#=data.@.split(":")[3]==undefined?"":data.@.split(":")[3]#" data-maptype="#=data.@.split(":")[4]==undefined?"":data.@.split(":")[4]#"  class="_viewObjectGeoData k-grid-view decoration-none" title="Karta" > Karta</a>',ObjectRelationshipWithellipses:'<span  class="_viewObjectRelationship k-grid-view decoration-none withellipsescontent" title="#=!data.@ || data.@.split(":")[1]                 ==undefined?"":data.@.split(":")[1]#" > #=!data.@ || data.@.split(":")[1]==undefined?"":data.@.split(":")[1]#</span>'},D=["Text","TextBox","RichTextBox","Numeric","NumericText","DropDownList","SearchableDropDownList","MultiSelectList","URL","Image","AutoText","Formula","WebServiceIntegration","ParentRelationship","ObjectRelationship","TableRelationship","MultiObjectRelationshipField","Summary"],O=function(){};return O.getSelectedGridColumns=function(e,t,n){var i=[],a=1,r=5;1==t.showCheckboxForRowSelection&&i.push(p()),(t.showSelectButton||t.showDeleteButton||t.showEditButton)&&i.push(u(t)),i.push(f(t));for(var o in e)a=e[o].PropertyName==SUConstants.RecordFirstImageColumn?1==t.showCheckboxForRowSelection?2:1:e[o].PropertyName==SUConstants.ObjectPropertyNameField?1==t.showCheckboxForRowSelection?3:2:r++,(!n||e[o].Visible)&&i.push(m(e[o],t,a));return i.sort(function(e,t){return e.viewOrder-t.viewOrder}),i},O.isCellEditable=function(e,t){return!r.isFieldReadOnly(e)&&r.isDataTypeEditable(t)},O}]),speedupGridModule.factory("gridDataService",["$http","$q","configService","notificationService","objectService",function(e,t,n,i,a){var r=function(){};n.getGlobalConfig();return r.getTotalRecords=function(e){return 10},r}]),speedupGridModule.directive("speedupGrid",["$compile","configService","gridHelper","gridSchemaService","eventManager","gridRefreshService","gridDataService",function(e,t,n,i,a,r,o){return{template:'<div class="dynamicObjectGridContainer"></div>',restrict:"EA",replace:!0,scope:{parameters:"=parameters",overridingOptions:"=overridingOptions"},controller:["$scope",function(e){e.parameters.displayMode||(e.parameters.displayMode={type:"popup"}),e.parameters.pageTemplateName||(e.parameters.pageTemplateName="Default"),e.overridingOptions?e.gridOptions=angular.merge(n.getGridOptions(e.parameters),e.overridingOptions):e.gridOptions=n.getGridOptions(e.parameters),i.getGridSchema(e.parameters).then(function(t){e.gridOptions.dataSource.schema={model:t,parse:n.parse,total:function(){return o.getTotalRecords(e.parameters)}},e.gridOptions.columns=t.GridSelectedColumnsList,e.parameters.columns=t.GridSelectedColumnsList})}],link:function(t,i,o,l,c){t.$watch("gridOptions.dataSource.schema",function(o){if(o){var l=t.gridOptions,c=l.objectParameters,s=i.kendoGrid(l).data("kendoGrid");if(s.table.on("click","._check_row",function(e){n.selectRowByCheckbox(e,s,c,this)}),t.gridOptions.objectParameters.toolbar){var d=angular.element("<grid-toolbar></grid-toolbar>"),u=t.$new();u=angular.extend(u,t.gridOptions.objectParameters.toolbar),e(d)(u),i.find(".gridToolbar").append(d)}i.find("#checkAll").on("change",function(e){var t=this.checked;t?(s.element.find("tr").addClass("k-state-selected"),s.element.find("._check_row").prop("checked",!0)):(s.element.find("tr").removeClass("k-state-selected"),s.element.find("td").removeClass("k-state-selected"),s.element.find("._check_row").prop("checked",!1))}),a.addListener(FilterGridByGenericSearchEvent,function(e){var t=i.data("kendoGrid"),n=l.objectParameters,a=n.odn,o=e.odn,c=e.genericSearchStr;a==o&&r.refreshByGenericSearch(t,n,c)},c),a.addListener(FilterGridByFilterExpressionEvent,function(e){var t=i.data("kendoGrid"),n=l.objectParameters,a=n.odn,o=e.odn,c=e.filterExpression,s=e.customASFilters;a==o&&r.refreshByFilterExpression(t,n,c,s)},c),a.addListener(ObjectPropertySavedEvent,function(e){r.refreshSinglePropertyDS(e,c.odn,i.data("kendoGrid"))}),a.addListener(ObjectSavedEvent,function(e){r.refreshObjectDS(e,c.odn,i.data("kendoGrid"))}),a.addListener(ObjectCopiedEvent,function(e){r.refreshObjectDS(e,c.odn,i.data("kendoGrid"))}),a.addListener(ObjectsBatchUpdatedEvent,function(e){r.refreshMultiple(e,c.odn,i.data("kendoGrid"))}),a.addListener(ObjectDeletedEvent,function(e){r.refreshObjectDS({ObjectDefinitionName:e.odn},c.odn,i.data("kendoGrid"))})}})}}}]),speedupGridModule.factory("gridFilterExpressionService",["configService",function(e){function t(e,t){var n=o.dataTypes;for(var i in t)if(t[i].field==e&&(t[i].dataType==n.DateTime||t[i].dataType==n.Date))return!0;return!1}function n(e,t){var n=o.dataTypes;for(var i in t)if(t[i].field==e&&(t[i].dataType==n.ParentRelationship||t[i].dataType==n.ObjectRelationship))return!0;return!1}function i(e,t,n,i,a){var r,o=" ";switch(e){case s.StartsWith:r=n+c.LikeOperator+"'"+i+c.RightPerc;break;case s.EndsWith:r=n+c.LikeOperator+c.LeftPerc+i+"'";break;case s.NotEqualTo:r=n+c.NotLikeOperator+c.LeftPerc+i+c.RightPerc;break;case s.EqualTo:case s.Contains:r=n+c.LikeOperator+c.LeftPerc+i+c.RightPerc;break;case s.GreaterThanOrEqualTo:r="Convert(datetime,"+n+")"+c.GreaterThanOrEqualTo+"Convert(datetime,'"+i+"')";break;case s.LessThanOrEqualTo:r="Convert(datetime,"+n+")"+c.LessThanOrEqualTo+"Convert(datetime,'"+i+"')";break;default:r=n+c.LikeOperator+c.LeftPerc+i+c.RightPerc}return a=void 0!=t&&null!=t?""!=a?a+o+t+o+r:r:a+o+r}function a(e,t,n,i,a){var r,o=" ";switch(e){case s.StartsWith:r=n+c.LikeOperator+"'"+i+c.RightPerc;break;case s.EndsWith:r=n+c.LikeOperator+c.LeftPerc+i+"'";break;case s.NotEqualTo:r=n+c.NotEqualTo+"'"+i+"'";break;case s.EqualTo:r=n+c.EqualTo+"'"+i+"'";break;case s.Contains:r=n+c.LikeOperator+c.LeftPerc+i+c.RightPerc}return a=void 0!=t&&null!=t?""!=a?a+o+t+o+r:r:a+o+r}function r(e,t,n,i,a){var r,o=" ";switch(e){case s.StartsWith:r=n+c.LikeOperator+c.LeftPerc+":"+i+c.RightPerc;break;case s.EndsWith:r=n+c.LikeOperator+c.LeftPerc+":%"+i+"'";break;case s.NotEqualTo:r=n+c.NotLikeOperator+c.LeftPerc+i+c.RightPerc;break;case s.Contains:case s.EqualTo:r=n+c.LikeOperator+c.LeftPerc+i+c.RightPerc}return a=void 0!=t&&null!=t?""!=a?a+o+t+o+r:r:a+o+r}var o=e.getGlobalConfig(),l="",c={NotLikeOperator:" NOT LIKE ",LikeOperator:" LIKE ",NotOperator:" NOT",NotEqualTo:" <>",EqualTo:" =",LeftPerc:"'%",RightPerc:"%'",GreaterThanOrEqualTo:" >= ",LessThanOrEqualTo:" <= "},s={EqualTo:"eq",NotEqualTo:"neq",GreaterThanOrEqualTo:"gte",LessThanOrEqualTo:"lte",Contains:"contains",StartsWith:"startswith",EndsWith:"endswith"},d=function(){};return d.getSortExpression=function(e){var t="",n="",i="";return void 0!=e&&null!=e&&$.each(e,function(e,a){n="["+a.field+"]",i=a.dir,""==t?t=n+" "+i:t+=", "+n+" "+i}),""==t?l:t},d.getFilterExpression=function(e,o,l){var c="",s="",d="",u="";return void 0!=e&&null!=e&&$.each(e.filters,function(e,p){d=p.operator,void 0!=p.field&&(s="["+p.field+"]",u=p.value,c=t(p.field,l)?i(d,o,s,u,c):n(p.field,l)?r(d,o,s,u,c):a(d,o,s,u,c))}),c},d}]),speedupGridModule.factory("gridSchemaService",["$q","configService","schemaService","gridColumnsService","gridDataService",function(e,t,n,i,a){function r(e,t){var n=e.split(","),i=[],a={};t.forEach(function(e,t){a[e.PropertyName]=t});var r;return n.forEach(function(e){r=a[e],r&&t[r]&&i.push(t[r])}),i}var o=function(){};return o.getGridSchema=function(e){return n.getSchema(e.odn).then(function(n){if(!n)return null;var o=[],l=[],c=t.getGlobalConfig();return o=e.odn==c.objectDefinitionName?r(c.selectedColumns,n.AllColumnsList):n.SelectedColumnsList,l=o.length?i.getSelectedGridColumns(o,e,!1):i.getSelectedGridColumns(n.AllColumnsList,e,!0),{GridSelectedColumnsList:l,TotalRecords:a.getTotalRecords(e),Model:n.Model,GridColumnsList:n.AllColumnsList}})},o}]),speedupGridModule.factory("batchEditService",["$q","$rootScope","objectDetailService","objectEditService","gridWidgetService","objectService","inlineFieldValueValidatorService","detailPageFieldValuesService","configService","localizationService","notificationService","popupService","objectTemplateService","fieldPropertiesService","gridHelper",function(e,t,n,i,a,r,o,l,c,s,d,u,p,f,v){function m(e){var t=e.find('input[type!="hidden"]');t.prop("checked")?t.prop("checked",!1):t.prop("checked",!0)}function g(e,t){return e&&e.contentObject&&e.contentObject.element&&t.is(e.contentObject.element)}function h(e,t){return e&&e.length&&t&&t.length?e.is(t):!1}var b=function(){},y=c.getGlobalConfig();return b.getTargetSimpleBlock=function(e){if(e.hasClass("_keycontainer"))return e;var t=e.closest("._keycontainer");return t.length?t:null},b.getEmptyDataItem=function(e){return p.getObjectTemplate(e).then(function(t){var n="";t&&t[0]&&t[0].SelectedColumnsForTemplate&&(n=t[0].SelectedColumnsForTemplate);var i=[];n.split(",").forEach(function(e){""!=e&&i.push(e.replace(/[[\]]/g,""))});var a=f.getAllPropertiesOfFieldsArray(i,e),r=[];return $.each(a,function(e,t){var n=t.PropertyName;null!=t&&void 0!=t.PropertyLabel&&("CreatedDate"==n||"ChangedDate"==n||(t.DataType==y.dataTypes.Date?t.DefaultValue="":t.DataType==y.dataTypes.DateTime?t.DefaultValue=dateTimeService.DateTimeFormat(new Date):t.DataType==y.dataTypes.Time&&(t.DefaultValue=kendo.toString(new Date,"HH:mm"))),t.PropertyName=n,t=l.setValuesForElements(t,n),r.push(t))}),r})},b.enterPressed=function(e,t,n){var i=y.dataTypes,a=e.attr("dtype");if(a==i.CheckBox)m(e);else if(a!=i.TextBox)return this.tabPressed(e,t,n,!1);return e},b.tabPressed=function(e,t,n,a){if(i.deactivateAllSimpleBlocks(t.contentObject.element),e){var r=e.attr("dtype"),o=e.attr("key"),c=l.getElementsValue(e,r,o);""!=c&&void 0!=c&&null!=c&&":"!=c&&i.performValidation(t.contentObject.element,e)&&e.parent().find(".checkbox input").prop("checked",!0),e=i.setNextBlockEdited(e,n,a)}return e},b.bindKeyboardKeyPressEvt=function(e,t,n,i){var a=e.keyCode||e.which,r={contentObject:{element:t},batchEditBlock:!0};switch(a){case 169:e.preventDefault(),n.selectedBlock=this.tabPressed(n.selectedBlock,r,i,!0);break;case 9:e.preventDefault(),n.selectedBlock=this.tabPressed(n.selectedBlock,r,i);break;case 13:n.selectedBlock=this.enterPressed(n.selectedBlock,r,i);break;case 16:e.preventDefault(),n.shiftPressed=!0}},b.activateWidget=function(e,n,a){if(null==a)return i.deactivateAllSimpleBlocks($(this)),n.selectedBlock=e.find("._keycontainer").first(),i.activateSimpleBlock(n.selectedBlock),t.currentPageBlock={contentObject:{element:e},batchEditBlock:!0},n.selectedBlock;var r=a.closest("._keycontainer");return r.length?(g(t.currentPageBlock,e)?h(r,n.selectedBlock)||(i.deactivateAllSimpleBlocks($(this)),i.activateSimpleBlock(r),n.selectedBlock=r):(t.currentPageBlock={contentObject:{element:e
},batchEditBlock:!0},r.length?n.selectedBlock=r:n.selectedBlock=e.find("._keycontainer").first(),i.activateSimpleBlock(r)),n.selectedBlock):n.selectedBlock},b.getFieldsValues=function(e,t,i,a){return n.getEditedObjectData(e,i,a).then(function(n){var i=[];if(!angular.isArray(n)||!angular.isObject(n[0]))return i;var a=e.find(".inputContainer"),r=n[0],o=b.fieldsArrayToHash(t);return a.each(function(e,t){if($(t).find(".checkbox input").prop("checked")){var n=$(t).find(".b-field-label").attr("key");if(n){var a=r[n]||"",l=o[n];angular.isObject(l)&&i.push({name:l.PropertyName,fk:l.PropertyDefinition_ID,value:a})}}}),i})},b.sendSaveRequest=function(t,n){var i=[];if(a.getSelectedRows(n.gridElement).forEach(function(e){var t=e.ObjectEntry_ID;t&&i.push(t)}),!t.length){var o=s.translate("Messages.SelectAtLeastOneFieldForBatchEdit");d.showNotification(o,!0);var l=e.defer();return l.reject(),l}if(i.length)return r.batchEdit({entries:i,data:t},n.odn,!0).then(function(e){var t=n.gridElement.data("kendoGrid");setTimeout(v.selectRowsByIds(t,i),200);var a=s.translate("Messages.BatchEditSuccess");d.showNotification(a,!1)},function(){var e=s.translate("Messages.FailedToBatchEdit");d.showNotification(e,!0)});var o=s.translate("Messages.SelectAtLestOneForBatchEdit");return d.showNotification(o,!0),!1},b.fieldsArrayToHash=function(e){var t={};return e.forEach(function(e){t[e.PropertyName]=e}),t},b}]),speedupGridModule.directive("gridBatchEditForm",["$compile","configService","batchEditService","fieldService","objectDetailService","eventManager","localizationService",function(e,t,n,i,a,r,o){var l=t.getGlobalConfig();return{templateUrl:t.getTemplateUrl("Grid/BatchEdit/BatchEditTemplate.html"),restrict:"EA",replace:!0,link:function(t,a,c,s,d){n.getEmptyDataItem(t.odn).then(function(n){n.forEach(function(e){e.PropertyValue=""});var c=l.dataTypes,s=n.filter(function(e){return e.DataType==c.GeoData||e.DataType==c.AutoText?!1:!i.isFieldReadOnly(e.PropertyName)});t.fields=[s],t.tr={title:o.translate("Titles.BatchEdit")};var d=angular.element("<grid-batch-edit-blocks></grid-batch-edit-blocks>");e(d)(t),a.find(".contentBlock").append(d);var u=a.find(".batchEditForm");t.$on(BatchEditBtnClickedEvent,function(){"none"==u.css("display")?(r.fireEvent(BatchFormOpenedEvent),u.css("display","block")):(r.fireEvent(BatchFormClosedEvent),u.css("display","none"))}),t.containerElement=a})}}}]).directive("gridBatchEditBlocks",["$compile","$rootScope","configService","filesystemService","fieldService","objectDetailService","batchEditService","gridWidgetService","objectService","objectEditService","eventManager","localizationService","detailPageFieldValuesService",function(e,t,n,i,a,r,o,l,c,s,d,u,p){var f=n.getGlobalConfig();return{templateUrl:n.getTemplateUrl("Grid/BatchEdit/BatchForm.html"),restrict:"EA",replace:!0,controller:function(e,t,n,a){if(e.fields&&e.fields.length){var r=angular.element("#oeDetailsBlock",t),o=kendo.template(r.html());e.fields[0].helpers={getPluginImageUrl:i.getPluginImageUrl},e.fields[0].editBtnTitle=u.translate("Buttons.Update");var l=kendo.render(o,e.fields);t.html(l)}},link:function(e,n,i,l,c){a.initializeEditors(e.fields[0],n),n.find("._objRelButton").click(function(t){var n=angular.element(t.currentTarget),i=n.parent().find('input[id^="txt"]').val();return r.openRelationalRecordPopup(n,e.fields[0],i),!1});var u=o.fieldsArrayToHash(e.fields[0]),v=f.dataTypes,m=n.find("._keycontainer").filter(function(e,t){var n=$(t).attr("key"),i=u[n];return angular.isObject(i)&&i.DataType&&(i.DataType==v.GeoData||i.DataType==v.AutoText)?!1:!a.isFieldReadOnly(n)}),g=e.containerElement.find(".batchEditForm");d.addListener(BatchFormOpenedEvent,function(){o.activateWidget(g,e,null)}),d.addListener(BatchFormClosedEvent,function(){t.currentPageBlock=null}),g.on("mousedown",function(t){var n=o.getTargetSimpleBlock($(t.target));if(n&&!n.is(e.selectedBlock)&&n){var i=e.selectedBlock.attr("dtype"),a=e.selectedBlock.attr("key"),r=p.getElementsValue(e.selectedBlock,i,a);""!=r&&void 0!=r&&null!=r&&":"!=r&&s.performValidation(g,e.selectedBlock)&&e.selectedBlock.parent().find(".checkbox input").prop("checked",!0)}o.activateWidget(g,e,g.find(t.target))}),e.containerElement.on("detailKeypress",function(t){o.bindKeyboardKeyPressEvt(t,n,e,m)}),n.find("._batchEditBtn").on("click",function(t){var i=f.userName;return o.getFieldsValues(n,e.fields[0],e.odn,i).then(function(t){o.sendSaveRequest(t,e)}),!1})}}}]).directive("gridBatchEditBtn",["$rootScope","configService",function(e,t){return{templateUrl:t.getTemplateUrl("Grid/BatchEdit/BatchEditBtnTemplate.html"),restrict:"EA",replace:!0,controller:function(t){t.click=function(){e.$broadcast(BatchEditBtnClickedEvent)}}}}]),speedupGridModule.directive("gridToolbar",["$timeout","configService","objectEditService","eventManager",function(e,t,n,i){return{templateUrl:function(e,n){return n.templateUrl||t.getTemplateUrl("Grid/Toolbar/GridToolbar.html")},restrict:"EA",replace:!0,link:function(t,a){e(function(){a.find("._btnAddNewRecord").click(function(){t.odn&&n.createNewObject(t.odn)}),a.find("._objectSearchButton").click(function(){var e=a.find("._txtObjectSearch").val();i.fireEvent(FilterGridByGenericSearchEvent,{odn:t.odn,genericSearchStr:e})}),a.find("._txtObjectSearch").on("keydown",function(e){if(13==e.which){var n=a.find("._txtObjectSearch");i.fireEvent(FilterGridByGenericSearchEvent,{odn:t.odn,genericSearchStr:n.val()}),n.select()}})})}}}]),speedupGridModule.factory("gridWidgetService",[function(){var e=function(){};return e.getSelectedRows=function(e){var t=[],n=e.data("kendoGrid");return n&&e.find(".k-grid-content tbody tr").each(function(){var e=$(this);e.find("._check_row").is(":checked")&&t.push(n.dataItem(this))}),t},e}]),speedupObjectDetailModule.directive("tsHeaderSubObject",["$timeout","configService",function(e,t){return{templateUrl:function(e,n){return n.templateUrl||t.getTemplateUrl("TabStrip/SubObject/TabStripHeaderSubObject.html")},restrict:"EA",transclude:!0,replace:!0,link:function(e,t){}}}]),speedupObjectDetailModule.factory("tsHeaderSubObjectService",["$rootScope","$compile","configService",function(e,t,n){var i=n.getGlobalConfig(),a={selectedPage:0,filterExpression:"",genericSearch:"",refreshButton:!0,recordCountFilterExpression:"",gridHeight:400,pageSize:i.gridPageSize,columnWidth:100,columnMinWidth:150,columnMaxWidth:"auto",showEditButton:!1,showSelectButton:!1,showDeleteButton:!1,showFirstRecord:!0,showCheckboxForRowSelection:!1},r=function(){};return r.createSubObjectPage=function(n,i,r,o,l){if(!n.find(".tabStripHeaderRelatedObjectContainer").length){var c=angular.element("<ts-header-sub-object></ts-header-sub-object>");n.prepend(c);var s=e.$new();s.gridParameters=a,s.gridParameters.filterExpression=" ["+l+"] Like '"+o+":%' ",s.gridParameters.odn=i,s.gridParameters.displayMode={type:"element",element:n.find(".tabStripRelatedPropertyDetailContainer")},t(c)(s)}},r}]),CSVapp.factory("printTemplateCacheService",[function(){var e=[],t=function(){};return t.getPrintTemplate=function(t){return e.filter(function(e){return e.ObjectDefinitionName==t?e:void 0})[0]},t.preservePrintTemplateObject=function(t){var n=e.filter(function(e){return t.ObjectDefinitionName==e.ObjectDefinitionName?e:void 0})[0];(null==n||void 0==n)&&e.push(t)},t}]),CSVapp.factory("conversionCacheService",[function(){var e=[],t=function(){};return t.getConversionObject=function(t){return e.filter(function(e){return e.ObjectDefinitionName==t?e:void 0})[0]},t.preserveConversionObject=function(t){var n=e.filter(function(e){return t.ObjectDefinitionName==e.ObjectDefinitionName?e:void 0})[0];(null==n||void 0==n)&&e.push(t)},t}]);